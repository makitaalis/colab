# Админка модульные этапы

Основной roadmap и стандарты:

- `Docs/Проект/Админ-панель (модульная разработка).md`
- `Docs/Проект/Админ-панель (UI-UX стандарт).md`
- `Docs/Проект/Промпты Codex (админка).md`
- `skills/orangepi-passengers-admin-ui-toolkit/SKILL.md`
- `skills/orangepi-passengers-admin-golden-shell/SKILL.md`

## Единый smoke gate

```bash
./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass-file "pass admin panel"
# (или явно) ./scripts/admin_panel_smoke_gate.sh ... --admin-pass "<BASIC_AUTH_PASS>"
```

Smoke-gate включает UI route `/admin/commission` (commissioning).

## Проверка UI-маркеров

```bash
for url in /admin/commission /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "window.AdminUiKit|flowStep|tableMeta|densityBadge|sideNav|sideNavTools|sideNavSearch|sideNavCompactBtn|sideNavHelpBtn|sideNavOnboarding|sideNavOnboardingDismiss|sideNavFilterStatus|sideGroups|sideGroup|sideGroupTitle|sideGroupToggle|sideJumpRow|sideJump|sideLink|sideStep|sidePin|sideMiniHead|sideMiniList|sideMiniAction|sideQuickIntentList|sideContextHint|sideCommandHub|sideFocusToggle|sideCheatList|sideMissionGrid|sideMissionPresetList|sideMissionChecklist|sideMissionPlaybookList|sideMissionChain|sideMissionSnapshotSummary|sideResponsePackSummary|sideResponseRoutingSummary|sideRoutingProfile|sideRoutingTemplate|sideDeliveryAdapter|sideDeliveryVariant|sideDeliveryPolicyProfile|sideDeliveryPolicySummary|sideDeliverySummary|sideDeliveryHandoffStatus|sideDeliverySlaStatus|sideDeliveryAutomationSummary|sideDeliverySuggestedAction|sideDeliverySticky|sideDeliveryStickySuggested|sideSnapshotSection|sideSnapshotTools two|sideIncidentFocus|sideHandoffInput|sideHandoffAdoption|sideHandoffCoaching|sideHandoffScorecard|sideHandoffTrend|sideHandoffTrendStatus|sideHandoffNextActions|sideHandoffTimeline|data-handoff-adoption-action|data-handoff-trend-action|sideFavoritesList|sideRecentList|sideSessionList|appShell|workspaceHint|workspaceApply|cmdPaletteOpen|presetNamespace|presetSelect|presetExport|presetImport|presetPreview|presetProfiles|presetCleanup|presetObservability|presetMetrics|presetTimelineHint|presetTimelineOpen|presetTimelineClear|presetMergeHint|presetPolicyHint|presetPolicyUnlock|presetPolicyLock|presetCockpitHint|presetCockpit|presetCockpitTimelineHint|presetCockpitTimeline|presetRolloutHint|presetRollout|exportPresetBundle|importPresetBundle|installPresetProfiles|cleanupPresets|presetProfileTemplates|buildPresetScopeObservability|buildPresetObservabilityBundle|listPresetTimeline|buildPresetTimelineSummary|buildPresetTimelineBundle|simulatePresetImport|simulatePresetBundleImport|buildPresetMergePreview|getPresetProtectionState|setPresetProtectionLock|buildPresetOperationsSummary|simulatePresetOperations|applyPresetOperations|setPresetProtectionLockBatch|buildPresetCockpitTimeline|openPresetCockpitTimelinePanel|closePresetCockpitTimelinePanel|buildPresetRolloutAssistant|applyPresetRolloutAssistant|getPresetRolloutLast|initSidebarPersonalization|bindSidebarNavTools|bindSidebarQuickIntentHotkeys|bindSidebarCommandHub|applySidebarNavFilter|applySidebarCompactMode|setSidebarNavOnboardingVisible|isSidebarNavOnboardingDismissed|storeSidebarNavOnboardingDismissed|listVisibleSidebarNavLinks|setSidebarGroupCollapsed|NAV_ADOPTION_STORAGE_KEY|NAV_ADOPTION_EVENT_LABELS|MISSION_ADOPTION_HISTORY_STORAGE_KEY|MISSION_ADOPTION_HISTORY_META_STORAGE_KEY|buildSidebarNavAdoptionSummary|adoptionEventCount|buildSidebarNavAdoptionCoaching|buildSidebarNavAdoptionScorecard|buildSidebarNavNextActions|buildSidebarNavAdoptionSnapshot|clearSidebarNavAdoption|loadMissionAdoptionHistory|loadMissionAdoptionHistoryMeta|clearMissionAdoptionHistory|buildMissionAdoptionHistoryLifecycle|appendMissionAdoptionHistoryEntry|buildMissionAdoptionTrend|renderMissionHandoffAdoptionTrend|runMissionHandoffTrendAction|recordSidebarNavAdoptionEvent|runMissionHandoffAdoptionAction|renderMissionHandoffAdoptionSummary|nav_trend_history_show|nav_trend_history_export|nav_trend_history_clear|MISSION_ADOPTION_TREND_WINDOW_STORAGE_KEY|MISSION_ADOPTION_TREND_WINDOWS|loadMissionAdoptionTrendWindow|storeMissionAdoptionTrendWindow|buildMissionAdoptionCompareSummary|runMissionHandoffTrendWindowAction|data-handoff-trend-window|sideHandoffTrendCompare|buildMissionAdoptionTrendCoach|sideHandoffTrendCoach|trend_coach|nav_trend_window_set|MISSION_HANDOFF_COMPOSER_STORAGE_KEY|buildMissionHandoffComposerTemplate|runMissionHandoffComposerAction|data-handoff-compose-action|sideHandoffComposer|compose_apply|compose_copy|buildMissionHandoffQualityState|renderMissionHandoffQuality|runMissionHandoffQualityAction|data-handoff-quality-action|sideHandoffQuality|quality_blocked|quality_override|quality_check|Handoff NOT-READY|applySidebarFocusMode|buildAdaptiveSidebarIntents|buildSidebarContextHint|renderSidebarSessionShortcuts|collectMissionMetrics|renderMissionWidgets|renderMissionChecklistSummary|renderMissionPlaybooks|renderMissionChain|runMissionPlaybookStep|runMissionChainAction|runMissionSnapshotAction|runMissionHotkeyAction|renderMissionSnapshotSummary|buildMissionResponsePack|buildMissionRoutingSignal|resolveMissionRoutingProfile|buildMissionChannelTemplate|buildMissionRoutingDispatchNote|buildMissionDeliveryPayload|buildMissionDeliveryTemplates|MISSION_DELIVERY_POLICY_STORAGE_KEY|MISSION_DELIVERY_POLICY_PROFILES|loadMissionDeliveryPolicySelection|storeMissionDeliveryPolicySelection|resolveMissionDeliveryPolicyProfile|renderMissionDeliveryPolicyControls|listMissionDeliveryJournal|appendMissionDeliveryJournalEvent|missionDeliveryJournalActionLabel|buildMissionDeliverySlaState|buildMissionDeliveryHandoffStatus|buildMissionDeliveryAutomationPlan|collectMissionDeliveryBulkCandidates|renderMissionDeliveryHandoffStatus|renderMissionDeliverySlaStatus|renderMissionDeliveryAutomationSummary|confirmMissionDangerAction|buildMissionHandoffTemplate|runMissionResponsePackAction|renderMissionResponsePackSummary|renderMissionResponseRoutingSummary|renderMissionDeliverySummary|copy-telegram|copy-email|copy-ticket|copy-delivery|apply-delivery|apply-delivery-policy|show-delivery-journal|clear-delivery-journal|ack-delivery|retry-delivery|escalate-delivery|apply-delivery-suggestion|bulk-ack-pending|bulk-retry-stale|bulk-escalate-stale|renderMissionHandoffNotes|renderMissionHandoffTimeline|runMissionHandoffAction|runMissionHandoffHistoryAction|runMissionTriagePreset|runIncidentFocusAction|openCommandPalette"
done
```

## Подробные поэтапные команды

- `Docs/Проект/Операции (подробно).md`

## Стандарт завершения этапа

- Всегда фиксировать: что сделано в текущем этапе и зачем.
- Всегда фиксировать: что будет сделано следующим этапом и зачем.

## Поэтапное внедрение единого UI/UX стандарта

1. Этап 1 (документация): зафиксировать единый стандарт в `Docs/Проект/Админ-панель (UI-UX стандарт).md`. ✅
2. Этап 2 (аудит): пройти все `/admin*` страницы по чеклисту и выделить high-impact несоответствия (иерархия, KPI, фильтры, состояния).
3. Этап 3 (исправления): выровнять сначала `overview/fleet/alerts/incidents`, затем `audit/actions/notify-center/history/policy/wg`.
4. Этап 4 (закрытие): прогнать smoke-gate + marker-check, обновить docs и зафиксировать итоговый DoD-отчёт.

### Старт этапа 2 (2026-02-16): быстрый marker-аудит

- Проверены UI-страницы: `/admin`, `/admin/commission`, `/admin/fleet*`, `/admin/audit`, `/admin/wg`.
- Базовые маркеры `copy-link`, `flow`, `tableMeta` и `filterSummary/context` присутствуют почти везде.
- Первое выявленное несоответствие стандарту:
  - `/admin/fleet/notifications` — отсутствует явный `filterSummary` в header.
- Приоритет исправлений (этап 3):
  - сначала закрыть `fleet/notifications`, затем пройтись по текстовой унификации CTA/summary на остальных страницах.

### Прогресс этапа 3 (2026-02-16): точечные UI/UX правки

- `backend/app/admin_fleet_notifications_page.py`:
  - добавлен header-summary `filterSummary` (`контекст: глобальні правила сповіщень`) для соответствия единому паттерну страниц.
- `backend/app/admin_fleet_incidents_page.py`:
  - унифицированы подписи в command palette под каноничные параметры (`include_resolved=0`, `sla_breached_only=1`);
  - убрана смешанная англоязычная формулировка (`protected presets` -> `захищені пресети`).
- `backend/app/admin_fleet_page.py` и `backend/app/admin_fleet_alerts_page.py`:
  - выполнена дополнительная текстовая унификация command palette (UA-first формулировки для `shared namespace`/`policy lock`/`preview merge` и связанных подсказок);
  - сохранена логика preset/cockpit-инструментов без изменения API/DOM-контрактов.
- Проверки после правок:
  - `python3 -m py_compile backend/app/admin_fleet_notifications_page.py backend/app/admin_fleet_incidents_page.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py` — OK;
  - локальный render-аудит `/admin*` по маркерам (`copy/summary/flow/meta`) — OK;
  - `./scripts/admin_panel_smoke_gate.sh --admin-pass-file "pass admin panel"` — PASS.

## Дополнительный marker-check для phase-62

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "MISSION_HANDOFF_QUALITY_PROFILE_STORAGE_KEY|MISSION_HANDOFF_QUALITY_PROFILES|normalizeMissionHandoffQualityProfileId|resolveMissionHandoffQualityProfile|runMissionHandoffQualityProfileAction|data-handoff-quality-profile|sideHandoffQualityPolicy|quality_profile_set|policy="
done
```

## Дополнительный marker-check для phase-63

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "runMissionHandoffQualityRemediationAction|data-handoff-quality-remedy|sideHandoffQualityExplain|quality_remediate|appendMissionHandoffNextActionsToNote|appendMissionHandoffExpansionLine|fix="
done
```

## Дополнительный marker-check для phase-64

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "MISSION_HANDOFF_REMEDIATION_METRICS_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_TTR_LIMIT|normalizeMissionHandoffRemediationMetrics|updateMissionHandoffRemediationMetrics|renderMissionHandoffRemediationSummary|sideHandoffRemediationSummary|quality_remediate"
done
```

## Дополнительный marker-check для phase-65

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "MISSION_HANDOFF_REMEDIATION_TIMELINE_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_TIMELINE_LIMIT|normalizeMissionHandoffRemediationTimelineItem|appendMissionHandoffRemediationTimelineEvent|buildMissionHandoffRemediationTimelineSummary|renderMissionHandoffRemediationTimelinePreview|runMissionHandoffRemediationHistoryAction|data-handoff-remediation-history-action|sideHandoffRemediationTimelineMeta|sideHandoffRemediationTimeline"
done
```

## Дополнительный marker-check для phase-66

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "MISSION_HANDOFF_REMEDIATION_GOVERNANCE_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_GOVERNANCE_PROFILES|normalizeMissionHandoffRemediationGovernanceProfileId|buildMissionHandoffRemediationGovernanceState|renderMissionHandoffRemediationGovernance|runMissionHandoffRemediationGovernanceAction|data-handoff-remediation-governance|sideHandoffRemediationGovernance|sideHandoffRemediationActions"
done
```


## Дополнительный marker-check для phase-67

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "MISSION_HANDOFF_REMEDIATION_INCIDENTS_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_INCIDENTS_LIMIT|MISSION_HANDOFF_REMEDIATION_INCIDENT_SNOOZE_MIN|normalizeMissionHandoffRemediationIncidentItem|listMissionHandoffRemediationIncidents|ensureMissionHandoffRemediationGovernanceIncident|runMissionHandoffRemediationIncidentAction|data-handoff-remediation-incident-action|sideHandoffRemediationIncidentSummary|sideHandoffRemediationIncidentFeed"
done
```


## Дополнительный marker-check для phase-68

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "buildMissionHandoffRemediationIncidentSlaSummary|renderMissionHandoffRemediationIncidentSla|runMissionHandoffRemediationIncidentHistoryAction|data-handoff-remediation-incident-history-action|sideHandoffRemediationIncidentSla|remediation_incident_journal_show|remediation_incident_journal_export|remediation_incident_journal_clear"
done
```


## Дополнительный marker-check для phase-69

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "buildMissionHandoffRemediationIncidentDigest|buildMissionHandoffRemediationIncidentTriageHints|renderMissionHandoffRemediationIncidentDigest|sideHandoffRemediationIncidentDigest|sideHandoffRemediationIncidentTriage|Top fingerprint|Digest triage"
done
```


## Дополнительный marker-check для phase-70

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "missionHandoffRemediationPlannerSuggestAction|buildMissionHandoffRemediationActionPlan|renderMissionHandoffRemediationActionPlan|runMissionHandoffRemediationPlanAction|data-handoff-remediation-plan-action|sideHandoffRemediationPlanSummary|sideHandoffRemediationPlan|remediation_digest_plan_show|remediation_digest_plan_export|remediation_digest_plan_copy"
done
```


## Дополнительный marker-check для phase-71

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "MISSION_HANDOFF_REMEDIATION_DECISION_LEDGER_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_DECISION_LEDGER_LIMIT|normalizeMissionHandoffRemediationDecisionItem|listMissionHandoffRemediationDecisionLedger|buildMissionHandoffRemediationDecisionCoverage|renderMissionHandoffRemediationDecisionCoverage|runMissionHandoffRemediationPlanAction|data-handoff-remediation-plan-action|sideHandoffRemediationDecisionCoverage|sideHandoffRemediationDecisionLedger|remediation_decision_ledger_show|remediation_decision_ledger_export|remediation_decision_ledger_clear|remediation_digest_plan_log_primary"
done
```


## Дополнительный marker-check для phase-72

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "missionHandoffRemediationDecisionMatchKey|buildMissionHandoffRemediationDecisionBacklog|renderMissionHandoffRemediationDecisionBacklog|runMissionHandoffRemediationPlanAction|data-handoff-remediation-plan-action|sideHandoffRemediationDecisionBacklogSummary|sideHandoffRemediationDecisionBacklog|backlog-show|backlog-export|backlog-copy|remediation_decision_backlog_show|remediation_decision_backlog_export|remediation_decision_backlog_copy"
done
```


## Дополнительный marker-check для phase-73

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "MISSION_HANDOFF_REMEDIATION_DECISION_BACKLOG_CLOSEOUT_LIMIT|normalizeMissionHandoffRemediationBacklogDecision|applyMissionHandoffRemediationBacklogCloseout|runMissionHandoffRemediationPlanAction|data-handoff-remediation-plan-action|backlog-item-ack-|backlog-item-snooze-|backlog-item-profile-check-|backlog-batch-ack|backlog-batch-snooze|backlog-batch-profile-check|remediation_decision_backlog_closeout_item|remediation_decision_backlog_closeout_batch|sideHandoffRemediationDecisionBacklog"
done
```


## Дополнительный marker-check для phase-74

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "closeout-governance-show|closeout-governance-export|sideHandoffRemediationCloseoutSummary|sideHandoffRemediationCloseoutBoard|buildMissionHandoffRemediationCloseoutGovernance|renderMissionHandoffRemediationCloseoutGovernance|remediation_decision_closeout_governance_show|remediation_decision_closeout_governance_export"
done
```


## Дополнительный marker-check для phase-75

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_POLICIES|resolveMissionHandoffRemediationCloseoutEscalationPolicy|buildMissionHandoffRemediationCloseoutEscalation|renderMissionHandoffRemediationCloseoutEscalation|closeout-escalation-show|closeout-escalation-export|closeout-escalation-copy|sideHandoffRemediationEscalationSummary|sideHandoffRemediationEscalationBoard|remediation_decision_closeout_escalation_show|remediation_decision_closeout_escalation_export|remediation_decision_closeout_escalation_copy"
done
```


## Дополнительный marker-check для phase-76

```bash
for url in /admin/fleet /admin/fleet/alerts /admin/fleet/incidents /admin/audit; do
  echo "== ${url} =="
  curl -k -u "admin:<BASIC_AUTH_PASS>" -sS "https://207.180.213.225:8443${url}" | grep -E -c "MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_EXECUTION_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_EXECUTION_LIMIT|MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_SLA_STALE_SEC|MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_SNOOZE_MIN|normalizeMissionHandoffRemediationCloseoutEscalationExecutionItem|listMissionHandoffRemediationCloseoutEscalationExecution|storeMissionHandoffRemediationCloseoutEscalationExecution|appendMissionHandoffRemediationCloseoutEscalationExecutionEntry|missionHandoffRemediationCloseoutEscalationExecutionActive|buildMissionHandoffRemediationCloseoutEscalationExecutionState|renderMissionHandoffRemediationCloseoutEscalationExecution|closeout-escalation-ack|closeout-escalation-snooze|closeout-escalation-resolve|closeout-escalation-log-show|closeout-escalation-log-export|closeout-escalation-log-copy|sideHandoffRemediationEscalationExecutionSummary|sideHandoffRemediationEscalationExecutionBoard|remediation_decision_closeout_escalation_ack|remediation_decision_closeout_escalation_snooze|remediation_decision_closeout_escalation_resolve|remediation_decision_closeout_escalation_execution_show|remediation_decision_closeout_escalation_execution_export|remediation_decision_closeout_escalation_execution_copy"
done
```

### Актуализация этапа 3 стандартизации UI/UX (2026-02-16): `overview` + `commission`

- Выполнена текстовая унификация без изменения API/DOM-контрактов:
  - `backend/app/admin_overview_page.py`:
    - `10s (auto)` -> `10s (авто)`;
    - `Policy override` -> `Персональні override-и`;
    - `Notify-center` -> `Центр сповіщень`;
    - `open/acked/silenced` -> `відкриті/підтверджені/заглушені`.
  - `backend/app/admin_commission_page.py`:
    - унифицированы подписи toolbar/placeholder (`транспорту`, `IP central`, `door-1/door-2 IP`, `vehicle_id`, `номер`);
    - `Підставити vehicle` -> `Підставити vehicle_id`, `Скинути plate` -> `Скинути номер`;
    - `... + лінки` -> `... + посилання`;
    - `RUNS` -> `ПРОГОНИ`, `live` -> `наживо`, англоязычные service/alert/evidence тексты приведены к UA-first формату.
- Проверки:
  - `python3 -m py_compile backend/app/admin_overview_page.py backend/app/admin_commission_page.py` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --admin-pass-file "pass admin panel"` — PASS;
  - локальная render-проверка текстовых маркеров на `/admin` и `/admin/commission` — OK.

Следующий шаг (этап 4): финальный page-by-page marker/text audit по `/admin*` с перечнем остаточных расхождений для закрытия DoD единого UI/UX стандарта.

### Актуализация этапа 4 (2026-02-16): server-first copy cleanup `fleet/alerts/incidents`

- Выявлено и закрыто остаточное смешение терминов в mission/preset-подсказках:
  - `Preview кокпіта` -> `Попередній перегляд кокпіта`;
  - `Preview JSON пресетів` -> `Попередній перегляд JSON пресетів`;
  - `Кожна клітинка ... (open/acked/silenced)` -> `(... відкриті/підтверджені/заглушені)`.
- Изменённые файлы:
  - `backend/app/admin_fleet_page.py`
  - `backend/app/admin_fleet_alerts_page.py`
  - `backend/app/admin_fleet_incidents_page.py`
- Операционный контур: server-first (по требованию процесса):
  - `rsync` изменённых файлов в `/opt/passengers-backend/app/`;
  - на сервере: `python3 -m py_compile ...` + `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass-file "pass admin panel"` — PASS (все UI/API `200`, `no_errors_found`).
- Серверная проверка текстов:
  - через `grep` на VPS подтверждено отсутствие legacy-строк и наличие новых UA-first формулировок.

Следующий шаг (этап 4): пройти оставшиеся страницы (`notifications/notify-center/history/policy/wg/incident-detail`) тем же server-first audit-контуром и закрыть финальный residual-list.

### Актуализация этапа 4 (2026-02-16): server-first marker audit `notifications/notify-center/history/policy/wg/actions/audit`

- Проведён server-side аудит по маркерам `copyLink/filterSummary/flowStep/tableMeta` через `ssh + curl(127.0.0.1:8443)`:
  - на первом прогоне выявлено расхождение только на `/admin/fleet/notifications` (`filterSummary=0`).
- Исправление:
  - на VPS выкачен `backend/app/admin_fleet_notifications_page.py` (в серверный `app/admin_fleet_notifications_page.py`);
  - выполнены `python3 -m py_compile app/admin_fleet_notifications_page.py` и `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`.
- Повторный контроль:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - marker-audit: для `/admin/fleet/notifications`, `/admin/fleet/notify-center`, `/admin/fleet/history`, `/admin/fleet/policy`, `/admin/wg`, `/admin/fleet/actions`, `/admin/audit` получено `copyLink=1 filterSummary=1 flowStep=3 tableMeta=1`.

Следующий шаг (этап 4): закрыть динамические страницы (`/admin/fleet/central/{central_id}`, `/admin/fleet/incidents/{central_id}/{code}`) при появлении реальных данных и зафиксировать финальный DoD.

### Актуализация этапа 5 (2026-02-16): IA меню/подменю + минималистичный sidebar

- Реализована новая архитектура навигации в `backend/app/admin_ui_kit.py`:
  - 5 верхнеуровневых разделов: `Старт`, `Флот`, `Сповіщення`, `Контроль і KPI`, `Інфраструктура`;
  - внутри каждого раздела — подменю (2-й уровень) с явным визуальным отличием (`hub`/`sub`);
  - добавлен page-level subnav под header для активного раздела (быстрое переключение соседних страниц категории).
- Против визуальной перегрузки:
  - неактивные группы sidebar стартуют в `collapsed` состоянии;
  - в `Simple`-режиме скрывается `quick-jump` и вторичные блоки sidebar;
  - у подпунктов убраны “pin” кнопки, чтобы не шуметь UI.
- Операционный контур (server-first):
  - `rsync backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/`;
  - на сервере: `python3 -m py_compile app/admin_ui_kit.py` + `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.
- Серверная проверка рендера:
  - подтверждены новые маркеры IA (`sideLinkHub`, `sideLinkSub`, `pageSubnav`, `sideGroup collapsed`) на `/admin`, `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/notify-center`.

Следующий шаг (этап 6): разнести перегруженные блоки на страницах по новой IA (в первую очередь `fleet` и `notify-center`) и закрепить map “блок -> страница” в runbook.

### Актуализация этапа 6 (2026-02-16): Core + Domains (admin/client) и стратегия доработки

- На уровне кода принята доменная структура:
  - `backend/app/admin_core/navigation.py`
  - `backend/app/admin_domains/domain_catalog.py`
  - `backend/app/client_core/navigation.py` (scaffold)
  - `backend/app/client_domains/domain_catalog.py` (scaffold)
- `backend/app/admin_ui_kit.py` переведён на использование `admin_core` + `admin_domains` для IA-навигации и page-subnav.
- Операционный контур (server-first):
  - выкатка новых модулей и `admin_ui_kit.py` на VPS;
  - на сервере `py_compile` + `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.
- Документация:
  - добавлен стандарт архитектуры: `Docs/Проект/Веб-панель (ядро и домены).md`;
  - добавлен рабочий трек: `Docs/Проект/Операции/Стратегия доработки веб-панели (admin+client).md`;
  - обновлены ссылки и этапные документы.

Следующий шаг (этап 7): запустить content-split по доменам (сначала `fleet`, затем `notify-center`) и выделить отдельные page-модули под вторичные сценарии, чтобы снизить информационную плотность каждой страницы.

### Актуализация этапа 7 (2026-02-16): структурные стандарты по ядру и каждому домену

- Кодовая архитектура:
  - `backend/app/admin_domains/domain_catalog.py` расширен доменными метаданными (`doc_path`, `page_file`, `api_group`, `owner`);
  - `backend/app/client_domains/domain_catalog.py` синхронизирован по той же схеме;
  - добавлен inventory-скрипт `scripts/web_panel_domain_inventory.py` + автоотчёт `Docs/auto/web-panel/domain-inventory.md`.
- Документация (структурировано по ядру и доменам):
  - `Docs/Проект/Веб-панель/INDEX.md`
  - `Docs/Проект/Веб-панель/Ядро (Core).md`
  - `Docs/Проект/Веб-панель/Домен Старт.md`
  - `Docs/Проект/Веб-панель/Домен Флот.md`
  - `Docs/Проект/Веб-панель/Домен Сповіщення.md`
  - `Docs/Проект/Веб-панель/Домен Контроль и KPI.md`
  - `Docs/Проект/Веб-панель/Домен Інфраструктура.md`
  - `Docs/Проект/Веб-панель/Домен Клієнт.md`
  - `Docs/Проект/Операции/Стратегия доработки веб-панели (admin+client).md`
- Server-first проверки:
  - на сервере: `py_compile` по изменённым core/domain модулям;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.

Следующий шаг (этап 8): начать фактический content-split домена `Флот` (разнести вторичные блоки из `/admin/fleet` в соседние страницы домена), сохранив единый UI-контракт ядра.

### Актуализация этапа 8 (2026-02-16): content-split домена `Флот` (шаг 1)

- На `/admin/fleet` выполнено разделение первичного и вторичного сценариев:
  - primary: `Оперативний пріоритет` + `Центральні вузли`;
  - secondary: `Потік алертів` + `Оперативна стрічка подій` в `details#fleetSecondaryDetails`.
- Добавлено сохранение состояния secondary-блока:
  - `localStorage` key `passengers_admin_fleet_secondary_details_v1`.
- Изменённый файл:
  - `backend/app/admin_fleet_page.py`.
- Server-first проверки:
  - `py_compile app/admin_fleet_page.py`;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - серверный render-check `/admin/fleet`: маркеры `fleetSecondaryDetails` и storage-key присутствуют.

### Актуализация этапа 8 (2026-02-16): content-split домена `Сповіщення` (шаг 2)

- На `/admin/fleet/notify-center` выполнено разделение primary/secondary:
  - primary: `Оперативний огляд доставки` с агрегатами sent/failed/skipped/retryable;
  - secondary: детальный delivery-журнал и retry-операции в `details#notifySecondaryDetails`.
- Добавлено сохранение состояния secondary-блока:
  - `localStorage` key `passengers_admin_notify_secondary_details_v1`.
- Изменённый файл:
  - `backend/app/admin_fleet_notify_center_page.py`.
- Server-first проверки:
  - `py_compile app/admin_fleet_notify_center_page.py`;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - серверный render-check `/admin/fleet/notify-center`: маркеры `notifySecondaryDetails` и storage-key присутствуют.

### Актуализация этапа 8 (2026-02-16): content-split домена `Контроль і KPI` (шаг 3)

- На `/admin/fleet/policy` выполнено разделение primary/secondary:
  - primary: `Глобальна політика моніторингу` (пороги + авто-health);
  - secondary: `Персональні override-и` в `details#policySecondaryDetails`.
- Добавлено сохранение состояния secondary-блока:
  - `localStorage` key `passengers_admin_policy_secondary_details_v1`.
- Изменённый файл:
  - `backend/app/admin_fleet_policy_page.py`.
- Server-first проверки:
  - `py_compile app/admin_fleet_policy_page.py`;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - серверный render-check `/admin/fleet/policy`: маркеры `policySecondaryDetails` и storage-key присутствуют.

### Актуализация этапа 8 (2026-02-16): content-split домена `Інфраструктура` (шаг 4)

- На `/admin/wg` выполнено разделение primary/secondary:
  - primary: базовая peer-диагностика + агрегаты статусов;
  - secondary: серверный конфиг WireGuard в `details#wgSecondaryDetails`.
- Добавлено сохранение состояния secondary-блока:
  - `localStorage` key `passengers_admin_wg_secondary_details_v1`.
- Изменённый файл:
  - `backend/app/admin_wg_page.py`.
- Server-first проверки:
  - `py_compile app/admin_wg_page.py`;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - серверный render-check `/admin/wg`: маркеры `wgSecondaryDetails` и storage-key присутствуют.

Следующий шаг (этап 9): перейти к `Client Panel MVP` — выделить отдельный client-shell и первичную IA клиентских страниц.

### Актуализация этапа 9 (2026-02-16): Client Panel MVP step-1 (shell + IA + route)

- В backend добавлен отдельный клиентский контур:
  - `backend/app/client_ui_kit.py` (client shell);
  - `backend/app/client_*_page.py` (overview/vehicles/tickets/status/profile/notifications);
  - `backend/app/main.py` route: `/client*`.
- Доменная карта клиента синхронизирована:
  - `backend/app/client_domains/domain_catalog.py` (заполнены `page_file`).
- Инфраструктурный доступ через nginx:
  - `server/nginx/passengers-admin.conf` расширен location `/client` (под BasicAuth, как внутренний MVP-контур до ввода отдельной клиентской auth-модели).
- Server-first проверки:
  - `py_compile` по `main.py`, `client_ui_kit.py`, `client_*_page.py`, `client_domains/domain_catalog.py`;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS (включая `/client*`);
  - render-check `/client*`: маркеры `clientShell`/`ClientUiKit` присутствуют, `anon=401`, `auth=200`.

Следующий шаг (этап 10): Client MVP step-2 — подключить реальные клиентские API-данные и определить минимальный auth-контур клиента.

### Актуализация этапа 10 (2026-02-16): `Client MVP step-2` (server-first)

- Выполнено в backend:
  - добавлен модуль `backend/app/client_ops.py`;
  - добавлены API route `/api/client/*` в `backend/app/main.py`:
    - `whoami`, `home`, `vehicles`, `tickets`, `status`, `profile`, `notification-settings`;
  - добавлены таблицы в `backend/app/db.py`:
    - `client_profiles`, `client_notification_settings`.
- Выполнено в UI клиента:
  - `client_*_page.py` переведены с mock/localStorage на backend API.
- Выполнено в nginx:
  - `server/nginx/passengers-admin.conf` расширен `location ^~ /api/client/`;
  - для `/api/client/*` включён `Authorization: Bearer $passengers_client_api_token` + `X-Client-User`.
- Выполнено в gate:
  - `scripts/admin_panel_smoke_gate.sh` расширен endpoint-ами `/api/client/*`.
- Server-first проверки:
  - `py_compile` на VPS по изменённым модулям — OK;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - публичная проверка: `/client` и `/api/client/*` дают `auth=200`, `anon=401`.

Следующий шаг: `Client MVP step-3` — доработка IA/UX и mobile плотности для доменов `tickets/status` без визуальной перегрузки.

### Актуализация этапа 11 (2026-02-16): `Client MVP step-3` (IA/UX polish)

- Core:
  - `backend/app/client_ui_kit.py` расширен reusable secondary-паттерном:
    - `.secondaryDetails`;
    - `ClientUiKit.bindDetailsState(id, storageKey, defaultOpen)`.
- Domain pages:
  - `backend/app/client_tickets_page.py`:
    - primary блок `Активні звернення`;
    - secondary блок `Архів вирішених звернень` (`<details>` + localStorage).
  - `backend/app/client_status_page.py`:
    - primary блок `Потребує уваги зараз`;
    - secondary блок `Повна стрічка статусів` (`<details>` + localStorage).
- UX:
  - сохранены `copyLink` + shareable URL фильтров (`q`, `level` для status).
- Server-first проверки:
  - `py_compile` локально и на VPS — OK;
  - deploy: `docker compose -f compose.yaml -f compose.server.yaml up -d --build api` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.

Следующий шаг: `Client MVP step-4` — роль `admin-support` и mobile-тюнинг таблиц клиентского контура.

### Актуализация этапа 12 (2026-02-16): `Client MVP step-4` (role + mobile)

- Backend:
  - `backend/app/main.py`: добавлен role-контур `admin-support` для client (`CLIENT_SUPPORT_USERS`, `whoami.role`).
  - `backend/.env.example`: добавлен `CLIENT_SUPPORT_USERS`.
- Client Core:
  - `backend/app/client_ui_kit.py`: `loadWhoami()`, mobile-first таблицы (`mobileFriendly/mobileHide`), mobile toolbar flow.
- Client pages:
  - `backend/app/client_home_page.py`: role-chip + режимная подсказка (`client/admin-support`).
  - `backend/app/client_tickets_page.py`: role-chip, support-aware default secondary state, mobile table columns.
  - `backend/app/client_status_page.py`: role-chip, support-aware default secondary state, mobile table columns.
- Server-first проверки:
  - deploy на VPS + `py_compile` + `docker compose ... --build api` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.

Следующий шаг: `Client MVP step-5` — структурировать `home/vehicles` по SLA/ETA сценариям и завершить client UX-polish.

### Актуализация этапа 13 (2026-02-16): `Client MVP step-5` (SLA/ETA scenarios)

- Backend:
  - `backend/app/client_ops.py`:
    - добавлены SLA/ETA helpers (`_estimate_eta_delay_min`, `_resolve_sla_state`, `_to_int`);
    - `home.summary` расширен полями `sla_risk/sla_warn/eta_avg_delay_min/eta_max_delay_min`;
    - `home.attention` возвращает short-list транспортов с SLA-отклонением;
    - `vehicles` возвращает `sla_state`, `eta_delay_min`, `pending_batches`, `incidents_open` + SLA/ETA summary.
- Client pages:
  - `backend/app/client_home_page.py`:
    - добавлены KPI-чипы `SLA` и `ETA`;
    - добавлен primary-блок `Потребує дії зараз`.
  - `backend/app/client_vehicles_page.py`:
    - добавлен SLA-фильтр (`all/attention/risk/warn/ok`);
    - primary-блок `Потребують уваги`;
    - secondary-блок `Усі транспорти` (`<details>` + persisted state, role-aware default).
- Server-first проверки:
  - `python3 -m py_compile backend/app/client_ops.py backend/app/client_home_page.py backend/app/client_vehicles_page.py` — OK;
  - deploy на VPS + `python3 -m py_compile app/client_ops.py app/client_home_page.py app/client_vehicles_page.py` — OK;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.

Следующий шаг: `Client MVP step-6` — role-aware сценарии `Профіль/Сповіщення` и финальный e2e UX-runbook клиентского контура.

### Актуализация этапа 14 (2026-02-16): `Client MVP step-6` (account role-aware + e2e)

- Client pages:
  - `backend/app/client_profile_page.py`:
    - role-chip, summary (`ПРОФІЛЬ/КОНТАКТ/МОВА`), support-secondary (`profileSupportDetails`);
    - reset теперь восстанавливает последнюю сохранённую версию (без destructive очистки).
  - `backend/app/client_notifications_page.py`:
    - role-chip, summary (`КАНАЛИ/ПРІОРИТЕТ/ДАЙДЖЕСТ`);
    - добавлены quick presets `critical/balanced/realtime`;
    - support-secondary (`notifySupportDetails`) с payload preview.
- Server-first проверки:
  - `python3 -m py_compile backend/app/client_profile_page.py backend/app/client_notifications_page.py` — OK;
  - deploy на VPS + `python3 -m py_compile app/client_profile_page.py app/client_notifications_page.py` — OK;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.
- E2E runbook (account contour):
  - page-marker check:
    - `/client/profile`: `whoami|profileSupportDetails|passengers_client_profile_secondary_v1|copySupport`;
    - `/client/notifications`: `whoami|notifySupportDetails|presetCritical|passengers_client_notifications_secondary_v1|copySupport`;
  - API check: `/api/client/profile`, `/api/client/notification-settings` = `200` под BasicAuth.

Следующий шаг: `Client MVP step-7` — финальный UX-audit client-контура на реальных данных и регрессионный checklist.

### Актуализация этапа 15 (2026-02-16): `Client MVP step-7a` (automated regression check)

- Добавлен script:
  - `scripts/client_panel_regression_check.sh`.
- Script покрывает:
  - auth/anon проверки (`200/401`) для `/client/profile`, `/client/notifications`,
    `/api/client/profile`, `/api/client/notification-settings`;
  - marker-проверки role-aware/account элементов на `/client/profile|/client/notifications`;
  - базовую валидацию payload (`status=ok`) для account API.
- Прогон:
  - `./scripts/client_panel_regression_check.sh --admin-pass-file "pass admin panel"` — `RESULT: PASS`.

Следующий шаг: `Client MVP step-7b` — провести финальный real-data UX-аудит и зафиксировать итоговый регрессионный checklist в паспорте релиза.

### Актуализация этапа 16 (2026-02-16): `Client MVP step-7b` (real-data UX audit)

- Добавлен script:
  - `scripts/client_panel_step7b_audit.py`.
- Script формирует итоговый real-data audit report:
  - `Docs/auto/web-panel/client-step7b-ux-audit.md`.
- Покрытие:
  - auth/anon (`200/401`) для client UI/API;
  - contract-check ключевых API (`whoami/home/vehicles/profile/notification-settings`);
  - marker-check role-aware account UX (`profile/notifications`).
- Прогон:
  - `python3 scripts/client_panel_step7b_audit.py --admin-pass-file "pass admin panel" --write Docs/auto/web-panel/client-step7b-ux-audit.md` — `RESULT: PASS`.

Следующий шаг: `Client MVP step-8` — операторский приемочный прогон клиентского UX по сценариям поддержки (admin-support playbook).

### Актуализация этапа 17 (2026-02-16): `Client MVP step-8a` (support playbook)

- Добавлен операционный документ:
  - `Docs/Проект/Операции/Client admin-support playbook.md`.
- В playbook зафиксированы:
  - preflight (`smoke_gate`, `client_panel_regression_check`, `client_panel_step7b_audit`);
  - сценарий `client`;
  - сценарий `admin-support` (через `CLIENT_SUPPORT_USERS`);
  - rollback к базовому `client` режиму.
- Текущее серверное baseline-состояние:
  - `/api/client/whoami` → `role=client`, `support_console=false` (на 2026-02-16).

Следующий шаг: `Client MVP step-8b` — выполнить acceptance-прогон playbook в режиме `admin-support` и зафиксировать результат.

### Актуализация этапа 18 (2026-02-16): `Client MVP step-8b` (support acceptance + rollback)

- На сервере выполнен controlled acceptance-run:
  - временно выставлен `CLIENT_SUPPORT_USERS=admin` в `/opt/passengers-backend/.env`;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`.
- Проверка support-режима:
  - `/api/client/whoami` -> `role=admin-support`, `support_console=true`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh` — PASS;
  - `scripts/client_panel_step7b_audit.py` — PASS.
- Rollback:
  - восстановлен backup `.env.step8b.20260216162039.bak`;
  - API пересобран тем же compose-cycle;
  - `/api/client/whoami` -> `role=client`;
  - повторный `scripts/admin_panel_smoke_gate.sh` — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step8b-support-acceptance.md`.

Следующий шаг: `Client MVP step-9` — оформить постоянный rollout support-логинов (`CLIENT_SUPPORT_USERS`) и исключить использование `admin` для support-сценариев.

### Актуализация этапа 19 (2026-02-16): `Client MVP step-9` (dedicated support rollout)

- Infra/Auth:
  - `server/nginx/passengers-admin.conf` переведён на split auth:
    - `/client*`, `/api/client/*` -> `/etc/nginx/passengers-client.htpasswd`;
    - `/admin*`, `/api/admin/*` -> `/etc/nginx/passengers-admin.htpasswd`.
  - `scripts/server_security_posture_check.sh` дополнен проверкой `NGINX_CLIENT_AUTH_FILE`.
  - `scripts/install_server_admin_hardening.sh` теперь подготавливает `/etc/nginx/passengers-client.htpasswd`.
- Rollout tool:
  - `scripts/client_support_rollout.sh` (создание/обновление support-user, env+nginx deploy, валидация доступа).
- Server rollout:
  - создан support login `support` (пароль в локальном файле `pass client support panel`);
  - установлен `CLIENT_SUPPORT_USERS=support`.
- Проверки:
  - `support` -> `/api/client/whoami`: `200`, `role=admin-support`;
  - `support` -> `/api/admin/whoami`: `401`;
  - `admin` -> `/api/client/whoami`: `200`, `role=client`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh` (admin/support) — PASS;
  - `scripts/client_panel_step7b_audit.py` (support) — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step9-support-rollout.md`.

Следующий шаг: `Client MVP step-10` — масштабировать support-контур на несколько логинов и закрепить `CLIENT_SCOPE_BINDINGS` по клиентам.

### Актуализация этапа 20 (2026-02-16): `Client MVP step-10` (support scope isolation)

- Добавлен script:
  - `scripts/client_scope_rollout.sh`.
- Server rollout:
  - применён `CLIENT_SCOPE_BINDINGS=support:sys-0001`.
- Проверки:
  - `/api/client/whoami` (support) -> `scope.central_ids=["sys-0001"]`;
  - `/api/client/vehicles` (support) -> `total=1` (только scoped central);
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support ...` — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step10-scope-rollout.md`.

Следующий шаг: `Client MVP step-11` — подготовить policy-шаблон для multi-support onboarding (`support-<system_id>` + scope binding matrix).

### Актуализация этапа 21 (2026-02-16): `Client MVP step-11` (multi-support onboarding policy)

- Добавлен script:
  - `scripts/client_support_matrix_rollout.sh`.
- Добавлен template:
  - `Docs/Проект/Операции/client-support-onboarding-matrix.example`.
- Server rollout:
  - применён actor `support-sys-0001`;
  - `CLIENT_SUPPORT_USERS=support-sys-0001`;
  - `CLIENT_SCOPE_BINDINGS=support-sys-0001:sys-0001`;
  - legacy `support` удалён из `/etc/nginx/passengers-client.htpasswd`.
- Проверки:
  - `support-sys-0001` -> `/api/client/whoami`: `role=admin-support`, `scope.central_ids=["sys-0001"]`;
  - `support-sys-0001` -> `/api/admin/whoami`: `401`;
  - `scripts/client_panel_regression_check.sh` (admin/support-sys-0001) — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step11-multi-support-onboarding.md`.

Следующий шаг: `Client MVP step-12` — lifecycle policy `disable/rotate/revoke` support-акторов без downtime.

### Актуализация этапа 22 (2026-02-16): `Client MVP step-12` (support actor lifecycle)

- Добавлен script:
  - `scripts/client_support_lifecycle_rollout.sh`.
- Controlled scenario на сервере:
  - через matrix rollout добавлен временный actor `support-sys-0099`;
  - выполнен `rotate` (старый пароль стал невалидным, новый валиден);
  - выполнен `disable` (actor удалён из `CLIENT_SUPPORT_USERS` + htpasswd);
  - выполнен `revoke` (actor удалён из `CLIENT_SCOPE_BINDINGS`).
- Финальный state:
  - `CLIENT_SUPPORT_USERS=support-sys-0001`;
  - `CLIENT_SCOPE_BINDINGS=support-sys-0001:sys-0001`;
  - `support-sys-0001` остаётся активным support actor.
- Проверки:
  - lifecycle script (`rotate/disable/revoke`) — PASS;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step12-support-lifecycle-rollout.md`.

Следующий шаг: `Client MVP step-13` — automation pack для lifecycle (rotation schedule + actor inventory report).

### Актуализация этапа 23 (2026-02-16): `Client MVP step-13` (lifecycle automation pack)

- Добавлены scripts:
  - `scripts/client_support_rotation_batch.sh`;
  - `scripts/client_support_inventory_report.sh`;
  - `scripts/install_client_support_lifecycle_timer.sh`.
- Server execution:
  - выполнен batch rotate для `support-sys-0001` (old pass revoked, new pass active);
  - установлены timers:
    - `passengers-client-support-inventory.timer` (daily);
    - `passengers-client-support-rotation-reminder.timer` (monthly).
- Проверки:
  - `scripts/client_support_rotation_batch.sh` — PASS;
  - `scripts/client_support_inventory_report.sh` (`status=PASS`) — PASS;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step13-lifecycle-automation-pack.md`;
  - `Docs/auto/web-panel/client-support-inventory-latest.md`.

Следующий шаг: `Client MVP step-14` — UX polish client navigation и progressive disclosure.

### Актуализация этапа 24 (2026-02-16): `Client MVP step-14` (UX polish navigation + progressive disclosure)

- Выполнен server-first rollout client UX-polish:
  - `backend/app/client_ui_kit.py`:
    - внедрён `sideCompact` режим с persistent state;
    - sidebar переведён в grouped `<details>` (`меню -> подменю`) с persistent open-state групп;
    - добавлен global progressive-mode для таблиц (`tablesProgressiveOff` + toggle `Колонки: базово/детально`).
  - `backend/app/client_home_page.py`, `backend/app/client_vehicles_page.py`, `backend/app/client_tickets_page.py`, `backend/app/client_status_page.py`:
    - добавлен toolbar toggle таблиц;
    - secondary колонки переведены в `progressiveCol`.
- Server rollout:
  - `rsync` обновлённых `client_*` модулей в `/opt/passengers-backend/app`;
  - `py_compile` изменённых модулей на сервере;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`.
- Проверки:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ... --write Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step14.md` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step14-ux-polish-rollout.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step14.md`.

Следующий шаг: `Client MVP step-15` — accessibility/keyboard flow + финальный copy-audit клиентского shell без изменения API.

### Актуализация этапа 25 (2026-02-16): `Client MVP step-15` (a11y + keyboard flow + copy audit)

- Выполнен accessibility baseline client shell:
  - добавлен skip-link `Перейти до основного контенту` (`#clientMainContent`);
  - добавлен `:focus-visible` контур и `aria-live` для status-подсказок;
  - sidebar получил `aria-label` и явную keyboard-памятку.
- Внедрён keyboard flow:
  - `/` -> фокус в первый toolbar search/text/select;
  - `Esc` -> blur активного editable поля;
  - `Alt+Shift+M` -> toggle compact sidebar;
  - `Alt+Shift+K` -> toggle progressive columns;
  - `Alt+Shift+S` -> фокус на активный пункт sidebar;
  - `Alt+Shift+T` -> фокус на первое toolbar-действие.
- Выполнен copy-audit account-домена:
  - локализованы labels/summary для `Профіль` и `Сповіщення`;
  - `Preset:*` заменены на `Шаблон:*`.
- Обновлены regression/audit маркеры:
  - `scripts/client_panel_regression_check.sh` и `scripts/client_panel_step7b_audit.py` теперь проверяют `skipLink`, `sideCompactToggle`, `clientMainContent`.
- Server rollout:
  - `rsync` обновлённых `client_*` модулей в `/opt/passengers-backend/app`;
  - `py_compile` на сервере;
  - `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`.
- Проверки:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ... --write Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step15.md` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step15-a11y-keyboard-copy-rollout.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step15.md`.

Следующий шаг: `Client MVP step-16` — operator accessibility-acceptance (keyboard-only сценарии) и фиксация финального DoD client shell.

### Актуализация этапа 26 (2026-02-16): `Client MVP step-16` (keyboard-only acceptance + final DoD)

- Добавлен acceptance script:
  - `scripts/client_panel_step16_accessibility_check.sh`.
- Script покрывает:
  - auth/anon для ключевых client endpoints;
  - role-check (`admin-support`);
  - shell a11y/keyboard markers (`skipLink`, `sideCompactToggle`, `clientMainContent`, keyboard shortcuts);
  - copy markers account-домена (`Профіль/Сповіщення`).
- Выполнен операторский acceptance run:
  - `./scripts/client_panel_step16_accessibility_check.sh --admin-user support-sys-0001 --admin-pass-file "pass client support sys-0001 panel step13-rotated" --write Docs/auto/web-panel/client-step16-accessibility-acceptance.md` — PASS.
- Дополнительные server-first проверки:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ... --write Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step16.md` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Финальный DoD client shell зафиксирован:
  - IA (`меню -> подменю`) + compact/progressive persistence;
  - role-aware account UX;
  - keyboard-first accessibility baseline.
- Артефакты:
  - `Docs/auto/web-panel/client-step16-accessibility-acceptance.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step16.md`.

Следующий шаг: `Client MVP step-17` — release-candidate stabilization и финальный handoff checklist.

### Актуализация этапа 27 (2026-02-16): `Client MVP step-17` (RC IA freeze kickoff)

- Зафиксирован каноничный IA-документ меню/подменю:
  - `Docs/Проект/Веб-панель/Архитектура меню (admin+client).md`.
- Обновлены индексные ссылки и runbook:
  - `Docs/Проект/INDEX.md`;
  - `Docs/Проект/Операции.md`;
  - `Docs/Проект/Операции/Client admin-support playbook.md`;
  - `Docs/Проект/Операции/Сервер backend и VPN.md`.
- Повторный server-first контроль:
  - `scripts/client_panel_step16_accessibility_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакт kickoff:
  - `Docs/auto/web-panel/client-step17-rc-kickoff.md`.

Следующий шаг: `Client MVP step-17` — собрать финальный handoff checklist и закрыть release-candidate stabilization.

### Актуализация этапа 28 (2026-02-16): `Client MVP step-17` (handoff checklist automation, done)

- Добавлен единый RC/handoff script:
  - `scripts/client_panel_step17_handoff_check.sh`.
- Script выполняет одним прогоном:
  - `ssh+sudo` доступ к серверу;
  - `step-16 accessibility acceptance`;
  - `admin smoke gate`;
  - `client regression check`;
  - `client step7b audit`;
  - `server security posture`.
- Результат выполнения:
  - `./scripts/client_panel_step17_handoff_check.sh --write Docs/auto/web-panel/client-step17-handoff-checklist.md` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step17-handoff-checklist.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step17.md`.

Следующий шаг: `Client MVP step-18` — инкрементальный content-split по IA freeze и финальный visual-density аудит.
