# Домен Флот

## Назначение

Операционный контур администратора: состояние флота, алерты, инциденты, действия.

## Route scope

- `/admin/fleet` (v1)
- `/admin/fleet/alerts` (v1)
- `/admin/fleet/incidents` (v1)
- `/admin/fleet/actions` (v1)

- `/admin2/fleet` (v2)
- `/admin2/fleet/alerts` (v2)
- `/admin2/fleet/incidents` (v2)
- `/admin2/fleet/actions` (v2)
- `/admin2/_fragment/fleet/monitor` (v2, HTMX HTML fragment для `/admin2/fleet`)

## API scope

- `/api/admin/fleet/monitor`
- `/api/admin/fleet/alerts`
- `/api/admin/fleet/alerts/groups`
- `/api/admin/fleet/incidents`
- `/api/admin/fleet/alerts/actions`

## UX-контракт домена

1. Приоритет риска сверху (bad/warn first).
2. Массовые действия только в action-области с явным результатом.
3. Тексты действий унифицированы: `Підтвердити`, `Пауза 1 год`, `Зняти заглушення`.

## Ограничения

- не смешивать в одной странице глубинную аналитику и оперативный triage;
- policy-настройки и history вынесены в домен `Контроль і KPI`.

## Definition of Done

1. Все route домена отвечают `200`.
2. Shareable URLs синхронизируют фильтры.
3. После действий нет потери контекста фильтров.

## Прогресс content-split (2026-02-16)

- `/admin/fleet` разгружен по сценарию:
  - первичный контур (приоритет + центральные узлы) остаётся видимым сразу;
  - вторичный анализ (`Потік алертів`, `Оперативна стрічка подій`) перенесён в сворачиваемый блок `Вторинна аналітика`.
- Состояние раскрытия вторичного блока сохраняется локально:
  - key: `passengers_admin_fleet_secondary_details_v1`.
- UX-эффект:
  - меньше визуальной перегрузки стартового экрана;
  - быстрый переход в профильные страницы домена (`/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/fleet/actions`, `/admin/fleet/notify-center`).

## Прогресс visual polish (2026-02-17)

- `/admin/fleet/alerts` разгружен по паттерну `primary + secondary`:
  - primary: оперативный список алертів + bulk actions;
  - secondary: “Групи алертів за кодом” (агрегация и действия по коду) вынесены в `<details>`.
- Состояние secondary сохраняется локально:
  - key: `passengers_admin_alerts_secondary_details_v1`.

- `/admin/fleet/incidents` разгружен по паттерну `primary + secondary`:
  - secondary: аналитика SLA heatmap + delivery journal вынесены в `<details>` (persistent).
  - key: `passengers_admin_incidents_secondary_details_v1`.

- `/admin/fleet/incidents` доведен по visual-density:
  - advanced tools (пресеты/кокпіт/rollout) винесені в secondary `<details>` (persistent):
    - key: `passengers_admin_incidents_tools_details_v1`.
  - delivery journal в secondary без зайвої вкладеної card (менше візуального шуму).

- `/admin/fleet/actions` доведен по visual-density:
  - фильтры вынесены в advanced `<details class="toolbarDetails">`, primary toolbar оставляет действия;
  - добавлен `tableMeta` с источником `/api/admin/fleet/alerts/actions` и `limit=500`.

- `/admin/fleet/central/{central_id}` доведен по visual-density:
  - history + журнал дій вынесены в secondary `<details>` (persistent):
    - key: `passengers_admin_fleet_central_secondary_details_v1`.
  - добавлены `tableMeta` для primary и secondary контуров (явные источники данных).

- `/admin/fleet/incidents/{central_id}/{code}` доведен по visual-density:
  - declutter toolbar (роль/оновлено в header chips);
  - повідомлення винесено в advanced `<details>` (плюс короткая строка в primary);
  - debug payload винесен в secondary `<details class="domainSplitDetails" data-advanced-details="1">`.

- `/admin/fleet` доведен по visual-density:
  - advanced tools (пресети/cockpit/rollout) винесені в secondary `<details>` (persistent):
    - key: `passengers_admin_fleet_tools_details_v1`.
  - secondary analytics помечена `data-advanced-details="1"` (Simple-mode схлопывает).
