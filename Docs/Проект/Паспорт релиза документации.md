# Паспорт релиза документации

## Идентификатор

- Версия: `docs-2026-02-09-r2`
- Дата: `2026-02-09`
- Контекст: переход на модульную архитектуру docs перед дальнейшей доработкой сервера и внедрением модулей камеры/GPS/RTC/LTE.

## Что изменено

1. Введена архитектура документации и правила governance:
- `Docs/Проект/Документация (архитектура и правила).md`
- `Docs/Проект/Шаблон документа модуля.md`

2. Перестроен верхний индекс:
- `Docs/Проект/INDEX.md`
- добавлены быстрые маршруты, блок управления docs, ссылки на prompt-packs.

3. Выполнена модульная декомпозиция ключевых больших документов:
- `Docs/Проект/Модули.md` + каталог `Docs/Проект/Модули/`
- `Docs/Проект/Операции.md` + каталог `Docs/Проект/Операции/`
- `Docs/Проект/Проблемы.md` + каталог `Docs/Проект/Проблемы/`

4. Полные исторические версии сохранены:
- `Docs/Проект/Модули (подробно).md`
- `Docs/Проект/Операции (подробно).md`
- `Docs/Проект/Проблемы (подробно).md`

5. Расширены workflow-инструменты:
- `Docs/Проект/Промпты Codex (документация).md`
- `skills/orangepi-passengers-doc-architecture/SKILL.md`

## Инварианты, подтверждённые релизом

- Канон `door_id ↔ hostname ↔ IP` не изменён.
- Правило масштаба `system_id = central_id` сохранено.
- Режим текущего этапа: `MVP baseline` без камер/модулей.

## Проверки релиза

- Навигационные ссылки в `Docs/Проект/INDEX.md` существуют.
- Ключевые ссылки присутствуют в `README.md` и `Docs/Проект/Скиллы Codex.md`.
- Структура `Docs/Проект` разделена на модульные папки.

## Что дальше

1. Сервер: следующий этап hardening/операционализации (posture check + улучшения).
2. Docs: после каждого server/UI этапа обновлять модульные runbook-файлы и текущий паспорт релиза.

## Выполнено после релиза (server baseline hardening)

- Добавлен единый серверный аудит: `scripts/server_security_posture_check.sh`.
- Усилен nginx-конфиг админки security-заголовками на `location /admin` и `/api/admin`.
- Факт проверки на сервере `207.180.213.225`: `summary: failed=0 total=14`.
- Включён периодический server posture timer:
  - `scripts/install_server_security_posture_timer.sh`
  - `server/health/passengers-security-posture.service`
  - `server/health/passengers-security-posture.timer`
  - отчёт: `/opt/passengers-backend/ops-reports/security-posture-latest.json`

## Выполнено после релиза (admin UI phase-23)

- Реализован golden shell с левым меню для модульных страниц через `render_admin_shell(..., current_nav=...)`.
- Sidebar внедрён на страницах `fleet/alerts/incidents/policy/notifications/actions/audit/history`.
- Smoke после выкладки: `scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`).

## Выполнено после релиза (admin UI sidebar UX modes, 2026-02-14)

- В sidebar добавлен режим `Просто/Розширено` (persisted через `localStorage`) для “чистой” навигации без перегруженных блоков.
- Переведены ключевые подписи sidebar на украинский (UA-first), чтобы админка была читаемой на старте.
- `scripts/admin_panel_smoke_gate.sh` теперь работает без зависимости от `rg` (fallback на `grep`).

## Выполнено после релиза (admin UI: сворачиваемые фильтры и advanced tools, 2026-02-14)

- На страницах `fleet/alerts/incidents` вынесены “доп. фильтры” в `<details>` (`Фільтри`) — header стал заметно чище.
- “Розширені інструменти (контекст / пресети)” свернуты по умолчанию и автоматически раскрываются при `Розширено` (sidebar).
- UA-first: кнопки `Preview/Cockpit/Unlock/Lock/Cleanup` переведены в UI, без изменения логики.
- Smoke-gate на VPS: PASS (все UI/API `200`, `no_errors_found`).

## Выполнено после релиза (admin UI: UA copy cleanup, 2026-02-14)

- Донастроена UA-копия в подсказках/состояниях пресетов и командной палитре (policy/cockpit/rollout тексты), чтобы не было “смешанного” языка.
- Sidebar (advanced): подписи response-pack/delivery/routing переведены в UA.
- Smoke-gate на VPS: PASS.

## Выполнено после релиза (admin UI: shareable URLs для фильтров, 2026-02-14)

- На страницах `fleet/alerts/incidents` фильтры теперь читаются из query string и обновляют URL через `history.replaceState`.
- Можно копировать URL и получать те же фильтры при открытии (удобно для масштаба 100–200 систем).
- Smoke-gate на VPS: PASS.

## Выполнено после релиза (admin UI: кнопка “Скопіювати посилання” + резюме фильтров, 2026-02-14)

- В header на страницах `fleet/alerts/incidents` добавлена кнопка `Скопіювати посилання` (копирует текущий URL с фильтрами).
- Добавлен видимый в header `фільтри: ...` summary, чтобы оператор видел активные фильтры без открытия `Фільтри`.
- Для унификации копирования в `AdminUiKit` экспортирован helper `copyTextWithFallback`.

## Выполнено после релиза (admin UI: shareable URLs для audit/actions, 2026-02-14)

- На страницах `fleet/actions` и `audit` фильтры читаются из query string и синхронизируют URL через `history.replaceState`.
- Добавлены `Скопіювати посилання` + `фільтри: ...` summary в header этих страниц.

## Выполнено после релиза (admin UI: shareable URLs + CopyLink для notify-center/history/policy/wg, 2026-02-15)

- На страницах `notify-center` і `history` додано shareable URLs (query string ↔ фільтри) + `Скопіювати посилання` + `фільтри: ...`.
- На сторінці `policy` додано shareable контекст `central_id` (prefill override) + `Скопіювати посилання` + `контекст: ...`.
- `/admin/wg` винесено в модульну сторінку (`render_admin_shell`) і додано `q` у query string + CopyLink + `фільтри: ...`.
- `scripts/admin_panel_smoke_gate.sh` розширено перевіркою `/admin/wg` + `/api/admin/wg/*`.

## Выполнено после релиза (admin UI: central detail page shell migration, 2026-02-15)

- `/admin/fleet/central/{central_id}` винесено з `main.py` у `backend/app/admin_fleet_central_page.py` на `render_admin_shell`.
- Додано `Скопіювати посилання` + `вузол: ...` summary та швидкі переходи в `policy override` / `notify-center` з підставленим `central_id`.

## Выполнено после релиза (admin UI: overview page shell migration, 2026-02-15)

- `/admin` (Огляд) винесено з `main.py` у `backend/app/admin_overview_page.py` на `render_admin_shell`.
- Додано shareable URL `q` + `Скопіювати посилання` + `фільтри: ...` summary.

## Выполнено после релиза (admin UI: incident detail CopyLink, 2026-02-15)

- На сторінці `/admin/fleet/incidents/{central_id}/{code}` додано `Скопіювати посилання` + `інцидент: ...` summary в header.
- `scripts/admin_panel_smoke_gate.sh` тепер має optional dynamic-check для incident detail (якщо в БД є інциденти).
- `scripts/admin_panel_smoke_gate.sh` додано warmup-loop по `/api/admin/whoami`, щоб уникати фальшивих `502` від nginx після `docker compose up -d --build`.

## Выполнено після релізу (admin UI: `/admin` empty-state checklist, 2026-02-15)

- На `/admin` додано видимий empty-state (коли `centrals=0`): чекліст підйому першого transport/central + CTA на `WireGuard/Флот/Інциденти`.
- Порожні таблиці (`SLA/Потребує дій/Алерти`) тепер мають окремі повідомлення для стану “без даних” vs “фільтр нічого не знайшов”.
- В empty-state додано швидкий блок `WireGuard статус` (агрегація по `/api/admin/wg/peers`), щоб відразу бачити: є handshake чи ні.

## Выполнено после релиза (camera depth-counting calibration step)

- Добавлен helper калибровки: `scripts/camera_depth_calibrate.sh`.
- Интерактивное меню расширено пунктами:
  - `16` calibration helper;
  - `17` health snapshot x5.
- Добавлен project skill:
  - `skills/orangepi-passengers-camera-calibration/SKILL.md`.
- Обновлены профильные документы:
  - `Docs/Проект/Операции/Камера OAK-D Lite (Luxonis).md`
  - `Docs/Проект/Модули/Central (шлюз).md`
  - `Docs/Проект/Документация (архитектура и правила).md`
  - `Docs/Проект/Скиллы Codex.md`
  - `README.md`
- Зафиксировано обязательное governance-правило: после каждой доработки сразу обновлять docs и всегда фиксировать следующий этап + зачем.

## Выполнено после релиза (camera IMU diagnostics in depth-counting)

- В `mvp/camera_depth_people_counting.py` добавлен IMU-поток (BMI270: accel+gyro) в том же сервисе depth-counting.
- `/health` расширен полями `imu_*` (`imu_type`, `imu_updates`, `imu_accel_*`, `imu_gyro_*`).
- Web-страница `http://127.0.0.1:8091/` расширена IMU-блоком под live-статистику.
- В env defaults добавлены `CAM_IMU_ENABLE`, `CAM_IMU_RATE_HZ` (`camera_mode_switch`, `install_central_camera_counter`).
- Обновлены runbook/docs:
  - `Docs/Проект/Операции/Камера OAK-D Lite (Luxonis).md`
  - `Docs/Проект/Модули/Central (шлюз).md`
  - `README.md`
  - `skills/orangepi-passengers-camera-calibration/SKILL.md`

## Выполнено после релиза (camera preflight after reboot)

- В `scripts/camera_mode_switch.sh` для `debug-stream` и `depth-counting` добавлен `--skip-time-sync` в `ExecStartPre`, чтобы камеры стартовали после ребута без ожидания NTP.
- Обновлены runbook и troubleshooting:
  - `Docs/Проект/Операции/Камера OAK-D Lite (Luxonis).md`
  - `Docs/Проект/Проблемы/OPi и ОС.md`

## Выполнено после релиза (admin UI: commissioning shortcuts on `/admin`, 2026-02-15)

- На `/admin` добавлена commissioning-карточка:
  - поле `central_id` (рекомендовано `sys-XXXX`) + быстрые ссылки на `вузол/інциденти/policy/notify-center`;
  - `Копіювати набір` копирует набор абсолютных URL для commissioning одного транспорта.
- `/admin` теперь поддерживает query-параметр `central_id` (shareable URL) — удобно для повторяемого ввода/commissioning.
- Под полем `central_id` показываются кликабельные WG peers (по `/api/admin/wg/peers`) с возрастом handshake — можно подставить `central_id` в один клик даже до появления heartbeat.

## Выполнено после релиза (ops: фиксация deploy-команды compose overlay, 2026-02-15)

- Зафиксировано в runbook/траблшутинге: backend на VPS нужно поднимать через `docker compose -f compose.yaml -f compose.server.yaml ...`.
- Причина: без `compose.server.yaml` пропадает port mapping `10.66.0.1:80 -> 8000`, nginx начинает отдавать `502 Bad Gateway` (upstream connection refused).

## Выполнено после релиза (admin UI: `/admin/commission` onboarding page, 2026-02-15)

- Добавлена новая страница `/admin/commission`:
  - ввод `central_id` + подсказка/валидация формата `sys-XXXX`;
  - генерация “копіпаст” команд (API keys → bundle → WG peer → env на central → fleet_commission → smoke-gate админки);
  - быстрые ссылки на ключевые страницы админки с уже подставленным `central_id`;
  - live-блок WG peer status (по `/api/admin/wg/peers`) для быстрой проверки handshake;
  - live-блок “Central у backend” (по `/api/admin/fleet/centrals` + `/api/admin/fleet/incidents`) — видно, появился ли heartbeat, возраст heartbeat, очередь, возраст WG, количество инцидентов.
  - UX ускорение triage: переключатель “нова вкладка” для швидких посилань + підсумок `COMMISSION=ГОТОВО/ПОТРЕБУЄ УВАГИ/КРИТИЧНО` з короткою підказкою наступної дії.
  - Кнопка `Копіювати звіт` — копирует evidence bundle (WG + fleet status + totals инцидентов + ссылки) для быстрого шаринга в чат/тикет при масштабе 100–200 систем.
  - Блок `Перевірки (локально)`:
    - копирует команды для `fleet_commission.py` и `mvp_e2e_smoke.sh`;
    - позволяет вручную отметить PASS/FAIL;
    - хранит последние записи в `localStorage` (без записи в backend).
    - `Експорт/Імпорт`: перенос run-лога между ПК через JSON (localStorage → clipboard → paste).
  - Поля ідентифікації транспорту: `vehicle_id` (bus_id) та `plate`:
    - зберігаються в URL query string (`/admin/commission?vehicle_id=...&plate=...`);
    - включаються в `Копіювати звіт` та у note для PASS/FAIL.
    - `vehicle_id` автозаповнюється з backend (якщо central вже з’явився у `/api/admin/fleet/centrals` і поле було порожнє).
    - Додані явні кнопки керування: `Підставити vehicle` (взяти `vehicle_id` з backend) та `Скинути plate`.
  - Блок `Профілі (локально)`:
    - збереження профілю за `central_id` (vehicle_id/plate/IP-и) для повторного commissioning;
    - `Експорт/Імпорт` профілів через JSON (localStorage → clipboard → paste).
- В sidebar добавлен пункт `Підключення`.

## Выполнено после релиза (camera: перенос на edge + multi-host режимы, 2026-02-15)

- Камера перенесена в модель “камера на Door”:
  - `mvp/camera_counter.py` поддерживает `--store edge` (запись в `edge.sqlite3:outbox`) и `--store central`.
  - добавлен деплой на edge: `scripts/install_edge_camera_counter.sh` (venv + udev + systemd unit).
- Переключатели режимов камеры теперь multi-host:
  - `scripts/camera_mode_switch.sh` и `scripts/camera_mode_menu.sh` принимают `--camera-ip` (и сохраняют alias `--central-ip`).
  - `scripts/camera_depth_calibrate.sh` принимает `--camera-ip`.
- Добавлены helpers под железо Central:
  - `scripts/central_lte_setup.sh` (bootstrap ModemManager/NM, PIN/APN через параметры).
  - `scripts/central_gps_detect.sh` (поиск USB GPS device path).
- Для временной установки пакетов на edge без Wi‑Fi добавлен NAT helper:
  - `scripts/central_edge_inet_bridge.sh enable|disable`.

## Выполнено после релиза (camera: transport-strict preset + docs governance, 2026-02-16)

- Что сделано:
  - в `scripts/camera_depth_calibrate.sh` добавлен профиль `transport-strict`;
  - в `scripts/camera_mode_menu.sh` профиль добавлен в интерактивное меню калибровки;
  - обновлены профильные документы по камере/модулю/контролю документации.
- Зачем:
  - для сценария общественного транспорта с приоритетом “меньше ложных” и потоком 2–3 пассажира рядом;
  - закрепить обязательную структурную фиксацию каждого этапа в документации.
- Результат:
  - оператор может применять единый профиль одной командой `--preset transport-strict`;
  - в runbook зафиксирован рекомендуемый маршрут `wide-scan -> transport-strict -> точечный тюнинг`.
- Ошибки/ограничения:
  - сразу после рестарта возможна краткая недоступность `/health` (2–6 секунд), пока поднимается HTTP поток;
  - после прогрева на `door-1` зафиксирован стабильный статус `running`, `device=OAK-D-LITE`, рост `detections`.
  - профиль стартовый и требует полевого прогона на реальном проходе (дверь, поток, свет) с коррекцией ROI/area/hysteresis при необходимости.
- Следующий этап и зачем:
  - выполнить прогон на `door-2` в режиме `depth-counting` с `transport-strict` и собрать evidence (`/health`, логи, видео), чтобы зафиксировать рабочие пороги перед подключением модулей GPS/LTE/RTC и переносом камеры.

## Выполнено после релиза (docs: единый UI/UX стандарт админки, 2026-02-16)

- Добавлен нормативный документ:
  - `Docs/Проект/Админ-панель (UI-UX стандарт).md`
- В документе зафиксированы единые правила:
  - иерархия экранов;
  - правила восприятия KPI/статистики;
  - единая семантика статусов;
  - стандарты фильтров/shareable URL;
  - обязательные состояния (`loading/empty/filtered-empty/error`).
- Обновлены связанные документы:
  - `Docs/Проект/Админ-панель (модульная разработка).md`
  - `Docs/Проект/Операции/Админка модульные этапы.md`
  - `Docs/Проект/INDEX.md`
- Следующий этап и зачем:
  - провести page-by-page аудит `/admin*` по новому чеклисту, чтобы привести существующие экраны к единому UX-ритму без визуального дрейфа.

## Выполнено после релиза (admin UI: этап 3 стандартизации, 2026-02-16)

- `backend/app/admin_fleet_notifications_page.py`:
  - добавлен header `filterSummary` (`контекст: глобальні правила сповіщень`) для единого паттерна восприятия.
- `backend/app/admin_fleet_incidents_page.py`:
  - унифицированы подписи command palette под каноничные query-параметры (`include_resolved`, `sla_breached_only`);
  - устранена смешанная англоязычная подпись `protected presets`.
- `backend/app/admin_fleet_page.py` и `backend/app/admin_fleet_alerts_page.py`:
  - выполнена дополнительная UA-first унификация command palette (формулировки для `shared namespace`, `policy lock`, `preview merge` и смежных подсказок).
- Проверки:
  - `python3 -m py_compile backend/app/admin_fleet_notifications_page.py backend/app/admin_fleet_incidents_page.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py` — OK;
  - локальный marker-аудит рендера `/admin*` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.

## Выполнено после релиза (camera: tracker strict engine in depth-counting, 2026-02-16)

- Что сделано:
  - добавлен новый runtime: `mvp/camera_transport_strict_counting.py` (person detector + `ObjectTracker` + two-line crossing + depth-gate + live web/health);
  - `scripts/camera_mode_switch.sh` для `--mode depth-counting` переведён на новый runtime;
  - `scripts/camera_depth_calibrate.sh` расширен strict-параметрами (`CONFIDENCE`, `TRACKER_TYPE`, `LINE_GAP_NORM`, `MIN_TRACK_AGE`, `MAX_LOST_FRAMES`, `HANG_TIMEOUT_SEC`, `MIN_MOVE_NORM`);
  - `transport-strict` preset обновлён под стабильный старт: `FPS=10`, `tracker=short_term_imageless`.
- Зачем:
  - закрыть разрыв между целевым алгоритмом и фактической реализацией: перейти от depth-only логики к `person + track_id + A↔B` для меньшего числа ложных срабатываний в транспорте.
- Результат:
  - на `door-1` (`192.168.10.11`) сервис `passengers-camera-depth-counting.service` в `active/running`;
  - `/health` показывает рабочие метрики strict-движка (`messages`, `tracklets_total`, `active_tracks`, `count_in/out`, reject counters, `line_a/line_b`, `imu_*`);
  - после применения `transport-strict` подтверждён рост `messages/tracklets_total` в реальном времени.
- Ошибки/ограничения:
  - сразу после restart возможна краткая недоступность `:8091/health` до поднятия HTTP потока;
  - при `usb_speed=HIGH` возможны `X_LINK_ERROR` на агрессивных настройках, поэтому базовый старт закреплён как `FPS=10` и дальнейший рост FPS только после стабильного прогона.
- Следующий этап и зачем:
  - выполнить контрольный e2e-прогон 20–30 проходов (in/out) с фиксацией PASS/FAIL по ложным/пропускам, чтобы зафиксировать боевой baseline до подключения новых модулей (LTE/GPS/RTC).

## Выполнено после релиза (camera: fast commissioning tune for no-count case, 2026-02-16)

- Что сделано:
  - для текущего стенда применён быстрый commissioning-тюн (door-1): `AXIS=x`, `LINE_GAP_NORM=0.16`, `CONFIDENCE=0.55`, `MIN_TRACK_AGE=5`, `MIN_MOVE_NORM=0.08`, `COOLDOWN=1.20`.
  - runbook/troubleshooting обновлены с явным правилом выбора оси (`x`/`y`) по фактическому направлению движения в кадре.
- Зачем:
  - устранить ситуацию “tracklets растут, но счёт не идёт” на этапе полевой юстировки линий.
- Результат:
  - сервис работает в `active/running`, `/health` показывает рост `messages/tracklets_total` с новыми параметрами.
- Ошибки/ограничения:
  - текущий тюн пуско-наладочный; финальные пороги фиксируются только после e2e проходов in/out.
- Следующий этап и зачем:
  - пройти 20–30 реальных пересечений in/out и закрепить финальные значения `AXIS/LINE_GAP/MIN_MOVE/MIN_TRACK_AGE` как боевой профиль.

## Выполнено после релиза (camera: relaxed commissioning profile update, 2026-02-16)

- Что сделано:
  - обновлён быстрый профиль для случая `count_in/out=0` на текущем стенде: `AXIS=y`, `LINE_GAP_NORM=0.10`, `CONFIDENCE=0.45`, `MIN_TRACK_AGE=3`, `MIN_MOVE_NORM=0.04`, `HANG_TIMEOUT=8.0`, `COOLDOWN=0.80`, `DEPTH=0.30..2.20`.
- Зачем:
  - снизить вероятность “залипания в middle-зоне” и ускорить первичное появление событий при commissioning.
- Результат:
  - сервис стабилен (`active/running`), `/health` показывает рост `messages/tracklets_total`, `hang_reject` на старте профиля = 0.
- Ошибки/ограничения:
  - профиль временно более мягкий (для пуско-наладки), не финальный production baseline.
- Следующий этап и зачем:
  - выполнить серию контролируемых проходов in/out и после подтверждения событий вернуть stricter-пороги для снижения ложных срабатываний.

## Выполнено после релиза (camera: root-cause instrumentation for no-count crossings, 2026-02-16)

- Что сделано:
  - в `mvp/camera_transport_strict_counting.py` исправлена классификация “граничных” зон (пограничные значения относятся к `middle`, а не выпадают);
  - добавлены диагностические счётчики зон в `/health` и web UI: `zone_neg_hits`, `zone_mid_hits`, `zone_pos_hits`, `middle_entries`, `zone_flip_no_middle`;
  - расширена валидация `axis_hyst` до диапазона `0.00..0.20` (ранее `0.01..0.20`).
- Зачем:
  - точно отделить “не считает из-за логики пересечения” от “не считает из-за детекции/глубины”.
- Результат:
  - на текущем стенде видно, что при `events_total=0` растёт только `zone_pos_hits`, а `zone_mid_hits/zone_neg_hits` не растут — это означает, что tracked-point не проходит через A↔B контур.
- Ошибки/ограничения:
  - визуальное пересечение bbox с линией не равно событию; счётчик использует tracked-point и двухлинейный контур.
- Следующий этап и зачем:
  - либо подтверждаем геометрию по tracked-point, либо включаем альтернативный anchor-режим (leading edge), чтобы считать пересечения, когда bbox проходит, а centroid не доходит до middle.

## Выполнено после релиза (camera: leading-edge anchor trial without geometry change, 2026-02-16)

- Что сделано:
  - добавлен параметр `CAM_DEPTH_COUNT_ANCHOR_MODE` (`center|leading_edge`) в strict runtime;
  - на стенде включён `leading_edge` без изменения линий/оси.
- Зачем:
  - проверить гипотезу “bbox визуально пересекает, но centroid не проходит middle”.
- Результат:
  - при `leading_edge` на текущем стенде по-прежнему `zone_mid_hits=0`, растёт только `zone_pos_hits`;
  - это подтверждает, что проблема не в детекции/трекинге/depth, а в том, что counting-контур не попадает в реальную траекторию прохода.
- Ошибки/ограничения:
  - без подгонки геометрии (позиция/ориентация линий или физический угол камеры) события `in/out` не сформируются.
- Следующий этап и зачем:
  - согласовать минимальную корректировку геометрии counting-контура под фактическую траекторию прохода и повторить e2e (иначе счёт останется 0 при любой жёсткости порогов).

## Выполнено после релиза (camera: minimal geometry shift validated, 2026-02-16)

- Что сделано:
  - применена минимальная правка геометрии одним параметром: `CAM_DEPTH_COUNT_AXIS_POS=0.78` (без изменения остальных порогов в этом шаге).
- Зачем:
  - проверить гипотезу о смещённом counting-контуре относительно реальной траектории.
- Результат:
  - после сдвига линий `line_a=0.73`, `line_b=0.83` в `/health` начали расти `zone_mid_hits` (ранее было `0` стабильно).
  - это подтверждает, что корневая причина была именно в геометрическом положении контура.
- Ошибки/ограничения:
  - факт роста `zone_mid_hits` не гарантирует событие `in/out` без полного прохода `A↔B`.
- Следующий этап и зачем:
  - выполнить 3–5 контролируемых полных проходов через обе линии и подтвердить рост `events_total / count_in/out`.

## Выполнено после релиза (admin UI: этап 3 стандартизации `overview/commission`, 2026-02-16)

- Что сделано:
  - в `backend/app/admin_overview_page.py` унифицированы ключевые UX-подписи (UA-first copy для summary/status/navigation-подсказок);
  - в `backend/app/admin_commission_page.py` выровнены термины onboarding-потока (`vehicle_id`, `номер`, `посилання`, `ПРОГОНИ`) и CTA в toolbar/чеклисте.
- Зачем:
  - закрепить единый язык интерфейса и снизить когнитивную нагрузку операторов при чтении статистики/инцидентов и запуске commissioning.
- Результат:
  - UI-тексты `overview/commission` приведены к одному стилю без изменений API/маршрутов/DOM-контрактов.
- Проверки:
  - `python3 -m py_compile backend/app/admin_overview_page.py backend/app/admin_commission_page.py` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --admin-pass-file "pass admin panel"` — PASS.
- Следующий этап и зачем:
  - выполнить финальный page-by-page audit `/admin*` и закрыть остаточные текстовые/маркерные расхождения перед фиксацией DoD по единому UI/UX стандарту.

## Выполнено после релиза (admin UI: server-first copy cleanup `fleet/alerts/incidents`, 2026-02-16)

- Что сделано:
  - устранены остаточные mixed-language формулировки в `backend/app/admin_fleet_page.py`, `backend/app/admin_fleet_alerts_page.py`, `backend/app/admin_fleet_incidents_page.py`:
    - `Preview ...` -> `Попередній перегляд ...`;
    - `open/acked/silenced` -> `відкриті/підтверджені/заглушені`.
- Зачем:
  - завершить UX-унификацию operator-facing подсказок в mission/preset-потоке и снизить когнитивный шум.
- Результат:
  - правки выкачены и применены на VPS в server-first контуре (`rsync` + `docker compose ... up -d --build api`).
  - `scripts/admin_panel_smoke_gate.sh` по серверу: PASS (все UI/API `200`, `no_errors_found`).
  - серверный `grep` подтверждает отсутствие legacy-строк и наличие UA-first формулировок.
- Следующий этап и зачем:
  - продолжить page-by-page server-first аудит на оставшихся страницах (`notify-center/history/policy/wg/incident-detail`) и закрыть final residual-list перед DoD фиксацией.

## Выполнено после релиза (admin UI: server-first marker audit для вспомогательных страниц, 2026-02-16)

- Что сделано:
  - выполнен server-side marker audit для страниц:
    - `/admin/fleet/notifications`
    - `/admin/fleet/notify-center`
    - `/admin/fleet/history`
    - `/admin/fleet/policy`
    - `/admin/wg`
    - `/admin/fleet/actions`
    - `/admin/audit`
  - проверялись маркеры `copyLink/filterSummary/flowStep/tableMeta`.
- Что выявлено:
  - единственный residual: на `/admin/fleet/notifications` отсутствовал `filterSummary` на серверной версии.
- Исправление и результат:
  - `admin_fleet_notifications_page.py` выкачен на VPS, `api` пересобран;
  - повторный marker audit: на всех перечисленных страницах `copyLink=1 filterSummary=1 flowStep=3 tableMeta=1`;
  - `scripts/admin_panel_smoke_gate.sh` по серверу — PASS (`200` по UI/API, `no_errors_found`).
- Следующий этап и зачем:
  - закрыть динамические проверки `central detail`/`incident detail` при наличии фактических `centrals/incidents`, чтобы зафиксировать полный DoD по этапу 4.

## Выполнено после релиза (camera: live root-cause diagnostics handshake, 2026-02-16)

- Что сделано:
  - на `door-1` подтверждён онлайн-статус strict сервиса и `/health`;
  - после теста с `leading_edge` зафиксирован возврат к `CAM_DEPTH_COUNT_ANCHOR_MODE=center` как базовый режим для текущего стенда;
  - добавлен helper `scripts/camera_depth_live_probe.sh` для live-диагностики (60s sampling + delta-анализ счётчиков);
  - в runbook добавлен сценарий применения helper и ручной one-liner как fallback.
- Зачем:
  - получить воспроизводимый root-cause разбор “почему не считает” во время реального прохода без гадания по одиночному кадру.
- Результат:
  - собрана базовая телеметрия: при отсутствии событий возможна ситуация с ростом `zone_*` при нуле `events_total`, что требует анализа дельт reject/zone-полей за интервал прохода;
  - оператор получил стандартный сценарий сбора evidence перед точечной донастройкой.
- Следующий этап и зачем:
  - провести контролируемый live-прогон 40–60 секунд с проходами через контур и на основе дельт выбрать точечную правку (`AXIS_HYST`/`LINE_GAP`/`MIN_MOVE_NORM`/пороги).

## Выполнено после релиза (camera: USB ID compatibility + node relocation check, 2026-02-16)

- Что сделано:
  - в `scripts/camera_mode_switch.sh` и `scripts/install_edge_camera_counter.sh` проверка камеры расширена: `03e7:2485` или `03e7:f63b`;
  - в camera-runbook добавлено пояснение по допустимым USB ID.
- Зачем:
  - на части стендов OAK-D Lite определяется как `03e7:f63b`; жёсткая проверка только `2485` давала ложный `camera not found`.
- Результат:
  - сервисные скрипты совместимы с обоими вариантами USB идентификации.
- Следующий этап и зачем:
  - при переносе камеры на другой door-узел сначала подтвердить `lsusb` на новом IP, затем запускать `depth-counting` уже на этом узле.

## Выполнено после релиза (camera: live diagnostics batch + axis test pivot, 2026-02-16)

- Что сделано:
  - выполнен live-прогон с реальными проходами (`camera_depth_live_probe`, 120s/90s);
  - зафиксированы дельты reject/zone счётчиков;
  - для теста соответствия траектории движения ось переключена `y -> x` (`CAM_DEPTH_COUNT_AXIS=x`, `CAM_DEPTH_COUNT_AXIS_POS=0.55`, `CAM_DEPTH_COUNT_LINE_GAP_NORM=0.18`);
  - сервис восстановлен после невалидного `hang_timeout` (ограничение runtime: `0.5..10.0`).
- Результат:
  - при `axis=y` события не формируются (`d_events=0`) на фоне высокого reject (`conf/depth/age`) при росте `middle_entries`;
  - подготовлен следующий контрольный прогон уже на `axis=x` для выбора финальной оси под монтаж.
- Следующий этап и зачем:
  - провести 60–90s live-прогон на `axis=x`; если `events_total` растёт — фиксируем ось, если нет — возвращаем `axis=y` и локально ослабляем depth/conf в зоне прохода.

## Выполнено после релиза (camera: counting root-cause isolated by no-depth commissioning run, 2026-02-16)

- Что сделано:
  - завершён сравнительный прогон `axis=x` и `axis=y` с live-probe;
  - добавлен пресет `commissioning-no-depth` в `scripts/camera_depth_calibrate.sh` и в меню `scripts/camera_mode_menu.sh`;
  - выполнен контрольный прогон `axis=y` + мягкие пороги + `CAM_DEPTH_ENABLE=0`.
- Результат:
  - `axis=x` нерабочая для текущего монтажа (`d_events=0`, доминирует `zone_pos`);
  - на `axis=y` в commissioning-профиле получено `d_events=10` (`in=5`, `out=5`, 75s), что подтверждает корректность crossing-логики и направления;
  - корневая причина нулевого счёта в предыдущих прогонах — сочетание quality-gate (`confidence/depth`) на текущем стенде.
- Следующий этап и зачем:
  - вернуть `CAM_DEPTH_ENABLE=1` и поэтапно поднять пороги от commissioning к transport-strict, чтобы сохранить найденную геометрию и снизить ложные срабатывания в боевом режиме.

## Выполнено после релиза (camera: depth return + threshold ramp validation, 2026-02-16)

- Что сделано:
  - depth-gate возвращён и проверен на мягком профиле (`commissioning-depth-soft`);
  - выполнен контрольный live-прогон soft-depth (75s) и отдельный прогон near-prod (75s);
  - добавлен новый пресет `commissioning-depth-soft` в `scripts/camera_depth_calibrate.sh` и пункт меню в `scripts/camera_mode_menu.sh`;
  - `depth-counting` сервис переустановлен через `camera_mode_switch`, чтобы unit использовал USB-проверку `03e7:(2485|f63b)`.
- Результат:
  - soft-depth с включённым depth даёт стабильный счёт (`d_events=8`, `in=4`, `out=4`);
  - near-prod на текущем стенде снова обнуляет счёт (`d_events=0`) из-за роста quality rejects (`conf/depth/age`);
  - текущий рабочий профиль для стенда зафиксирован как `commissioning-depth-soft`.
- Следующий этап и зачем:
  - поднимать пороги к transport-strict по одному параметру на итерацию (с live-probe 60–90s после каждого шага), чтобы не потерять рабочий счёт при ужесточении фильтров.

## Выполнено после релиза (camera: threshold ramp step `CONFIDENCE=0.25`, 2026-02-16)

- Что сделано:
  - установлен `CAM_DEPTH_COUNT_CONFIDENCE=0.25` при сохранении soft-depth профиля;
  - запущен live-прогон 75s с визуальным контролем видео.
- Результат:
  - `d_events=9`, `in=4`, `out=5`;
  - quality-gates не обнулили счёт (`depth_missing=0`, `age_reject=0`, `move_reject=0`).
- Следующий этап и зачем:
  - перейти к шагу `CONFIDENCE=0.30` и повторить live-probe; это продолжает controlled ramp к боевым порогам без потери работоспособности.

## Выполнено после релиза (camera: threshold ramp step `CONFIDENCE=0.30`, 2026-02-16)

- Что сделано:
  - поднят `CAM_DEPTH_COUNT_CONFIDENCE` до `0.30` при сохранении текущей геометрии и depth-профиля;
  - выполнен live-probe 75s с визуальным контролем видео.
- Результат:
  - `d_events=25` (`in=12`, `out=13`) — счёт стабильно формируется;
  - reject-поля не блокируют поток событий (`age_reject=0`, `move_reject=0`, `depth_missing≈0`).
- Следующий этап и зачем:
  - поднять анти-дубль (`CAM_DEPTH_COUNT_COUNT_COOLDOWN_SEC`) и проверить, снижается ли риск overcount без потери корректных событий.

## Выполнено после релиза (camera: anti-duplicate ramp step `COUNT_COOLDOWN_SEC=1.20`, 2026-02-16)

- Что сделано:
  - при `CONFIDENCE=0.30` увеличен `CAM_DEPTH_COUNT_COUNT_COOLDOWN_SEC` до `1.20`;
  - выполнен live-probe 75s с визуальным контролем видео.
- Результат:
  - `d_events=7` (`in=4`, `out=3`) — счёт сохраняется, но становится более консервативным;
  - `age_reject=0`, `move_reject=0` (эти фильтры ещё не ограничивают поток);
  - шаг подтверждает снижение частоты событий (уменьшение риска дублей) при сохранении работоспособности.
- Следующий этап и зачем:
  - поднять `CAM_DEPTH_COUNT_MIN_TRACK_AGE` до `2` и повторить live-probe, чтобы продолжить controlled hardening без обнуления счёта.

## Выполнено после релиза (admin UI: IA меню/подменю + минималистичный sidebar, 2026-02-16)

- Что сделано:
  - в `backend/app/admin_ui_kit.py` внедрена новая информационная архитектура навигации:
    - верхний уровень: `Старт`, `Флот`, `Сповіщення`, `Контроль і KPI`, `Інфраструктура`;
    - второй уровень: подменю внутри каждого раздела;
    - page-level subnav под header для текущего раздела.
  - реализован anti-overload режим:
    - неактивные группы sidebar стартуют свернутыми;
    - в `Simple`-режиме скрывается `quick-jump` и вторичные блоки sidebar;
    - подпункты меню визуально облегчены (меньше визуального шума).
- Зачем:
  - сократить длину левого меню и улучшить восприятие структуры экранов без изменения API/бизнес-логики.
- Результат:
  - изменения выкачены на VPS (server-first) и применены через пересборку `api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - server-side рендер-проверка подтверждает новые маркеры IA (`sideLinkHub`, `sideLinkSub`, `pageSubnav`, `sideGroup collapsed`).
- Следующий этап и зачем:
  - разнести перегруженные блоки по страницам в рамках новой IA-карты (`fleet`, `notify-center`) и зафиксировать map “блок -> страница” для стабильного UX при дальнейшем росте функционала.

## Выполнено после релиза (web panel: принята архитектура `Core + Domains`, 2026-02-16)

- Что сделано:
  - для админ-панели выделены модули:
    - `backend/app/admin_domains/domain_catalog.py`
    - `backend/app/admin_core/navigation.py`
  - `backend/app/admin_ui_kit.py` переведён на импорт доменной карты и ядра навигации;
  - для клиентской панели добавлен scaffold той же модели:
    - `backend/app/client_domains/domain_catalog.py`
    - `backend/app/client_core/navigation.py`
  - добавлен архитектурный стандарт:
    - `Docs/Проект/Веб-панель (ядро и домены).md`
  - добавлен операционный план развития:
    - `Docs/Проект/Операции/Стратегия доработки веб-панели (admin+client).md`
- Зачем:
  - перейти от “всё в одном файле” к доменной структуре с контролируемым ростом UI и более чистой IA для админа и клиента.
- Результат:
  - server-first выкатка выполнена;
  - `scripts/admin_panel_smoke_gate.sh` — PASS (`/admin*` и `/api/admin/*` отвечают `200`, `no_errors_found`).
- Следующий этап и зачем:
  - выполнить доменный content-split перегруженных экранов (`fleet`, `notify-center`) и сократить плотность данных на страницу без потери операционного контекста.

## Выполнено после релиза (web panel: структуризация docs по ядру и каждому домену, 2026-02-16)

- Что сделано:
  - добавлен каталог доменной документации:
    - `Docs/Проект/Веб-панель/INDEX.md`
    - `Docs/Проект/Веб-панель/Ядро (Core).md`
    - domain-docs для `Старт/Флот/Сповіщення/Контроль і KPI/Інфраструктура/Клієнт`;
  - добавлен runbook стратегии:
    - `Docs/Проект/Операции/Стратегия доработки веб-панели (admin+client).md`;
  - добавлен авто-инвентарь доменов:
    - `scripts/web_panel_domain_inventory.py`
    - `Docs/auto/web-panel/domain-inventory.md`.
- Зачем:
  - закрепить единые стандарты и правила по `Core + Domains` не только концептуально, но и в операционной документации по каждому домену.
- Результат:
  - доменная карта и docs синхронизированы;
  - server-first проверки по админке остаются зелёными (`smoke-gate` PASS).
- Следующий этап и зачем:
  - перейти к content-split домена `Флот`, чтобы реально уменьшить информационную плотность ключевых страниц без потери операционной скорости.

## Выполнено после релиза (web panel: content-split `Флот` step-1, 2026-02-16)

- Что сделано:
  - на `/admin/fleet` вторичные блоки (`Потік алертів`, `Оперативна стрічка подій`) перенесены в сворачиваемую секцию `Вторинна аналітика`;
  - состояние раскрытия секции сохраняется в `localStorage` (`passengers_admin_fleet_secondary_details_v1`).
- Зачем:
  - снизить визуальную перегрузку основной страницы домена `Флот` и оставить в первом экране только ключевой triage-контур.
- Результат:
  - server-first выкатка выполнена;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - рендер `/admin/fleet` подтверждает наличие нового secondary-container и сохранения состояния.
- Следующий этап и зачем:
  - выполнить аналогичный content-split в домене `Сповіщення` (`notify-center`), чтобы выровнять плотность интерфейса между доменами.

## Выполнено после релиза (web panel: content-split `Сповіщення` step-2, 2026-02-16)

- Что сделано:
  - на `/admin/fleet/notify-center` выделен primary-блок `Оперативний огляд доставки` (агрегаты sent/failed/skipped/retryable);
  - детальный delivery-журнал и retry-операции перенесены в secondary-блок `details#notifySecondaryDetails`;
  - добавлено сохранение состояния secondary-блока в `localStorage` (`passengers_admin_notify_secondary_details_v1`).
- Зачем:
  - уменьшить визуальную плотность `notify-center` и сохранить единый паттерн декомпозиции между доменами `Флот` и `Сповіщення`.
- Результат:
  - выкатка выполнена server-first;
  - `scripts/admin_panel_smoke_gate.sh` — PASS (все UI/API проверки `200`, `no_errors_found`);
  - server render-check подтверждает новые маркеры `notifySecondaryDetails` и storage-key.
- Следующий этап и зачем:
  - выполнить step-3 для домена `Контроль і KPI`: разделить primary policy-сценарий и secondary KPI-аналитику, чтобы довести единый UX-паттерн до всех ключевых доменов.

## Выполнено после релиза (web panel: content-split `Контроль і KPI` step-3, 2026-02-16)

- Что сделано:
  - на `/admin/fleet/policy` выделен primary-блок `Глобальна політика моніторингу`;
  - блок `Персональні override-и` вынесен в secondary-контур `details#policySecondaryDetails`;
  - добавлено сохранение состояния secondary-блока в `localStorage` (`passengers_admin_policy_secondary_details_v1`).
- Зачем:
  - сократить визуальную плотность policy-страницы и оставить на первом экране базовый сценарий настройки порогов.
- Результат:
  - выкатка выполнена server-first;
  - `scripts/admin_panel_smoke_gate.sh` — PASS (все UI/API проверки `200`, `no_errors_found`);
  - server render-check подтверждает новые маркеры `policySecondaryDetails` и storage-key.
- Следующий этап и зачем:
  - выполнить step-4 для домена `Інфраструктура`, чтобы закрепить единый primary/secondary паттерн на всех ключевых доменах админ-панели.

## Выполнено после релиза (web panel: content-split `Інфраструктура` step-4, 2026-02-16)

- Что сделано:
  - на `/admin/wg` выделен primary-блок `Базова мережева діагностика` (peer/handshake + агрегаты статусов);
  - серверный WG-конфиг перенесён в secondary-контур `details#wgSecondaryDetails`;
  - добавлено сохранение состояния secondary-блока в `localStorage` (`passengers_admin_wg_secondary_details_v1`).
- Зачем:
  - убрать визуальную перегрузку страницы инфраструктуры и оставить в первом экране только базовый операторский контроль сети.
- Результат:
  - выкатка выполнена server-first;
  - `scripts/admin_panel_smoke_gate.sh` — PASS (все UI/API проверки `200`, `no_errors_found`);
  - server render-check подтверждает новые маркеры `wgSecondaryDetails` и storage-key.
- Следующий этап и зачем:
  - перейти к этапу `Client Panel MVP`: поднять отдельный client-shell и доменную IA клиентских страниц, чтобы разделить admin/client подачу по плотности и сценариям.

## Выполнено после релиза (web panel: `Client Panel MVP` step-1, 2026-02-16)

- Что сделано:
  - добавлен отдельный client-shell `backend/app/client_ui_kit.py`;
  - добавлены клиентские страницы `/client*` и thin-routes в `main.py`;
  - в `client_domains/domain_catalog.py` заполнены `page_file` для client route;
  - nginx расширен location `/client` (внутренний MVP-доступ под BasicAuth на `:8443`).
- Зачем:
  - разделить admin/client контуры интерфейса по плотности и сценариям, не смешивая клиентский UX с операторским triage.
- Результат:
  - server-first выкатка выполнена;
  - `scripts/admin_panel_smoke_gate.sh` — PASS (включая `/client*`);
  - проверка `/client*`: `auth=200`, `anon=401`, маркеры `clientShell`/`ClientUiKit` присутствуют.
- Следующий этап и зачем:
  - `Client MVP step-2`: подключить реальные клиентские API-данные и минимальный auth-контур клиента, чтобы кабинет стал рабочим не только как UI scaffold.

## Выполнено после релиза (web-panel: Client MVP step-2, 2026-02-16)

- Что сделано:
  - реализован backend-контур клиента `/api/client/*` (`whoami/home/vehicles/tickets/status/profile/notification-settings`);
  - добавлен доменный модуль `backend/app/client_ops.py`;
  - добавлены таблицы профиля и настроек клиента в `backend/app/db.py`;
  - клиентские страницы переведены с mock/localStorage на backend API;
  - nginx расширен маршрутом `/api/client/*` с Bearer token proxy и actor header;
  - unified smoke-gate расширен проверками `/api/client/*`.
- Результат:
  - server-first deploy выполнен;
  - `scripts/admin_panel_smoke_gate.sh` PASS;
  - публично подтверждено: `/client` и `/api/client/*` → `200` с auth, `401` без auth.
- Следующий этап и зачем:
  - `Client MVP step-3` (IA/UX polish и mobile плотность), чтобы повысить читаемость клиентских страниц при росте объёма данных.

## Выполнено после релиза (camera depth-counting: rollback + verify, 2026-02-16)

- Что сделано:
  - для узла с камерой (`door-2` на `192.168.10.11`) проверен шаг ужесточения `MIN_TRACK_AGE=2`;
  - зафиксирован отказ счёта на этом шаге и выполнен откат на `MIN_TRACK_AGE=1` с сохранением `CONFIDENCE=0.30`, `COUNT_COOLDOWN_SEC=1.20`;
  - добавлен отчёт live-probe (`/tmp/door2_depth_conf030_cd120_age1_20260216_161603.jsonl`) и обновлена операционная документация по камере;
  - исправлен `scripts/camera_mode_menu.sh`: пересчёт `CONTROL_SOCKET` теперь выполняется после CLI-аргументов (устранена путаница сокета при смене IP).
- Зачем:
  - вернуть стабильный подсчёт на стенде без потери проходов и убрать операторскую ошибку при запуске tunnel/open video через меню.
- Результат:
  - `passengers-camera-depth-counting.service` = `active`;
  - контрольный probe после отката: `d_events=19`, `d_in=9`, `d_out=10`;
  - меню корректно формирует socket вида `/tmp/passengers-camera-tunnel-orangepi@<camera-ip>-8091.sock`.
- Следующий этап и зачем:
  - добавить дополнительный анти-дубль фильтр (повторный cross того же `track_id` в коротком окне), чтобы снизить overcount при колебании трека в дверном проёме.

## Выполнено после релиза (camera depth-counting: per-track rearm guard, 2026-02-16)

- Что сделано:
  - в `mvp/camera_transport_strict_counting.py` добавлен новый guard `per_track_rearm_sec`;
  - введён env-параметр `CAM_DEPTH_COUNT_PER_TRACK_REARM_SEC` и валидация диапазона `0.0..30.0`;
  - `/health` и UI дополнены полями `per_track_rearm_sec` и `rearm_reject`;
  - heartbeat-лог дополнен `reject_dup` и `reject_rearm`;
  - на door-2 (`192.168.10.11`) применён рабочий параметр `CAM_DEPTH_COUNT_PER_TRACK_REARM_SEC=2.40`.
- Зачем:
  - уменьшить повторные срабатывания одним и тем же `track_id` при дрожании/осцилляции трека в дверном проёме.
- Результат:
  - сервис `passengers-camera-depth-counting.service` перезапущен и активен;
  - стартовый лог подтверждает `rearm=2.40s`;
  - контрольный live-probe: `/tmp/door2_rearm240_20260216_163022.jsonl` (`d_events=3`, `d_in=1`, `d_out=2`);
  - локальный видео-доступ через tunnel (`http://127.0.0.1:8091/`) подтверждён.
- Следующий этап и зачем:
  - выполнить контрольный живой прогон с проходами через проём (60–90s) и сравнить `d_events`/`rearm_reject` до и после, чтобы количественно зафиксировать снижение overcount.

## Выполнено после релиза (camera depth-counting: lines centered, 2026-02-16)

- Что сделано:
  - на узле камеры (`192.168.10.11`) выставлены центральные линии подсчёта:
    - `CAM_DEPTH_COUNT_AXIS=y`
    - `CAM_DEPTH_COUNT_AXIS_POS=0.50`
  - подтверждено в `/health`: `line_a=0.45`, `line_b=0.55`;
  - tunnel+browser проверены (`http://127.0.0.1:8091/`).
- Зачем:
  - перейти к следующему шагу в стабильной геометрии (проверка дублей/осцилляций на центральной зоне).
- Результат:
  - `passengers-camera-depth-counting.service` активен, метрики обновляются.
- Следующий этап и зачем:
  - запустить стресс-прогон 60–90s с контролируемыми проходами и задержкой между повторами, чтобы получить репрезентативную статистику по `dup_reject`/`rearm_reject`.

## Выполнено после релиза (camera depth-counting: horizontal lines, 2026-02-16)

- Что сделано:
  - на узле `192.168.10.11` переключена ориентация линий на горизонтальную:
    - `CAM_DEPTH_COUNT_AXIS=x`
    - `CAM_DEPTH_COUNT_AXIS_POS=0.50`
  - подтверждено в `/health`: `axis=x`, `line_a=0.45`, `line_b=0.55`;
  - tunnel/video подтверждены (`http://127.0.0.1:8091/`).
- Зачем:
  - перейти к следующему стресс-тесту дублей в требуемой геометрии (горизонтальные линии).
- Результат:
  - `passengers-camera-depth-counting.service` активен, поток/метрики доступны.
- Следующий этап и зачем:
  - выполнить контрольный проходной тест (обычные проходы + колебания в проёме), чтобы сравнить `d_events`, `dup_reject`, `rearm_reject` уже на горизонтальных линиях.

## Выполнено после релиза (camera: v1 baseline + v2 15FPS rollout, 2026-02-16)

- Что сделано:
  - по официальной документации Luxonis зафиксированы ключевые ограничения/возможности для OAK-D Lite (`RVC2`, on-device pipeline, трекинг/детекции на устройстве);
  - профиль перед изменением документирован как `v1` (рабочий baseline, `FPS=10`);
  - выполнен rollout `v2`: `CAM_DEPTH_COUNT_FPS=15` + донастройка `CAM_DEPTH_COUNT_MAX_LOST_FRAMES=8` (чтобы сохранить стабильность трека во времени);
  - состояние и параметры зафиксированы в операционной документации.
- Зачем:
  - повысить временное разрешение счётчика без потери устойчивости треков и сохранить явную версионность конфигурации (`v1`/`v2`).
- Результат:
  - сервис после rollout активен, `/health` показывает `fps=15`;
  - в начале после рестарта наблюдались краткие `X_LINK` reconnect события, далее поток и счёт восстановлены;
  - baseline `v1` сохранён в документации для быстрого rollback.
- Следующий этап и зачем:
  - выполнить подтверждающий полевой прогон (обычные проходы + oscillation), чтобы количественно сравнить поведение `v2` по `events/dup/rearm` и финально утвердить `15 FPS`.

## Выполнено после релиза (camera: offload audit OAK vs OPi, 2026-02-16)

- Что сделано:
  - проведён аудит распределения нагрузки между OAK-D Lite и OPi на текущем профиле `v2 (15 FPS)`;
  - по официальной документации подтверждено ограничение: для `OAK USB` на `RVC2` standalone mode не поддерживается;
  - в операционной документации зафиксировано, какие узлы пайплайна сейчас on-device, а какие остаются host-side.
- Зачем:
  - ответить на вопрос “вынесено ли на камеру всё возможное” и определить реалистичный предел offload для текущего железа.
- Результат:
  - AI-контур (DetectionNetwork/ObjectTracker/StereoDepth) работает на камере;
  - host-side остаются crossing/depth-filters/event-logic и веб-видео (`MJPEG`);
  - определён практический путь снижения нагрузки OPi: прод-режим через `camera-counter` без визуализации.
- Следующий этап и зачем:
  - после полевого прогона утвердить рабочий режим: `depth-counting` для калибровки, `camera-counter` для прод-эксплуатации.

## Выполнено после релиза (camera: prod switch to counter/no-MJPEG, 2026-02-16)

- Что сделано:
  - узел `192.168.10.11` переключён в `--mode prod`;
  - `passengers-camera-counter.service` активирован, `depth-counting/debug-stream` отключены.
- Зачем:
  - снизить host-нагрузку OPi за счёт отключения веб-видео/оверлея и перехода на боевой счётчик событий.
- Результат:
  - сервис активен, `NRestarts=0`;
  - после стабилизации: процесс `camera_counter.py` ~`14.5% CPU`, ~`29.9% MEM`;
  - зафиксирован единичный `X_LINK` reconnect после старта с автоматическим восстановлением.
- Важное замечание:
  - `camera-counter` читает `CAM_COUNTER_*`, а не `CAM_DEPTH_COUNT_*`; при необходимости нужно отдельно синхронизировать геометрию/пороги между режимами.
- Следующий этап и зачем:
  - выровнять `CAM_COUNTER_*` под откалиброванную геометрию двери (ось/линия/FPS/пороги), чтобы прод-счётчик соответствовал отладочному профилю.

## Выполнено после релиза (camera: calibration profile policy locked, 2026-02-16)

- Что сделано:
  - зафиксирована постоянная policy: вести и хранить отдельные типы калибровок по профилям (`debug-depth`, `prod-counter`, и последующие профильные версии).
- Зачем:
  - исключить смешение параметров `CAM_DEPTH_COUNT_*` и `CAM_COUNTER_*` и обеспечить воспроизводимость калибровок.
- Результат:
  - в операционной документации добавлен обязательный блок “Политика профилей калибровки”.
- Следующий этап и зачем:
  - выполнить синхронизацию `CAM_COUNTER_*` с текущей геометрией двери, чтобы боевой счётчик точно повторял утверждённый профиль.

## Выполнено после релиза (camera: CAM_COUNTER sync + IO-only watch command, 2026-02-16)

- Что сделано:
  - на `192.168.10.11` синхронизированы ключевые `CAM_COUNTER_*` параметры с текущим профилем двери (`axis/line/fps/confidence/min_age/invert`);
  - добавлен утилитарный скрипт `scripts/camera_counter_io_watch.sh` для консольного просмотра только `IN/OUT` событий.
- Зачем:
  - выровнять прод-счётчик с откалиброванной геометрией и дать оператору простой live-инструмент без лишнего лога.
- Результат:
  - `passengers-camera-counter.service` активен после синхронизации;
  - команда `camera_counter_io_watch.sh` выводит только `IN_TOTAL/OUT_TOTAL` и приращения `(+in/+out)`.
- Следующий этап и зачем:
  - провести проходной тест на синхронизированном `camera-counter` и сравнить прод-счёт с эталоном тестовой сессии.

## Выполнено после релиза (camera: IO-watch bootstrap totals fix, 2026-02-16)

- Что сделано:
  - доработан `scripts/camera_counter_io_watch.sh`: добавлена инициализация сумм `IN/OUT` из исторических event-логов перед live-follow;
  - добавлена опция `--bootstrap-since` (по умолчанию `today`).
- Зачем:
  - чтобы оператор видел “общий” счёт сразу при запуске, даже если в момент старта нет новых событий.
- Результат:
  - при запуске скрипт теперь печатает `Initial totals since ...`, после чего продолжает realtime update по новым `event`.
- Следующий этап и зачем:
  - провести операторский проходной тест и подтвердить, что realtime инициализация + live-инкременты совпадают с ожидаемым счётом.

## Выполнено после релиза (camera: switched back to strict depth-counting, 2026-02-16)

- Что сделано:
  - узел `192.168.10.11` переключён обратно в `depth-counting` режим;
  - `camera-counter` отключён, `passengers-camera-depth-counting.service` активирован.
- Зачем:
  - использовать требуемый алгоритм подсчёта: `2 линии + middle-cross + anti-duplicate (cooldown + rearm)`.
- Результат:
  - strict-сервис активен и готов к проходному тесту.
- Следующий этап и зачем:
  - выполнить операторский прогон и собрать `count_in/count_out/events_total` в реальном времени для подтверждения стабильности в strict-режиме.

## Выполнено после релиза (camera: strict depth IO watch script, 2026-02-16)

- Что сделано:
  - добавлен `scripts/depth_counter_io_watch.sh` для live-мониторинга только `IN/OUT` в strict-режиме;
  - скрипт читает `passengers-camera-depth-counting.service` и парсит `transport-strict event/heartbeat`;
  - добавлена инициализация сумм через `--bootstrap-since` (по умолчанию `today`).
- Зачем:
  - оператору нужен отдельный консольный watch именно для боевого `depth-counting`, без лишнего лога.
- Результат:
  - доступна команда:
    - `./scripts/depth_counter_io_watch.sh --camera-ip 192.168.10.11 --user orangepi`;
  - подтверждён запуск и стартовые totals (`Initial totals since ...`) на `door-2`.
- Следующий этап и зачем:
  - привязать этот watch к полевому тест-чеклисту проходов, чтобы сравнивать `IN/OUT` с видеодоказательством и быстрее фиксировать пороги.

## Выполнено после релиза (camera: strict IO watch realtime fix, 2026-02-16)

- Что сделано:
  - доработан `scripts/depth_counter_io_watch.sh`: live-обновление переведено на polling `/health` (`count_in/count_out/events_total`) с шагом `--poll-sec` (default `1.0s`);
  - сохранён bootstrap totals из `transport-strict event` по окну `--bootstrap-since`.
- Зачем:
  - обеспечить стабильное обновление `IN/OUT` в консоли в реальном времени при проходе, без зависимости от буферизации `journalctl -f`.
- Результат:
  - команда `./scripts/depth_counter_io_watch.sh --camera-ip 192.168.10.11 --user orangepi --bootstrap-since "today"` показывает heartbeat и инкременты totals в одном потоке.
- Следующий этап и зачем:
  - провести операторский проходной тест (10–20 проходов) и сверить консольные totals с видео, чтобы зафиксировать рабочий strict-профиль как v1 baseline.

## Выполнено после релиза (camera: X_LINK_ERROR root-cause clarified, 2026-02-17)

- Что сделано:
  - расширена troubleshooting-часть по `X_LINK_ERROR`: добавлена явная ветка диагностики по `dmesg` (USB disconnect / re-enumeration `03e7:(2485|f63b)`).
- Зачем:
  - отличать “тяжёлый пайплайн/USB2” от реальной аппаратной нестабильности (кабель/питание/хаб), чтобы не тратить время на тюнинг параметров, когда линк физически рвётся.
- Результат:
  - в проблемнике появился быстрый критерий и практические действия (кабель/питание/powered hub).
- Следующий этап и зачем:
  - после стабилизации USB линка повторить `depth-counting` прогон и зафиксировать метрики `/health` (`messages`, `tracklets_total`, `events_total`) как “camera link stable”.

## Выполнено после релиза (camera: rotate lines horizontal, 2026-02-17)

- Что сделано:
  - на `192.168.10.11` изменён `CAM_DEPTH_COUNT_AXIS` на `x` для горизонтальных линий в depth-counting overlay.
- Зачем:
  - подогнать геометрию пересечения под реальное направление движения в кадре и упростить визуальную проверку.
- Результат:
  - `/health` показывает `axis=x`, `line_a=0.375`, `line_b=0.625`, сервис `passengers-camera-depth-counting.service` активен.
- Следующий этап и зачем:
  - запустить видео через меню (пункт 5) и подтвердить, что события `IN/OUT` появляются при реальном проходе через обе линии.

## Выполнено после релиза (camera: commissioning-relaxed to restore counting, 2026-02-17)

- Что сделано:
  - на `192.168.10.11` ослаблены пороги strict-counting, чтобы восстановить реальные события `IN/OUT` при проходе:
    - `CAM_DEPTH_COUNT_CONFIDENCE=0.45`, `CAM_DEPTH_COUNT_MIN_TRACK_AGE=3`
    - `CAM_DEPTH_COUNT_LINE_GAP_NORM=0.10`, `CAM_DEPTH_COUNT_ANCHOR_MODE=center`, `CAM_DEPTH_COUNT_AXIS_HYST=0.00`
    - `CAM_DEPTH_COUNT_MIN_MOVE_NORM=0.04`, `CAM_DEPTH_COUNT_HANG_TIMEOUT_SEC=8.0`, `CAM_DEPTH_COUNT_COUNT_COOLDOWN_SEC=0.80`, `CAM_DEPTH_COUNT_MAX_LOST_FRAMES=8`
- Зачем:
  - при `confidence_min=0.65` crossing не фиксировался (детекции часто <0.65), рос `zone_flip_no_middle`, а `events_total` не рос.
- Результат:
  - `/health` показывает линии `0.45..0.55`, `confidence_min=0.45`, `anchor=center`; готово для повторного проходного теста с видео.
- Следующий этап и зачем:
  - выполнить 10–20 проходов, подтвердить рост `events_total/count_in/count_out`, затем ужесточать параметры по одному (до `transport-strict`).

## Выполнено после релиза (camera: fast-pass tuning + probes archived, 2026-02-18)

- Что сделано:
  - добавлен архив проб `Docs/auto/camera-probes/INDEX.md` + JSONL-сырые сэмплы по 60s окнам (door-2);
  - зафиксировано ограничение USB2 (`usb_speed=HIGH`): попытка `CAM_DEPTH_COUNT_FPS=15` в depth-counting приводит к `X_LINK_ERROR` и “пустым” метрикам (`messages=0`).
  - выполнен тюнинг “быстрее без роста FPS”:
    - `FPS=10`, расширение mid зоны (`line_gap_norm=0.14`, `axis_hyst=0.01`);
    - снижены пороги для быстрых проходов (`min_track_age=2`, `confidence_min=0.35`).
- Зачем:
  - на транспорте проходы быстрые; нужно снизить задержку срабатывания, но не уронить стабильность USB линка.
- Результат:
  - в 60s окне `door-2-probe-fast-20260218-0902Z.jsonl`: `d_events=1`, `zone_flip_no_middle=0` (середина прохода стала устойчивее).
- Следующий этап и зачем:
  - провести валидный 60s прогон “fast-pass v2” с реальными быстрыми проходами (10–20) и после этого по метрикам решить: оставляем `min_track_age=1` или откатываем, и нужно ли снижать `confidence_min`.

## Выполнено после релиза (web-panel: Client MVP step-3 IA/UX polish, 2026-02-16)

- Что сделано:
  - в `client_ui_kit` добавлен унифицированный secondary-паттерн (`<details>` + persisted state);
  - `client_tickets_page.py` разделён на `Активні звернення` (primary) и `Архів` (secondary);
  - `client_status_page.py` разделён на `Потребує уваги зараз` (primary) и `Повна стрічка` (secondary);
  - сохранены shareable URL фильтров и `copyLink` для клиентских сценариев.
- Результат:
  - снижена когнитивная нагрузка на первых экранах клиента;
  - подробная история доступна без визуального шума.
- Server-first проверка:
  - deploy на VPS и `scripts/admin_panel_smoke_gate.sh` — PASS.
- Следующий этап и зачем:
  - `Client MVP step-4` (роль `admin-support` + mobile tuning), чтобы завершить продуктовый контур поддержки клиента в едином стиле.

## Выполнено после релиза (web-panel: Client MVP step-4 role/mobile, 2026-02-16)

- Что сделано:
  - в client-контур добавлена роль `admin-support` (`/api/client/whoami.role`, env `CLIENT_SUPPORT_USERS`);
  - на страницах `Огляд/Тікети/Статуси` добавлен role-chip;
  - выполнен mobile tune таблиц (`mobileFriendly`, `mobileHide`) и toolbar-потока;
  - `Тікети/Статуси` получили support-aware default secondary state.
- Результат:
  - клиентский UI остался минималистичным в роли `client` и стал удобнее для поддержки в роли `admin-support`;
  - улучшена читаемость на мобильных экранах.
- Server-first проверка:
  - deploy на VPS и `scripts/admin_panel_smoke_gate.sh` — PASS.
- Следующий этап и зачем:
  - `Client MVP step-5`: доработать `home/vehicles` под SLA/ETA сценарии, чтобы завершить продуктовый UX-контур клиента.

## Выполнено после релиза (web-panel: Client MVP step-5 SLA/ETA, 2026-02-16)

- Что сделано:
  - `backend/app/client_ops.py` расширен SLA/ETA view-model:
    - `home.summary`: `sla_risk/sla_warn/eta_avg_delay_min/eta_max_delay_min`;
    - `home.attention`: список транспортов, требующих внимания;
    - `vehicles`: `sla_state`, `eta_delay_min`, `pending_batches`, `incidents_open` и SLA/ETA summary;
    - добавлен safe-parser `_to_int` для стабильной сериализации числовых полей.
  - `backend/app/client_home_page.py`:
    - добавлены KPI `SLA`/`ETA`;
    - добавлен primary-блок `Потребує дії зараз`.
  - `backend/app/client_vehicles_page.py`:
    - добавлен SLA-фильтр (`all/attention/risk/warn/ok`);
    - введены `primary + secondary` сценарии (`Потребують уваги` + `Усі транспорти`).
- Зачем:
  - перевести `home/vehicles` с общего статуса на понятные SLA/ETA сценарии и уменьшить перегруз в первом экране клиента.
- Результат:
  - server-first deploy выполнен;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `/api/client/home` и `/api/client/vehicles` подтверждают новые SLA/ETA поля в runtime.
- Следующий этап и зачем:
  - `Client MVP step-6`: role-aware polish для `Профіль/Сповіщення`, чтобы завершить end-to-end UX клиента.

## Выполнено после релиза (web-panel: Client MVP step-6 account role-aware, 2026-02-16)

- Что сделано:
  - `backend/app/client_profile_page.py`:
    - добавлены role-chip, summary KPI и support-secondary блок `profileSupportDetails`;
    - reset переведён в безопасный режим (восстановление сохранённого состояния).
  - `backend/app/client_notifications_page.py`:
    - добавлены role-chip, summary KPI, quick presets (`critical/balanced/realtime`);
    - добавлен support-secondary блок `notifySupportDetails`.
  - для обоих account-разделов выровнен паттерн `summary -> form -> secondary details`.
- Зачем:
  - завершить продуктовый client-контур без визуальной перегрузки и с единым role-aware поведением для поддержки.
- Результат:
  - server-first deploy выполнен;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - marker-check `/client/profile` и `/client/notifications` подтверждает новые e2e маркеры.
- Следующий этап и зачем:
  - `Client MVP step-7`: провести финальный UX-audit по real-data сценариям и зафиксировать регрессионный checklist.

## Выполнено после релиза (web-panel: Client MVP step-7a regression gate, 2026-02-16)

- Что сделано:
  - добавлен `scripts/client_panel_regression_check.sh` для account-контура клиента;
  - скрипт проверяет:
    - auth/anon статусы для `/client/profile`, `/client/notifications`,
      `/api/client/profile`, `/api/client/notification-settings`;
    - role-aware маркеры на account-страницах;
    - базовую валидность account API payload (`status=ok`).
- Результат:
  - `./scripts/client_panel_regression_check.sh --admin-pass-file "pass admin panel"` — `RESULT: PASS`.
- Следующий этап и зачем:
  - `Client MVP step-7b`: завершить real-data UX-аудит и оформить финальный регрессионный checklist для клиентского контура.

## Выполнено после релиза (web-panel: Client MVP step-7b real-data UX audit, 2026-02-16)

- Что сделано:
  - добавлен `scripts/client_panel_step7b_audit.py`;
  - внедрён автоматический отчёт `Docs/auto/web-panel/client-step7b-ux-audit.md`.
- Аудит покрывает:
  - auth/anon статусы для client UI/API (`200/401`);
  - контракт полей для `whoami/home/vehicles/profile/notification-settings`;
  - role-aware маркеры на `/client/profile` и `/client/notifications`.
- Результат:
  - `python3 scripts/client_panel_step7b_audit.py --admin-pass-file "pass admin panel"` — `RESULT: PASS`.
- Следующий этап и зачем:
  - `Client MVP step-8`: зафиксировать операторский acceptance-playbook для режима `admin-support` и передачи смены.

## Выполнено после релиза (web-panel: Client MVP step-8a support playbook, 2026-02-16)

- Что сделано:
  - добавлен `Docs/Проект/Операции/Client admin-support playbook.md`;
  - playbook покрывает preflight, сценарии `client/admin-support` и rollback.
- Текущее baseline-состояние:
  - `/api/client/whoami` возвращает `role=client`, `support_console=false`.
- Следующий этап и зачем:
  - `Client MVP step-8b`: выполнить acceptance в режиме `admin-support` и зафиксировать результат для handoff смены.

## Выполнено после релиза (web-panel: Client MVP step-8b support acceptance, 2026-02-16)

- Что сделано:
  - проведён controlled acceptance-run режима `admin-support` на сервере;
  - подтверждён `whoami.role=admin-support` при временном `CLIENT_SUPPORT_USERS=admin`;
  - выполнены `smoke_gate`, `client_panel_regression_check`, `client_panel_step7b_audit` в support-режиме.
- Rollback:
  - восстановлен backup `.env.step8b.20260216162039.bak`;
  - подтверждён возврат к `whoami.role=client`;
  - повторный smoke-gate = PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step8b-support-acceptance.md`.
- Следующий этап и зачем:
  - `Client MVP step-9`: внедрить постоянный rollout support-логинов (без использования `admin`) и закрепить это в operational policy.

## Выполнено после релиза (web-panel: Client MVP step-9 dedicated support rollout, 2026-02-16)

- Что сделано:
  - добавлен `scripts/client_support_rollout.sh`;
  - внедрён nginx auth split:
    - `/client*` и `/api/client/*` -> `passengers-client.htpasswd`;
    - `/admin*` и `/api/admin/*` -> `passengers-admin.htpasswd`;
  - установлен policy `CLIENT_SUPPORT_USERS=support`.
- Проверки:
  - `support` -> `/api/client/whoami` -> `role=admin-support`;
  - `support` -> `/api/admin/whoami` -> `401`;
  - `admin` -> `/api/client/whoami` -> `role=client`;
  - smoke/regression/audit/security checks — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step9-support-rollout.md`.
- Следующий этап и зачем:
  - `Client MVP step-10`: расширить rollout на несколько support-логинов и scope-bindings для изоляции клиентских контуров.

## Выполнено после релиза (web-panel: Client MVP step-10 support scope isolation, 2026-02-16)

- Что сделано:
  - добавлен `scripts/client_scope_rollout.sh`;
  - применён `CLIENT_SCOPE_BINDINGS=support:sys-0001`;
  - подтверждена scope-изоляция support-логина на уровне client API.
- Проверки:
  - `support` -> `/api/client/whoami` содержит `scope.central_ids=["sys-0001"]`;
  - `support` -> `/api/client/vehicles` ограничен scoped данными (`total=1`);
  - smoke/regression/audit checks — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step10-scope-rollout.md`.
- Следующий этап и зачем:
  - `Client MVP step-11`: ввести policy-шаблон multi-support onboarding (`support-<system_id>` + scope binding matrix).

## Выполнено после релиза (web-panel: Client MVP step-11 multi-support onboarding policy, 2026-02-16)

- Что сделано:
  - добавлен `scripts/client_support_matrix_rollout.sh`;
  - добавлен шаблон матрицы onboarding `Docs/Проект/Операции/client-support-onboarding-matrix.example`;
  - применён actor policy `support-<system_id>` на сервере;
  - установлен `CLIENT_SUPPORT_USERS=support-sys-0001`;
  - установлен `CLIENT_SCOPE_BINDINGS=support-sys-0001:sys-0001`;
  - legacy `support` удалён из `/etc/nginx/passengers-client.htpasswd`.
- Проверки:
  - `support-sys-0001` -> `/api/client/whoami` = `200`, `role=admin-support`, `scope.central_ids=["sys-0001"]`;
  - `support-sys-0001` -> `/api/admin/whoami` = `401`;
  - `admin` -> `/api/client/whoami` -> `role=client`;
  - smoke/regression/audit/security checks — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step11-multi-support-onboarding.md`.
- Следующий этап и зачем:
  - `Client MVP step-12`: стандартизовать lifecycle support-акторов (`disable/rotate/revoke`) без downtime.

## Выполнено после релиза (web-panel: Client MVP step-12 support actor lifecycle, 2026-02-16)

- Что сделано:
  - добавлен `scripts/client_support_lifecycle_rollout.sh`;
  - проведён controlled lifecycle scenario для временного actor `support-sys-0099`:
    - `rotate` (старый пароль revoked, новый активен),
    - `disable` (удаление из `CLIENT_SUPPORT_USERS` + htpasswd),
    - `revoke` (удаление из `CLIENT_SCOPE_BINDINGS`).
  - подтверждено отсутствие влияния на основной actor `support-sys-0001`.
- Проверки:
  - `support-sys-0099` после revoke: `/api/client/whoami` = `401`;
  - `support-sys-0001` остаётся `role=admin-support`;
  - финальный server state:
    - `CLIENT_SUPPORT_USERS=support-sys-0001`
    - `CLIENT_SCOPE_BINDINGS=support-sys-0001:sys-0001`
  - smoke/regression/audit/security checks — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step12-support-lifecycle-rollout.md`.
- Следующий этап и зачем:
  - `Client MVP step-13`: внедрить automation pack для lifecycle (rotation schedule + actor inventory report).

## Выполнено после релиза (web-panel: Client MVP step-13 lifecycle automation pack, 2026-02-16)

- Что сделано:
  - добавлены `scripts/client_support_rotation_batch.sh`, `scripts/client_support_inventory_report.sh`, `scripts/install_client_support_lifecycle_timer.sh`;
  - выполнен batch rotate активного actor `support-sys-0001`;
  - на сервере установлены timers:
    - `passengers-client-support-inventory.timer` (daily inventory),
    - `passengers-client-support-rotation-reminder.timer` (monthly reminder).
- Проверки:
  - old password для `support-sys-0001` после rotation: `401`;
  - new password для `support-sys-0001`: `200`;
  - smoke/regression/audit/security checks — PASS;
  - inventory report status — `PASS`.
- Артефакт:
  - `Docs/auto/web-panel/client-step13-lifecycle-automation-pack.md`.
- Следующий этап и зачем:
  - `Client MVP step-14`: финальный UX polish client navigation и progressive disclosure.

## Выполнено после релиза (web-panel: Client MVP step-14 UX polish navigation, 2026-02-16)

- Что сделано:
  - клиентский sidebar переведён в компактный persistent-режим;
  - навигация клиента переведена в grouped `меню -> подменю` через `<details>`;
  - для table-heavy страниц добавлен progressive toggle `Колонки: базово/детально`;
  - secondary table columns вынесены в `progressiveCol`.
- Server-first rollout:
  - `rsync` обновлённых `client_*` модулей в `/opt/passengers-backend/app`;
  - `py_compile` и `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`.
- Проверки:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step14-ux-polish-rollout.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step14.md`.
- Следующий этап и зачем:
  - `Client MVP step-15`: a11y/keyboard flow и финальный copy-audit клиентского shell, чтобы зафиксировать единый UX-стандарт без визуального дрейфа.

## Выполнено после релиза (web-panel: Client MVP step-15 a11y + keyboard flow + copy audit, 2026-02-16)

- Что сделано:
  - в `client_ui_kit` внедрён a11y baseline (`skip-link`, `focus-visible`, `aria-live`);
  - добавлен keyboard-flow контур (`/`, `Esc`, `Alt+Shift+M/K/S/T`);
  - выполнен copy-audit account-домена (`Профіль/Сповіщення`) без изменения API-контрактов;
  - regression/audit marker checks расширены на новые shell-маркеры (`skipLink`, `sideCompactToggle`, `clientMainContent`).
- Server-first rollout:
  - `rsync` обновлённых `client_*` модулей в `/opt/passengers-backend/app`;
  - `py_compile` и `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`.
- Проверки:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step15-a11y-keyboard-copy-rollout.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step15.md`.
- Следующий этап и зачем:
  - `Client MVP step-16`: провести keyboard-only acceptance сценарии и зафиксировать финальный DoD client shell.

## Выполнено после релиза (web-panel: Client MVP step-16 keyboard-only acceptance + final DoD, 2026-02-16)

- Что сделано:
  - добавлен `scripts/client_panel_step16_accessibility_check.sh`;
  - скрипт выполняет acceptance-проверки keyboard/a11y shell маркеров и account copy-маркеров;
  - оформлен отдельный acceptance-отчёт step-16.
- Server-first валидация:
  - `./scripts/client_panel_step16_accessibility_check.sh --admin-user support-sys-0001 --admin-pass-file "pass client support sys-0001 panel step13-rotated" --write Docs/auto/web-panel/client-step16-accessibility-acceptance.md` — PASS;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step16-accessibility-acceptance.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step16.md`.
- Следующий этап и зачем:
  - `Client MVP step-17`: release-candidate stabilization и handoff checklist перед фиксацией клиентского UX как production baseline.

## Начато после релиза (web-panel: Client MVP step-17 RC IA freeze kickoff, 2026-02-16)

- Что сделано:
  - добавлен канон IA меню/подменю `Docs/Проект/Веб-панель/Архитектура меню (admin+client).md`;
  - обновлены индексы и runbook (`INDEX`, `Операции`, `Client admin-support playbook`, `Сервер backend и VPN`);
  - `step-16` acceptance включён в preflight-контур playbook.
- Контрольный server-first прогон:
  - `scripts/client_panel_step16_accessibility_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакт kickoff:
  - `Docs/auto/web-panel/client-step17-rc-kickoff.md`.
- Следующий этап и зачем:
  - закрыть `Client MVP step-17` финальным handoff checklist, чтобы зафиксировать RC baseline перед следующими UI-итерациями.

## Выполнено после релиза (web-panel: Client MVP step-17 handoff checklist automation, 2026-02-16)

- Что сделано:
  - добавлен `scripts/client_panel_step17_handoff_check.sh`;
  - оформлен единый RC/handoff прогон всех обязательных gate-проверок;
  - обновлены docs-референсы на новый checklist script/report.
- Server-first валидация:
  - `./scripts/client_panel_step17_handoff_check.sh --write Docs/auto/web-panel/client-step17-handoff-checklist.md` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step17-handoff-checklist.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step17.md`.
- Следующий этап и зачем:
  - `Client MVP step-18`: провести content-split и visual-density аудит по зафиксированной IA-карте, чтобы уменьшить перегрузку экранов без потери контекста.

## Выполнено после релиза (web-panel: step-18 visual polish packs 18-22, 2026-02-17)

- Что сделано:
  - выполнены `step-18` visual polish pack-и для admin/client (IA sidebar, core компоненты, tables readability).
  - унифицированы core-правила `Ядро + Домены` (навигация, размеры контролов, `<details>`, таблицы).
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack18-sidebar-architecture.md`;
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack19-sidebar-refine.md`;
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack20-core-components.md`;
  - `Docs/auto/web-panel/client-step18-visual-polish-pack21-client-core-components.md`;
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack22-tables.md`;
  - `Docs/auto/web-panel/client-step18-visual-polish-pack22-tables.md`;
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack22-tables-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-23 subnav + empty-state, 2026-02-17)

- Что сделано:
  - subnav переведён в горизонтальный scroll (меньше высоты header при большом количестве пунктов).
  - добавлен единый empty-state для пустых таблиц через Core JS (без правок каждой страницы).
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack23-subnav-empty.md`;
  - `Docs/auto/web-panel/client-step18-visual-polish-pack23-subnav-empty.md`;
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack23-subnav-empty-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-24 sections + empty-tone, 2026-02-17)

- Что сделано:
  - введён единый “ритм секций” (`sectionHead/sectionTitle/sectionTools`) для admin/client.
  - empty-state таблиц стал семантичным: поддержка `OK`/tone без ручных строк в каждой таблице.
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack24-sections-emptytone.md`;
  - `Docs/auto/web-panel/client-step18-visual-polish-pack24-sections-emptytone.md`;
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack24-sections-emptytone-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-25 client sidebar search, 2026-02-17)

- Что сделано:
  - добавлен поиск по меню в client sidebar (input + фильтрация групп/ссылок + hotkeys).
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack25-client-sidebar-search.md`;
  - `Docs/auto/web-panel/client-step18-visual-polish-pack25-client-sidebar-search.md`;
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack25-client-sidebar-search-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-26 header chips, 2026-02-17)

- Что сделано:
  - chips в header переведены на горизонтальный scroll (admin+client), чтобы не раздувать высоту header.
  - `applyEmptyTables()` теперь удаляет empty-row, если в таблице появились реальные строки.
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack26-header-chips.md`;
  - `Docs/auto/web-panel/client-step18-visual-polish-pack26-header-chips.md`;
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack26-header-chips-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-27 sidebar minimal, 2026-02-17)

- Что сделано:
  - `Simple` sidebar сделан минимальным: скрываются все mini-блоки (`quick/hub/mission/cheat/favorites/recent/session`), остаётся только навигация.
  - `Фокус` sidebar переведён в nav-only режим.
  - mission sidebar ticker выполняется только когда mission sidebar активен (без лишних обновлений в `Simple/Фокус`).
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack27-sidebar-minimal.md`;
  - `Docs/auto/web-panel/admin-step18-visual-polish-pack27-sidebar-minimal-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-28 chips no-nav, 2026-02-17)

- Что сделано:
  - зафиксирован канон: chips в header = только контекст, навигация вынесена в `subnav/toolbar`.
  - client pages: удалены навигационные `<a class="chip"...>` из header.
  - admin incident detail: ссылки “← інциденти” и “вузол” перенесены из chips в toolbar.
  - UI/UX skill обновлён правилом “запрет ссылок в chips”.
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack28-chips-no-nav.md`;
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack28-chips-no-nav-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-29 client toolbar rhythm, 2026-02-17)

- Что сделано:
  - `clientToolbar` стал визуальным контейнером (padding/border/background) уровня Core.
  - `updatedAt` перенесён из toolbar в chips (контекст), toolbar остаётся controls-only.
  - UI/UX skill дополнен каноном client toolbar rhythm.
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack29-client-toolbar-rhythm.md`;
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack29-client-toolbar-rhythm-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-30 client toolbar rows, 2026-02-17)

- Что сделано:
  - `clientToolbar` переведён на структуру `toolbarMain + toolbarMeta` для предсказуемого переноса строк.
  - client страницы приведены к единому порядку controls/meta, убраны лишние `smallbtn` внутри toolbar.
  - Core doc + UI/UX skill обновлены каноном toolbar rows.
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack30-client-toolbar-rows.md`;
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack30-client-toolbar-rows-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-31 admin toolbar rows, 2026-02-17)

- Что сделано:
  - admin toolbar получил канон `toolbarMain + toolbarMeta` (controls отдельно от meta/status).
  - ключевые страницы (`fleet/alerts/incidents/audit/notify-center`) приведены к канону; `copyLink` унифицирован по размеру (не `smallbtn`).
  - Core doc + UI/UX skill обновлены правилом admin toolbar rhythm.
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack31-admin-toolbar-rows.md`;
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack31-admin-toolbar-rows-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-32 admin toolbar migrate, 2026-02-17)

- Что сделано:
  - container-стиль `toolbar` ограничен только header (`header .toolbar`), чтобы inline `.toolbar` в карточках не получал лишний бордер/фон.
  - добавлен `toolbarBtn` для ссылок в header toolbar (выглядит как кнопка).
  - остальные admin страницы переведены на `toolbarMain + toolbarMeta`, `copyLink` унифицирован (не `smallbtn`).
  - Core doc + UI/UX skill обновлены.
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_step17_handoff_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack32-admin-toolbar-migrate.md`;
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack32-admin-toolbar-migrate-checklist.md`.

## Выполнено после релиза (web-panel: step-18 visual polish pack-33 admin core utilities + inline-style reduction, 2026-02-18)

- Что сделано:
  - В Core (`admin_ui_kit`) добавлен каноничный паттерн “status box”: `.wgBox/.wgTitle/.wgSummary/.wgHint`.
  - Добавлены admin utilities для замены повторяющихся inline-стилей: `.uMt*`, `.uMb*`, `.uJcStart`, `.uInlineRow`, `.uMinW*`, `.uMaxH40vh`, `.tableWrapPre`.
  - Страницы доменов частично переведены на utilities (overview/commission/policy/notifications/wg), локальные дубликаты `.wgBox` убраны.
- Server-first валидация:
  - `scripts/admin_panel_smoke_gate.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack33-admin-core-utilities-inline-style.md`;
  - `Docs/auto/web-panel/webpanel-step18-visual-polish-pack33-admin-core-utilities-inline-style-checklist.md`.

## Выполнено после релиза (camera: transport-fast-pass v3 + стабильность видео, 2026-02-18)

- Что сделано:
  - В `mvp/camera_transport_strict_counting.py` добавлено:
    - чтение `CAM_JPEG_QUALITY` из env (управление качеством MJPEG);
    - метрика `middle_inferred` + логика “span-middle inference” для быстрых проходов (меньше пропусков при скачке зоны за кадр).
  - Добавлен preset `transport-fast-pass` в `scripts/camera_depth_calibrate.sh` (commissioning‑профиль под быстрые проходы).
  - Исправлен порядок применения `--preset` vs `--set` в `scripts/camera_depth_calibrate.sh` (теперь `--set` всегда overrides preset).
  - В `scripts/camera_mode_menu.sh` и `scripts/camera_mode_switch.sh` добавлен `ssh -n`, чтобы меню/скрипты корректно работали в non-interactive (stdin не “съедается” ssh).
- Факт стенд‑прогона (door-2 `192.168.10.11`):
  - `axis_pos=0.25` (линии в области дверного проёма);
  - probe: `Docs/auto/camera-probes/door-2-probe-fast-v3-20260218-093014Z.jsonl` (`d_events=15`, `d_in=8`, `d_out=7`, `zone_flip_no_middle=0`).
- Документация обновлена:
  - `Docs/Проект/Операции/Камера OAK-D Lite (Luxonis).md`
  - `Docs/auto/camera-probes/INDEX.md`

Дополнение (канон Luxonis):

- Зафиксировано правило: любую спорную/неочевидную часть поведения камеры сначала проверяем по официальной документации `https://docs.luxonis.com/` и `https://docs.luxonis.com/software-v3/depthai/`.

Дополнение (preview нагрузка):

- Добавлены параметры снижения нагрузки при включённом видео:
  - `CAM_PREVIEW_SIZE`, `CAM_PREVIEW_FPS` (уменьшают размер/частоту MJPEG);
  - `CAM_JPEG_QUALITY` (качество JPEG).

Дополнение (UI переключение видео):

- В `passengers-camera-depth-counting.service` добавлен UI-переключатель preview:
  - `/?view=stats` — режим “только большой счётчик” (preview авто‑выключается);
  - кнопка `Video: ON/OFF` — включает/выключает preview без рестарта сервиса.

## Выполнено после релиза (camera: центр линий + crowd tuning, 2026-02-18)

- Что зафиксировано:
  - линии перенесены в центр: `CAM_DEPTH_COUNT_AXIS=x`, `CAM_DEPTH_COUNT_AXIS_POS=0.50` (`line_a=0.43`, `line_b=0.57`);
  - попытка поднять `CAM_DEPTH_COUNT_FPS=15` на USB2 (`usb_speed=HIGH`) приводит к частым `X_LINK_ERROR` → рабочий `FPS=10` на стенде;
  - добавлен downscale depth output для host depth-gate: `CAM_DEPTH_OUTPUT_SIZE=320x200`;
  - включён crowd tuning трекера:
    - `CAM_DEPTH_COUNT_TRACKER_TYPE=short_term_kcf`
    - `CAM_DEPTH_COUNT_TRACKER_OCCLUSION_RATIO=0.60`
    - `CAM_DEPTH_COUNT_TRACKER_MAX_OBJECTS=15`
- Артефакты теста:
  - `Docs/auto/camera-probes/door-2-centeredlines-60s-20260218-112052Z.jsonl` (`d_events=8`, `d_in=4`, `d_out=4`).

## Выполнено после релиза (webpanel v2: Core+Domains, 2026-02-23)

- Запущен v2 каркас web-панели на `Jinja2 + HTMX` параллельно v1 (префиксы: `/admin2`, `/client2`).
- Принята структура `Core + Domains` для v2:
  - `backend/app/webpanel_v2/core/*`
  - `backend/app/webpanel_v2/domains/*`
- v2 роуты вынесены из `backend/app/main.py` в `APIRouter` и подключаются через `app.include_router(...)`.
- IA меню v2 согласовано с каноном `Docs/Проект/Веб-панель/Архитектура меню (admin+client).md` (v1+v2 маршруты).
