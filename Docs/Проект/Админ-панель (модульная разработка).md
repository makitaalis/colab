# Админ-панель (модульная разработка)

Документ фиксирует целевую модульную схему админки и правила внедрения новых блоков без регрессий.

## Цель

- уйти от хаотичных точечных правок;
- разделить ответственность по модулям UI/API;
- обеспечить быстрый rollout для 100–200 систем (`sys-XXXX`) с предсказуемой поддержкой.

## Единый стандарт UI/UX

- Обязательный источник визуальных правил и структуры экранов:
  - `Docs/Проект/Админ-панель (UI-UX стандарт).md`
- Любая UI/UX правка должна сначала сверяться со стандартом, затем внедряться в код и только после этого идти в rollout.

## Актуальные модули админки

1. `fleet-overview`
   - UI: `/admin/fleet`
   - API: `/api/admin/fleet/overview`, `/api/admin/fleet/monitor`, `/api/admin/fleet/ops-feed`
   - Назначение: единая оперативная картина по central.

2. `commissioning`
   - UI: `/admin/commission`
   - API: `/api/admin/wg/peers`, `/api/admin/whoami`, `/api/admin/fleet/centrals`, `/api/admin/fleet/incidents` (без новых контрактов)
   - Назначение: быстрый шаблон подключения нового транспорта end-to-end (реестр → API keys → WG → env → commissioning-check → валидация в админке).
   - UX: кнопка `Копіювати звіт` собирает evidence bundle для `sys-XXXX` (статус WG/heartbeat/queue/incidents + ссылки).
   - UX: блок `Перевірки (локально)` — копирование команд `fleet_commission.py`/`mvp_e2e_smoke.sh` + ручные отметки PASS/FAIL (localStorage).
   - UX: `Експорт/Імпорт` run-лога commissioning (JSON) — перенос истории между операторами/ПК.
   - UX: явные кнопки identity control: `Підставити vehicle` (vehicle_id<-backend) и `Скинути plate`.
   - UX: блок `Профілі (локально)` — сохранение профиля per `central_id` (vehicle_id/plate/IP) + экспорт/импорт JSON.

3. `alerts-ops`
   - UI: `/admin/fleet/alerts`, `/admin/fleet/incidents`
   - API: `/api/admin/fleet/alerts`, `/api/admin/fleet/alerts/groups`, `/api/admin/fleet/alerts/actions`
   - Назначение: triage алертов, групповые и массовые действия.

4. `incident-detail`
   - UI: `/admin/fleet/incidents/{central_id}/{code}`, `/admin/fleet/central/{central_id}`
   - API: `/api/admin/fleet/incidents`, `/api/admin/fleet/incidents/{central_id}/{code}`, `/api/admin/fleet/alerts/state/{central_id}/{code}`
   - Назначение: разбор конкретного инцидента и состояния central.

5. `notify-center`
   - UI: `/admin/fleet/notifications`, `/admin/fleet/notify-center`
   - API: `/api/admin/fleet/notification-settings`, `/api/admin/fleet/incidents/notifications`, `/api/admin/fleet/notifications/retry`
   - Назначение: каналы уведомлений и контроль доставок.

6. `policy-kpi`
   - UI: `/admin/fleet/policy`, `/admin/fleet/history`
   - API: `/api/admin/fleet/monitor-policy`, `/api/admin/fleet/monitor-policy/overrides`, `/api/admin/fleet/metrics/history`
   - Назначение: пороги/overrides и KPI по времени.

7. `wg-ops`
   - UI: `/admin/wg`
   - API: `/api/admin/wg/peers`, `/api/admin/wg/conf`
   - Назначение: контроль WireGuard peer и handshake.

## Правила модульной разработки

1. Один модуль = один публичный UI route + свой набор API, без скрытых зависимостей на чужой DOM.
2. Любое действие operator/admin выполняется только через API с аудитом (`/api/admin/audit`).
3. Фильтры модулей должны быть idempotent: refresh не ломает выбранный контекст.
4. UI/UX решения должны соответствовать `Docs/Проект/Админ-панель (UI-UX стандарт).md` (иерархия, статистика, фильтры, состояния, тексты).
5. Все массовые операции (`ack/silence/unsilence`) обязаны:
   - показывать итог `успех/ошибка`;
   - переживать частичные сбои;
   - не менять чужие фильтры.
6. `central_id` всегда равен `system_id` (`sys-XXXX`) для масштабируемости и правильных override/alerts/incidents.
7. При любом UI изменении обязательно:
   - `python3 -m py_compile backend/app/main.py`;
   - `python3 -m py_compile backend/app/admin_ui_kit.py`;
   - smoke curl к новым/изменённым API;
   - проверка HTML route через `curl -k -u ... https://127.0.0.1:8443/...`.
8. Для каждого нового UI route в `main.py` оставляется только thin-wrapper:
   - `return render_<module>_page()` для sync helper;
   - `return await render_<module>_page()` только если helper async и это обосновано.
9. Нельзя смешивать в одном этапе сразу UI, API и DB-миграции для разных модулей; один этап = одна зона ответственности.
10. Перед merge/deploy фиксируется матрица smoke:
   - UI route (200);
   - API route (200/ожидаемый 4xx);
   - `docker logs` без `ResponseValidationError`/`Traceback`.
11. Любая правка админки обязана обновить:
   - `Docs/Проект/Админ-панель (модульная разработка).md`;
   - `Docs/Проект/Админ-панель (UI-UX стандарт).md` (если правка затрагивает визуальные правила);
   - `Docs/Проект/Промпты Codex (админка).md`;
   - `Docs/Проект/Скиллы Codex.md` (если добавлен новый skill).
12. Формат отчёта по этапу обязателен:
   - явно указать, что сделано в текущем этапе и зачем;
   - явно указать следующий этап, что будет сделано в нём и зачем это нужно проекту.

## UI shell (golden shell)

- Единый shell для всех страниц: `render_admin_shell(..., current_nav=...)` в `backend/app/admin_ui_kit.py`.
- Sidebar-режимы (сохраняются в `localStorage`):
  - `Просто/Розширено` (по умолчанию `Просто`) — скрывает “тяжёлые” блоки (Mission Control / Command Hub / hotkeys / favorites / recent / session) и оставляет чистую навигацию.
  - `Компакт/Комфорт` — плотность меню.
  - `Підказки` — onboarding по навигации.
- Сворачиваемые зоны (управляются режимом sidebar):
  - `<details class="toolbarDetails">Фільтри</details>` — “доп. фильтры” в header.
  - `<details class="advancedDetails">Розширені інструменти</details>` — контекст/пресеты/команды.
- Ключи хранения режимов:
  - `passengers_admin_sidebar_simple_mode_v1`
  - `passengers_admin_sidebar_compact_mode_v1`

## Shareable URLs (фильтры в query string)

Цель: чтобы оператор мог копировать URL из адресной строки и открывать те же фильтры (полезно при масштабе 100–200 систем).

UX-правило:

- В header на страницах `fleet/alerts/incidents` есть:
  - кнопка `Скопіювати посилання` — копирует текущий URL (включая query с фильтрами);
  - `фільтри: ...` — краткое резюме активных фильтров (видно без раскрытия блока `Фільтри`).

Стандартные параметры:

- `/admin`
  - `q` — фільтр по огляду (central/vehicle/code/message)
  - `central_id` — префілл commissioning-карточки (швидкі посилання на вузол/інциденти/policy/notify-center)
    - удобен на раннем этапе, когда ещё нет heartbeat: можно “закрепить” контекст `sys-XXXX` и быстро пройтись по страницам
    - UI подсказки также показывают кликабельные WG peers (по `/api/admin/wg/peers`) для подстановки `central_id` в один клик

- `/admin/fleet`
  - `q` — поиск
  - `central_id` — фильтр по вузлу
  - `code` — фильтр по коду
  - `severity` — `good|warn|bad`
  - `include_silenced=1`
  - `only_alerts=1`
  - `ops_window` — `1h|6h|24h|7d`

- `/admin/commission`
  - `central_id` — контекст commissioning (system_id)
  - `central_ip` — optional (дефолт `192.168.10.1`)
  - `door1_ip` — optional (дефолт `192.168.10.11`)
  - `door2_ip` — optional (дефолт `192.168.10.12`)
  - `vehicle_id` — optional (людиночитаемый bus_id, например `bus-017`)
  - `plate` — optional (номер, например `AA1234BB`)
  - UX: якщо central вже є у fleet (`/api/admin/fleet/centrals`) — `vehicle_id` підтягується автоматично (коли поле було порожнє).

- `/admin/fleet/alerts`
  - `q`, `central_id`, `code`
  - `severity` — `good|warn|bad`
  - `include_silenced=1`

- `/admin/fleet/incidents`
  - `q`, `central_id`, `code`
  - `status` — `open|acked|silenced|resolved`
  - `severity` — `good|warn|bad`
  - `include_resolved=0`
  - `sla_breached_only=1`

- `/admin/fleet/notify-center`
  - `window` — `1h|24h|7d` (24h по умолчанию)
  - `status` — `failed|skipped|sent`
  - `channel` — `telegram|email|policy`
  - `central_id`, `code`, `q`
  - `dry_run=1` (retry)

- `/admin/fleet/history`
  - `window` — `1h|6h|24h|7d` (24h по умолчанию)
  - `bucket_sec` — `60|300|900|3600` (300 по умолчанию)

- `/admin/fleet/policy`
  - `central_id` — префілл `Персональні override-и → ID вузла` (контекст)

- `/admin/fleet/actions`
  - `q`, `central_id`, `code`
  - `action` — `ack|silence|unsilence`

- `/admin/audit`
  - `window` — `1h|24h|7d` (24h по умолчанию)
  - `status` — `ok|forbidden|error`
  - `role` — `viewer|operator|admin`
  - `actor`, `action`, `q`

- `/admin/wg`
  - `q` — пошук по пір-даним (name/IP/endpoint/pubkey)

- `/admin/fleet/central/{central_id}`
  - `central_id` — береться з path (контекст сторінки)

## Definition of Done для нового модуля

1. Есть UI route, есть API контракт, есть ссылка из навигации.
2. Доступы ролей (`viewer/operator/admin`) учтены в UI и API.
3. Ошибки API отображаются оператору без белого экрана.
4. Документация обновлена:
   - `Docs/Проект/INDEX.md`
   - `Docs/Проект/Операции.md`
   - `Docs/Проект/Проблемы.md` (если есть новый класс сбоев)
5. Есть повторяемый чек deploy на VPS (`/opt/passengers-backend`).

## План выделения кода из монолита

Текущее состояние: UI/API сосредоточены в `backend/app/main.py`.

Этапы:

1. Вынести `alerts-ops` в отдельный модуль Python (`backend/app/admin_alerts_ops.py`) с thin-routes в `main.py`. ✅
2. Вынести `fleet-overview` UI и monitor orchestration в отдельные файлы (`admin_fleet_page.py`, `admin_fleet_monitor_ops.py`). ✅
3. Вынести `policy-kpi` UI routes (`/policy`, `/history`) в модульные страницы. ✅
4. Вынести `notify-center` UI routes (`/notifications`, `/notify-center`) в модульные страницы. ✅
5. Вынести `incident-detail` и `incidents` UI pages в отдельные файлы. ✅
6. Вынести `actions` и `audit` UI pages в отдельные файлы. ✅
7. Зафиксировать модульные smoke-скрипты по каждому route/API и добавить единый gate в rollout-check. ✅

Пока это не сделано, все изменения в `backend/app/main.py` должны идти по модульным секциям и с обязательным grep-check по id/route, чтобы не повторять инцидент с белым экраном.

## Статус этапа (2026-02-09)

- выполнен phase-1 extraction для `alerts-ops`:
  - бизнес-логика ответов `/api/admin/fleet/alerts` и `/api/admin/fleet/alerts/groups` вынесена в `backend/app/admin_alerts_ops.py`;
  - в `backend/app/main.py` оставлены thin-routes с теми же URL/параметрами.

- выполнен phase-2 extraction для UI:
  - HTML/JS route `/admin/fleet/alerts` вынесен в `backend/app/admin_fleet_alerts_page.py`;
  - в `backend/app/main.py` route оставлен как thin-wrapper (`return render_admin_fleet_alerts_page()`).

- выполнен phase-3 extraction для `fleet-overview` UI:
  - HTML/JS route `/admin/fleet` вынесен в `backend/app/admin_fleet_page.py`;
  - в `backend/app/main.py` route оставлен как thin-wrapper (`return render_admin_fleet_page()`).

- выполнен phase-4 extraction для monitor composition:
  - оркестрация monitor snapshot вынесена в `backend/app/admin_fleet_monitor_ops.py`;
  - `backend/app/main.py` содержит thin-wrapper `_collect_monitor_snapshot(...)`, который прокидывает зависимости в модуль;
  - проверено на VPS: `/api/admin/fleet/monitor=200`, `/api/admin/fleet/health=200`, `/api/admin/fleet/health/notify-auto?dry_run=1&force=1=200`.

- выполнен phase-5 extraction для `policy-kpi` UI:
  - `/admin/fleet/policy` вынесен в `backend/app/admin_fleet_policy_page.py`;
  - `/admin/fleet/history` вынесен в `backend/app/admin_fleet_history_page.py`;
  - в `backend/app/main.py` сохранены thin-routes без изменения URL.

- выполнен phase-6 extraction для `notify-center` UI:
  - `/admin/fleet/notifications` вынесен в `backend/app/admin_fleet_notifications_page.py`;
  - `/admin/fleet/notify-center` вынесен в `backend/app/admin_fleet_notify_center_page.py`;
  - после фикса sync/async wrapper проверено на VPS: `UI_NOTIFICATIONS=200`, `UI_NOTIFY_CENTER=200`.

- выполнен phase-7 extraction для incident UI:
  - `/admin/fleet/incidents` вынесен в `backend/app/admin_fleet_incidents_page.py`;
  - `/admin/fleet/incidents/{central_id}/{code}` вынесен в `backend/app/admin_fleet_incident_detail_page.py`;
  - в `backend/app/main.py` сохранены thin-routes с тем же контрактом URL/параметров;
  - проверено на VPS: `UI_INCIDENTS=200`, `UI_INCIDENT_DETAIL=200`, `API_INCIDENTS=200`, `API_INCIDENT_NOTIFICATIONS=200`.

- выполнен phase-8 extraction для `actions/audit` UI:
  - `/admin/fleet/actions` вынесен в `backend/app/admin_fleet_actions_page.py`;
  - `/admin/audit` вынесен в `backend/app/admin_audit_page.py`;
  - в `backend/app/main.py` оставлены thin-routes с теми же URL;
  - проверено на VPS: `UI_ACTIONS=200`, `UI_AUDIT=200`, `API_ALERT_ACTIONS=200`, `API_AUDIT=200`.

- выполнен phase-9 unified smoke-gate:
  - добавлен единый скрипт `scripts/admin_panel_smoke_gate.sh` для UI/API админки + log scan;
  - проверка smoke-gate включена в bundle-команды `scripts/fleet_registry.py` (новый шаг в `commands.md`);
  - `scripts/fleet_rollout_check.py` теперь требует наличие шага `admin_panel_smoke_gate.sh` в `commands.md`;
  - фактический прогон smoke-gate на VPS: все UI/API из матрицы `200`, `no_errors_found` в логах.

- выполнен phase-10 extraction для API-логики `incidents/actions/audit`:
  - добавлен `backend/app/admin_incidents_ops.py` (`/api/admin/fleet/incidents`, `/api/admin/fleet/incidents/{central_id}/{code}`, `/api/admin/fleet/incidents/notifications`, `/api/admin/fleet/alerts/actions`);
  - добавлен `backend/app/admin_audit_ops.py` (`/api/admin/audit`);
  - в `backend/app/main.py` эти handlers оставлены thin и делегируют в `build_*_response` функции;
  - проверено на VPS: `API_INCIDENTS=200`, `API_INCIDENT_DETAIL(dynamic)=200`, `API_INCIDENT_NOTIFICATIONS=200`, `API_ALERT_ACTIONS=200`, `API_AUDIT=200`.

- выполнен phase-11 extraction для API `notification-settings` и `monitor-policy`:
  - добавлен `backend/app/admin_notification_ops.py` (`/api/admin/fleet/notification-settings`, `/api/admin/fleet/notification-settings/test`, `/api/admin/fleet/notifications/retry`);
  - добавлен `backend/app/admin_monitor_policy_ops.py` (`/api/admin/fleet/monitor-policy`, `/api/admin/fleet/monitor-policy/overrides*`);
  - в `backend/app/main.py` сохранены thin-handlers + audit hooks, бизнес-логика перенесена в `prepare_*`/`build_*` функции;
  - проверено на VPS: `API_MONITOR_POLICY=200`, `API_MONITOR_POLICY_OVERRIDES=200`, `API_NOTIFICATION_SETTINGS=200`, `API_NOTIFICATION_TEST(dry_run)=200`.

- smoke на VPS после phase-11:
  - `UI_FLEET=200`
  - `UI_ALERTS=200`
  - `UI_NOTIFICATIONS=200`
  - `UI_NOTIFY_CENTER=200`
  - `UI_INCIDENTS=200`
  - `UI_INCIDENT_DETAIL=200`
  - `UI_ACTIONS=200`
  - `UI_AUDIT=200`
  - `UI_POLICY=200`
  - `UI_HISTORY=200`
  - `API_MONITOR=200`
  - `API_ALERT_GROUPS=200`
  - `API_NOTIFICATION_SETTINGS=200`
  - `API_INCIDENTS=200`
  - `API_INCIDENT_NOTIFICATIONS=200`
  - `API_ALERT_ACTIONS=200`
  - `API_AUDIT=200`
  - `API_MONITOR_POLICY=200`
  - `API_MONITOR_POLICY_OVERRIDES=200`
  - `API_NOTIFICATION_TEST(dry_run)=200`

- выполнен phase-12 extraction для `runtime/config` helpers и composition-only `main.py`:
  - добавлен `backend/app/admin_runtime_config.py`:
    - `load_notification_runtime_settings`
    - `normalize_notification_settings`
    - `normalize_monitor_policy_settings`
    - `resolve_health_notify_channels`
  - в `backend/app/main.py` оставлены thin-wrapper функции, бизнес-логика runtime вынесена в модуль;
  - API handlers `monitor-policy*` и `notification-settings*` продолжают работать через `admin_monitor_policy_ops.py` и `admin_notification_ops.py` без изменения контрактов.

- smoke на VPS после phase-12:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `API_MONITOR_POLICY=200`
  - `API_MONITOR_POLICY_OVERRIDES=200`
  - `API_NOTIFICATION_SETTINGS=200`
  - `API_NOTIFICATION_TEST(dry_run)=200`
  - `API_NOTIFICATIONS_RETRY(dry_run)=200`

- выполнен phase-13 UI/UX итерация (UA-first copy + фильтры):
  - обновлены страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
    - `backend/app/admin_fleet_incident_detail_page.py`
  - унифицированы action-labels в UI:
    - `Підтвердити`
    - `Пауза 1 год`
    - `Зняти заглушення`
  - добавлены `Скинути фільтри` в `alerts` и `incidents`;
  - введён debounce для текстовых фильтров (`~280ms`) + `Enter` для немедленного обновления;
  - уточнены подписи select/статусов (`Стрічка 24г`, `Звичайна/Компактна`, `код=...`).

- smoke на VPS после phase-13:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `UI_FLEET=200`
  - `UI_ALERTS=200`
  - `UI_INCIDENTS=200`
  - `UI_INCIDENT_DETAIL=200`
  - `API_MONITOR=200`
  - `API_ALERT_GROUPS=200`
  - `API_INCIDENTS=200`
  - `API_INCIDENT_NOTIFICATIONS=200`

- выполнен phase-14 (этап A): общий UI toolkit для админ-страниц:
  - добавлен `backend/app/admin_ui_kit.py`:
    - `base_admin_css()`
    - `render_admin_shell(...)`
  - на toolkit переведены страницы:
    - `backend/app/admin_audit_page.py`
    - `backend/app/admin_fleet_actions_page.py`
    - `backend/app/admin_fleet_history_page.py`
  - добавлены единые UX-паттерны для filter-heavy страниц (`audit`, `actions`):
    - кнопка `Скинути фільтри`
    - debounce для text-фильтров (`~280ms`)
    - `Enter` для немедленного refresh
  - API-контракты и URL не изменялись.

- smoke на VPS после phase-14A:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `UI_AUDIT=200`
  - `UI_ACTIONS=200`
  - `UI_HISTORY=200`
  - `API_AUDIT=200`
  - `API_ALERT_ACTIONS=200`

- выполнен phase-14 (этап B): toolkit migration для оставшихся страниц:
  - на `admin_ui_kit` переведены:
    - `backend/app/admin_fleet_policy_page.py`
    - `backend/app/admin_fleet_notifications_page.py`
    - `backend/app/admin_fleet_notify_center_page.py`
  - сохранены контракты URL/API без изменений;
  - для `notify-center` добавлены UX-паттерны:
    - `Скинути фільтри`
    - debounce для text-фильтров (`~280ms`)
    - `Enter` для немедленного refresh.

- smoke на VPS после phase-14B:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `UI_POLICY=200`
  - `UI_NOTIFICATIONS=200`
  - `UI_NOTIFY_CENTER=200`
  - `API_NOTIFICATION_SETTINGS=200`
  - `API_INCIDENT_NOTIFICATIONS=200`

- выполнен phase-15: общий JS helper в `admin_ui_kit` и миграция страниц на единые frontend primitives:
  - добавлен `base_admin_js()` в `backend/app/admin_ui_kit.py` (экспорт `window.AdminUiKit`);
  - helper покрывает:
    - `setStatus`/`setText`/`esc`;
    - `apiGet`/`apiPost`/`apiDelete`/`fetchJson`;
    - `debounce` + `bindDebouncedInputs`;
    - `bindEnterRefresh`;
    - `bindClearFilters`;
    - `windowToSeconds`;
    - `loadWhoami`.
  - на helper переведены страницы:
    - `backend/app/admin_audit_page.py`
    - `backend/app/admin_fleet_actions_page.py`
    - `backend/app/admin_fleet_history_page.py`
    - `backend/app/admin_fleet_policy_page.py`
    - `backend/app/admin_fleet_notifications_page.py`
    - `backend/app/admin_fleet_notify_center_page.py`
  - URL/API-контракты и role-matrix (`viewer/operator/admin`) не изменялись.

- smoke на VPS после phase-15:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `UI_AUDIT=200`
  - `UI_ACTIONS=200`
  - `UI_HISTORY=200`
  - `UI_POLICY=200`
  - `UI_NOTIFICATIONS=200`
  - `UI_NOTIFY_CENTER=200`
  - `API_AUDIT=200`
  - `API_ALERT_ACTIONS=200`
  - `API_NOTIFICATION_SETTINGS=200`
  - `API_INCIDENT_NOTIFICATIONS=200`
  - дополнительная проверка: на всех 6 страницах присутствует `window.AdminUiKit` в HTML.

- выполнен phase-16: миграция heavy-страниц на общие JS primitives `AdminUiKit`:
  - без изменения URL/API переведены страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
    - `backend/app/admin_fleet_incident_detail_page.py`
  - на страницах подключён общий JS helper `window.AdminUiKit` из `base_admin_js()` через placeholder `__ADMIN_UI_KIT_JS__`;
  - локальные дубли helper-функций заменены на общие primitive:
    - `setStatus` → `ui.setStatus(...)`
    - `loadWhoami` → `ui.loadWhoami()`
    - `apiPost` → `ui.apiPost(...)`
    - debounce/Enter wiring → `ui.debounce(...)` и `ui.bindEnterRefresh(...)`
    - escaping → `ui.esc(...)`.
  - role-guard и UX поведения сохранены (read/operate/admin, bulk-actions, фильтры, авто-refresh).

- smoke на VPS после phase-16:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `UI_FLEET=200`
  - `UI_ALERTS=200`
  - `UI_INCIDENTS=200`
  - `UI_INCIDENT_DETAIL=200`
  - `API_MONITOR=200`
  - `API_ALERT_GROUPS=200`
  - `API_INCIDENTS=200`
  - `API_INCIDENT_NOTIFICATIONS=200`
  - дополнительная проверка: `window.AdminUiKit` присутствует в HTML всех 4 heavy-страниц.

- выполнен phase-17: heavy-страницы переведены на `render_admin_shell(...)` через legacy-wrapper:
  - в `backend/app/admin_ui_kit.py` добавлен:
    - `shell_layout` режим в `render_admin_shell(...)` (для страниц со своим legacy body layout);
    - `render_legacy_admin_page(...)` для безопасной миграции страниц без переписывания DOM.
  - на новый wrapper переведены:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
    - `backend/app/admin_fleet_incident_detail_page.py`
  - структура и поведение страниц сохранены (legacy `<body>`/`<script>` парсятся и рендерятся через общий shell + JS toolkit);
  - URL/API-контракты и role-guard не изменялись.

- smoke на VPS после phase-17:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `UI_FLEET=200`
  - `UI_ALERTS=200`
  - `UI_INCIDENTS=200`
  - `UI_INCIDENT_DETAIL=200`
  - `API_MONITOR=200`
  - `API_ALERT_GROUPS=200`
  - `API_INCIDENTS=200`
  - `API_INCIDENT_NOTIFICATIONS=200`
  - дополнительная проверка: `window.AdminUiKit` присутствует в HTML всех 4 heavy-страниц, лог API без `ResponseValidationError|Traceback`.

- выполнен phase-18A: auto-shell extraction внутри `render_legacy_admin_page(...)`:
  - `render_legacy_admin_page(...)` теперь автоматически извлекает из legacy-разметки:
    - `header_title`
    - `chips_html`
    - `toolbar_html`
    - `body_html`
    - `extra_css`
  - после извлечения страница рендерится через `render_admin_shell(...)` в стандартном shell layout;
  - fallback на `shell_layout=False` сохранён для нестандартных шаблонов.

- smoke на VPS после phase-18A:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - UI/API матрица без регрессий;
  - дополнительная проверка HTML: на всех 4 heavy-страницах присутствует единый shell header (`<header>` + `<div class="title">`).

- выполнен phase-18B (step-1): `incident-detail` переведён на чистый `render_admin_shell`:
  - файл `backend/app/admin_fleet_incident_detail_page.py` больше не содержит full-page `legacy_html` рендер;
  - страница собирается явными блоками:
    - `chips_html`
    - `toolbar_html`
    - `body_html`
    - `extra_css`
    - `script`
  - сохранены URL/API контракты и действия (`ack/silence/unsilence`).

- smoke на VPS после phase-18B step-1:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `UI_INCIDENT_DETAIL=200`;
  - проверка HTML маркеров shell/toolkit для detail-страницы пройдена.

- выполнен phase-18B (step-2): `incidents list` переведён на чистый `render_admin_shell`:
  - файл `backend/app/admin_fleet_incidents_page.py` больше не содержит full-page `legacy_html` рендер;
  - страница собирается явными блоками:
    - `chips_html`
    - `toolbar_html`
    - `body_html`
    - `extra_css`
    - `script`
  - сохранены URL/API контракты, фильтры, bulk-действия, role behavior.

- smoke на VPS после phase-18B step-2:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `UI_INCIDENTS=200`;
  - дополнительная проверка HTML для `/admin/fleet/incidents`: маркеры shell/toolkit присутствуют.

- выполнен phase-18B (step-3): `alerts` переведён на чистый `render_admin_shell`:
  - файл `backend/app/admin_fleet_alerts_page.py` больше не содержит full-page `legacy_html` рендер;
  - страница собирается явными блоками:
    - `chips_html`
    - `toolbar_html`
    - `body_html`
    - `extra_css`
    - `script`
  - сохранены URL/API контракты, фильтры и bulk-операции.

- smoke на VPS после phase-18B step-3:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `UI_ALERTS=200`;
  - дополнительная проверка HTML для `/admin/fleet/alerts`: маркеры shell/toolkit присутствуют.

- выполнен phase-18B (step-4): `fleet` переведён на чистый `render_admin_shell`:
  - файл `backend/app/admin_fleet_page.py` больше не содержит full-page `legacy_html` рендер;
  - страница собирается явными блоками:
    - `chips_html`
    - `toolbar_html`
    - `body_html`
    - `extra_css`
    - `script`
  - сохранены URL/API контракты, фильтры, focus-presets и операции по алертам.

- smoke на VPS после phase-18B step-4:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`no_errors_found`);
  - `UI_FLEET=200`, `UI_ALERTS=200`, `UI_INCIDENTS=200`;
  - дополнительная проверка HTML для `/admin/fleet`: маркеры shell/toolkit присутствуют.

Итог phase-18B: все heavy-страницы переведены на чистый `render_admin_shell` без `legacy_html`.

Следующий шаг (phase-19): cleanup и hardening модульной админки:
- убрать/сузить `render_legacy_admin_page(...)` до fallback-only роли;
- сократить дубли page-specific CSS и вынести общее в toolkit;
- добавить smoke-check на отсутствие legacy-render path в heavy-модулях.

- выполнен phase-19: post-migration cleanup:
  - в `backend/app/admin_ui_kit.py` общий base CSS расширен общими utility-классами:
    - `sectionHead/sectionTools/quickLink`
    - `actions/smallbtn`
    - `drillBtns/drillBtn`
    - `button:disabled`, `button:active`, `tr:hover td`
  - `render_legacy_admin_page(...)` оставлен как fallback-helper (добавлен явный fallback-комментарий), heavy-страницы его не используют;
  - в heavy-страницах сокращён дублирующийся `extra_css`:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`.

- smoke/hardening после phase-19:
  - `scripts/admin_panel_smoke_gate.sh` дополнен `LEGACY_RENDER_CHECK` (strict по умолчанию);
  - проверка блокирует регресс, если heavy-модули снова используют `render_legacy_admin_page(...)`/`legacy_html`.
  - unified gate на VPS: PASS (`no_errors_found`), UI/API матрица 200, shell/toolkit маркеры на `/admin/fleet*` присутствуют.

Следующий шаг (phase-20): доработка UI/UX админки (укр. локализация уже baseline) на чистой модульной базе без изменения API-контрактов.

- выполнен phase-20: UI/UX polish (UA) без изменения API-контрактов:
  - `backend/app/admin_ui_kit.py`:
    - улучшены base tokens/фон/контраст;
    - добавлены hover/focus/disabled состояния для `chip`, `button`, `input/select`;
    - улучшена читаемость таблиц (`zebra`, `hover`, `letter-spacing` заголовков);
    - вынесены общие интерактивные utility (`quickLink`, `drillBtn`, `smallbtn`) в base toolkit.
  - heavy-страницы:
    - `backend/app/admin_fleet_page.py`: усилены карточки приоритета/фокус-кнопки/summary визуально;
    - `backend/app/admin_fleet_alerts_page.py`: улучшены section density и action-видимость;
    - `backend/app/admin_fleet_incidents_page.py`: улучшены KPI/quick-filters/heatmap читаемость и интерактив.

- smoke на VPS после phase-20:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица 200;
  - shell/toolkit маркеры для `/admin/fleet*` присутствуют.

Следующий шаг (phase-21): UI-навигация и рабочие сценарии оператора (быстрые потоки “инцидент → действие → аудит”) без изменения backend schema.

- выполнен phase-21: операторские потоки и навигация (без изменений API/schema):
  - добавлен явный `flow`-маршрут на ключевых страницах:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - маршрут покрывает цикл: мониторинг → алерты → инциденты/действия → аудит;
  - усилена action-группировка:
    - bulk/action-кнопки переведены на общие классы `opAction*`;
    - добавлены быстрые переходы в `Журнал дій` и `Аудит` из рабочих секций.
  - улучшения сделаны только в UI-слое (DOM hooks и backend контракты сохранены).

- smoke на VPS после phase-21:
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица 200;
  - на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents` присутствуют маркеры flow/toolkit.

Следующий шаг (phase-22): привести UX-ритм operator pages к единому шаблону (action density + компактный режим + читаемость таблиц) без изменения API.

- выполнен phase-22: operator UX rhythm (density/readability) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены общие primitives для operator-ритма таблиц:
      - `.tableMeta`, `.metaChip`, `.metaChip.source/.sort/.mode`;
    - добавлен единый JS-механизм плотности:
      - `normalizeDensity(...)`
      - `densityLabel(...)`
      - `applyDensityMode(...)`
      - `initDensityMode(...)`
    - плотность и label теперь настраиваются единообразно через toolkit, без page-level copy/paste.
  - `backend/app/admin_fleet_page.py`:
    - секции таблиц получили `tableMeta` (source/sort);
    - плотность подключена через `ui.initDensityMode(...)` + `densityBadge`.
  - `backend/app/admin_fleet_alerts_page.py`:
    - добавлен селект плотности (`regular/compact`);
    - добавлены `tableMeta` hints и `densityBadge`;
    - compact-режим таблиц подключён через toolkit density API.
  - `backend/app/admin_fleet_incidents_page.py`:
    - добавлен селект плотности (`regular/compact`);
    - добавлены `tableMeta` hints для incidents/notifications и `densityBadge`;
    - compact-режим таблиц подключён через toolkit density API.
  - все изменения ограничены UI-слоем (routes, payload, response schema, role-guard и bulk-actions сохранены).

- smoke на VPS после phase-22:
  - локально: `py_compile`, `compileall`, `bash -n scripts/admin_panel_smoke_gate.sh` — OK;
  - deploy: обновлены 4 файла (`admin_ui_kit.py`, `admin_fleet_page.py`, `admin_fleet_alerts_page.py`, `admin_fleet_incidents_page.py`) и `docker compose ... up -d --build api`;
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица smoke — `200`;
  - маркеры `tableMeta/metaChip/densityBadge` присутствуют на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`.

Следующий шаг (phase-23): зафиксировать информационную архитектуру админки как “golden module shell” (единый layout grid, навигационный каркас, модульные contracts для новых страниц) и подготовить шаблон внедрения новых модулей без UI-дрейфа.

- выполнен phase-23: golden module shell (IA + UX contracts) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен общий shell-каркас с левым меню:
      - `.appShell`, `.sideNav`, `.sideBrand`, `.sideList`, `.sideLink`, `.sideLink.active`;
    - `render_admin_shell(...)` расширен параметром `current_nav` и генерирует единый sidebar для shell-страниц;
    - sidebar содержит быстрые переходы: `Огляд`, `Флот`, `Алерти`, `Інциденти`, `Правила сповіщень`, `Доставка`, `Політика`, `Історія KPI`, `Журнал дій`, `Аудит`, `WireGuard`;
    - добавлен responsive-режим sidebar для узких экранов (row-scroll без потери навигации).
  - страницы админки переведены на явный `current_nav`:
    - `backend/app/admin_fleet_page.py` (`fleet`)
    - `backend/app/admin_fleet_alerts_page.py` (`alerts`)
    - `backend/app/admin_fleet_incidents_page.py` (`incidents`)
    - `backend/app/admin_fleet_incident_detail_page.py` (`incidents`)
    - `backend/app/admin_fleet_policy_page.py` (`policy`)
    - `backend/app/admin_fleet_notifications_page.py` (`notifications`)
    - `backend/app/admin_fleet_notify_center_page.py` (`notify-center`)
    - `backend/app/admin_fleet_history_page.py` (`history`)
    - `backend/app/admin_fleet_actions_page.py` (`actions`)
    - `backend/app/admin_audit_page.py` (`audit`)
  - результат: единый навигационный каркас и одинаковый UX-ритм для operator/admin страниц без UI-дрейфа.

- smoke на VPS после phase-23:
  - deploy: обновлены toolkit + модульные страницы, `docker compose ... up -d --build api`;
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица smoke — `200`;
  - sidebar markers (`sideNav/sideLink/appShell`) подтверждены на `fleet/alerts/incidents/policy/notifications/actions/audit`.

- выполнен phase-24: operator workspace refinement (sticky context + latency hints) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены workspace primitives:
      - `saveWorkspaceContext(...)`
      - `loadWorkspaceContext(...)`
      - `clearWorkspaceContext()`
      - `applyWorkspaceHint(...)`
      - `formatWorkspaceContext(...)`
    - добавлены action timing primitives:
      - `runActionWithLatency(...)`
      - `formatLatency(...)`
    - добавлены общие UI-элементы workspace (`workspaceBar`, `workspaceHint`).
  - страницы с операторским циклом:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
    - `backend/app/admin_fleet_incident_detail_page.py`
  - внедрено:
    - sticky контекст инцидента (`central_id:code`) между `fleet → alerts → incidents → incident-detail`;
    - кнопки `Підставити контекст` / `Очистити контекст` на операторских страницах;
    - latency-hints в статусах действий (`ack/silence/unsilence`, bulk actions).
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- smoke на VPS после phase-24:
  - локально: `py_compile`, `compileall`, `bash -n scripts/admin_panel_smoke_gate.sh` — OK;
  - deploy: обновлены `admin_ui_kit.py` + 4 operator page modules, `docker compose ... up -d --build api`;
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица smoke — `200`;
  - HTML marker checks (`workspaceHint/workspaceApply/window.AdminUiKit/sideNav`) подтверждены на `/admin/fleet*`.

- выполнен phase-25: operator command palette + saved presets (localStorage) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены helpers пресетов:
      - `listPresets(...)`
      - `savePreset(...)`
      - `deletePreset(...)`
      - `getPreset(...)`
    - добавлены helpers командной панели:
      - `openCommandPalette(...)`
      - `closeCommandPalette()`
      - `bindCommandPalette(...)`
    - добавлен UI-слой command palette (`cmdOverlay/cmdDialog/cmdSearch/cmdList`).
  - на страницах:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - кнопка `Команди` + hotkey `Ctrl/Cmd+K`;
    - сохранение/применение/удаление пресетов фильтров на каждой странице;
    - быстрые команды фокуса через palette (`critical/wg/queue/sla/open/reset` по модулю).
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- smoke на VPS после phase-25:
  - локально: `py_compile`, `compileall`, `bash -n scripts/admin_panel_smoke_gate.sh` — OK;
  - deploy: обновлены toolkit + `fleet/alerts/incidents` page modules, `docker compose ... up -d --build api`;
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица smoke — `200`;
  - HTML marker checks (`cmdPaletteOpen/presetSelect/openCommandPalette/workspaceHint`) подтверждены на `/admin/fleet*`.

- выполнен phase-26: cross-page preset portability (shared namespace + JSON export/import) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - расширены preset helpers namespace-моделью:
      - `normalizePresetNamespace(...)`
      - `listPresetScopes(...)`
      - `list/save/get/deletePreset(..., {namespace})`
    - добавлены JSON portability helpers:
      - `exportPresets(...)`
      - `importPresets(...)`
      - `exportPresetBundle(...)`
      - `importPresetBundle(...)`
    - `shared` namespace хранится отдельно и поддерживает bundle по нескольким scope.
  - страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - переключатель namespace (`локальні` / `спільні`);
    - кнопки `Експорт` / `Імпорт` JSON;
    - shared bundle для команды operator по scope: `fleet`, `fleet_alerts`, `fleet_incidents`;
    - команды palette для namespace/export/import.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- smoke на VPS после phase-26:
  - локально: `py_compile`, `compileall`, `bash -n scripts/admin_panel_smoke_gate.sh` — OK;
  - deploy: обновлены toolkit + `fleet/alerts/incidents` modules, `docker compose ... up -d --build api`;
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица smoke — `200`;
  - HTML marker checks (`presetNamespace/presetExport/presetImport/exportPresetBundle/importPresetBundle`) подтверждены на `/admin/fleet*`.

- выполнен phase-27: presets governance (team profiles + cleanup/retention) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены governance helpers:
      - `presetProfileTemplates(...)`
      - `installPresetProfiles(...)`
      - `cleanupPresets(...)`
      - `listPresetArchive(...)`
    - добавлен архив удалённых пресетов по namespace/scope;
    - cleanup поддерживает retention по дням + max entries + archive.
  - страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - кнопки `Профілі` / `Cleanup` на операторских страницах;
    - команды palette для установки scope/team профилей и cleanup;
    - governance работает для обоих namespace: `local/shared`.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- smoke на VPS после phase-27:
  - локально: `py_compile`, `compileall`, `bash -n scripts/admin_panel_smoke_gate.sh` — OK;
  - deploy: обновлены toolkit + `fleet/alerts/incidents` modules, `docker compose ... up -d --build api`;
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица smoke — `200`;
  - HTML marker checks (`presetProfiles/presetCleanup/cleanupPresets/installPresetProfiles/presetProfileTemplates`) подтверждены на `/admin/fleet*`.

- выполнен phase-28: presets observability dashboard (namespace/scope metrics + cleanup visibility) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены observability helpers:
      - `buildPresetScopeObservability(...)`
      - `buildPresetObservabilityBundle(...)`
    - scope report агрегирует `local/shared`:
      - `total/local_total/shared_total`
      - `archived_total/local_archived_total/shared_archived_total`
      - `local_last_cleanup_ts/shared_last_cleanup_ts/last_cleanup_ts`.
  - страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - новый hint `presetObservability` в workspace bar;
    - кнопка `Метрики` (`presetMetrics`) рядом с preset controls;
    - summary для активного namespace + scope-агрегация `L/S` без изменения route/API.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- smoke на VPS после phase-28:
  - локально: `py_compile`, `compileall`, `bash -n scripts/admin_panel_smoke_gate.sh` — OK;
  - deploy: `rsync` + `docker compose ... up -d --build api` — OK;
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица smoke — `200`;
  - HTML marker checks (`presetObservability/presetMetrics/buildPresetScopeObservability/buildPresetObservabilityBundle`) подтверждены на `/admin/fleet*`.

- выполнен phase-29: preset audit timeline (workspace drill-down) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены timeline helpers:
      - `listPresetTimeline(...)`
      - `clearPresetTimeline(...)`
      - `buildPresetTimelineSummary(...)`
      - `buildPresetTimelineBundle(...)`
    - добавлен timeline storage prefix и ключи по `namespace/scope`;
    - timeline-события автоматически пишутся при:
      - `save/delete preset`
      - `install profiles`
      - `cleanup`
      - `import/export` (scope и bundle).
  - страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - новый workspace hint `presetTimelineHint` (count + last action + ts);
    - кнопки `Журнал` / `Очистити журнал`;
    - palette-команды для просмотра timeline и очистки;
    - drill-down по последним timeline entries в palette.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- smoke на VPS после phase-29:
  - локально: `py_compile`, `compileall`, `bash -n scripts/admin_panel_smoke_gate.sh` — OK;
  - deploy: `rsync` + `docker compose ... up -d --build api` — OK;
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица smoke — `200`;
  - HTML marker checks (`presetTimelineHint/presetTimelineOpen/presetTimelineClear/buildPresetTimelineSummary/buildPresetTimelineBundle`) подтверждены на `/admin/fleet*`.

- выполнен phase-30: presets conflict guard + merge simulator (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены conflict/preview helpers:
      - `simulatePresetImport(...)`
      - `simulatePresetBundleImport(...)`
      - `buildPresetMergePreview(...)`
    - сравнение выполняется по `name + ts + payload hash` (stable serialize + hash);
    - preview summary содержит `create/update/refresh_ts/skip/conflicts/drop/result_total`;
    - helper поддерживает `merge` и `replace`.
  - страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - новый hint `presetMergeHint`;
    - кнопка `Preview` рядом с import controls;
    - import flow через conflict-guard (confirm при conflicts/drop);
    - palette-команды: `Preview merge`, `Імпорт merge`, `Імпорт replace`;
    - preview показывает summary + список конфликтных entries (drill-down JSON prompt).
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- smoke на VPS после phase-30:
  - локально: `py_compile`, `compileall`, `bash -n scripts/admin_panel_smoke_gate.sh` — OK;
  - deploy: `rsync` + `docker compose ... up -d --build api` — OK;
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица smoke — `200`;
  - HTML marker checks (`presetMergeHint/presetPreview/simulatePresetImport/simulatePresetBundleImport`) подтверждены на `/admin/fleet*`.

- выполнен phase-31: presets policy lock + protected profiles (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены policy helpers:
      - `getPresetProtectionState(...)`
      - `setPresetProtectionLock(...)`
    - protected registry формируется из baseline profile templates по scope;
    - delete/overwrite protected presets блокируются при `policy lock=ON`;
    - import merge/replace проходит через guard (`preset_protected_locked`) при blocked protected changes;
    - cleanup не удаляет protected presets при активном lock.
  - страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - новый hint `presetPolicyHint` (LOCKED/UNLOCKED + protected count);
    - кнопки `Unlock/Lock` в workspace row;
    - explicit unlock confirm (`UNLOCK`) перед снятием policy lock;
    - palette-команды `Policy unlock/Policy lock`;
    - guarded UX для save/delete/import (понятный status при policy block).
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- smoke на VPS после phase-31:
  - локально: `py_compile`, `compileall`, `bash -n scripts/admin_panel_smoke_gate.sh` — OK;
  - deploy: `rsync` + `docker compose ... up -d --build api` — OK;
  - unified gate: `./scripts/admin_panel_smoke_gate.sh` => PASS (`LEGACY_RENDER_CHECK: ok`, `no_errors_found`);
  - UI/API матрица smoke — `200`;
  - HTML marker checks (`presetPolicyHint/presetPolicyUnlock/presetPolicyLock/getPresetProtectionState/setPresetProtectionLock`) подтверждены на `/admin/fleet*`.

- выполнен phase-32: presets operations cockpit (scope batch, UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены batch helpers:
      - `buildPresetOperationsSummary(...)`
      - `simulatePresetOperations(...)`
      - `applyPresetOperations(...)`
      - `setPresetProtectionLockBatch(...)`
    - `importPresetBundle(...)` поддерживает `options.scopes` для целевого batch-импорта;
    - добавлен normalize helper `normalizeScopeList(...)` для предсказуемой обработки scope-list.
  - страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - новый hint `presetCockpitHint` + кнопка `Cockpit` в workspace row;
    - preview/apply cockpit для `merge/replace` по выбранным scope;
    - batch-policy команды `lock/unlock` по scope;
    - palette-команды `Cockpit preview/apply merge/apply replace/policy lock batch/policy unlock batch`;
    - единый summary по `conflicts/protected_blocked/result_total/scope_count`.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-32:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-33: cockpit timeline panel (batch audit, UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен helper `buildPresetCockpitTimeline(...)` для агрегированной ленты batch-операций по scope/namespace/action;
    - добавлена встроенная panel-модалка:
      - `openPresetCockpitTimelinePanel(...)`
      - `closePresetCockpitTimelinePanel(...)`
    - добавлены UI primitives: `cockpitTimelineOverlay/cockpitTimelineDialog` + фильтры `namespace/scope/action/limit`;
    - поддержан drill-down по каждой записи с JSON-details.
  - страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - новый hint `presetCockpitTimelineHint` + кнопка `presetCockpitTimeline` в workspace row;
    - palette-команда `Cockpit timeline panel` на всех трёх страницах;
    - единый операторский поток: cockpit summary → timeline panel → drill-down details;
    - синхронизация hint после import/export/policy/cockpit действий и очистки timeline.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-33:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-34: cockpit rollout assistant (safe apply protocol, UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены rollout helpers:
      - `buildPresetRolloutAssistant(...)`
      - `applyPresetRolloutAssistant(...)`
      - `getPresetRolloutLast(...)`
    - добавлено хранение последнего rollout summary в localStorage (`PRESET_ROLLOUT_LAST_PREFIX`);
    - при apply добавляется timeline action `rollout_assistant_apply` по scope.
  - страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - новый hint `presetRolloutHint` + кнопка `presetRollout` в workspace row;
    - operator-flow: `scope selection -> dry-run plan -> rollback bundle -> checklist confirm -> apply confirm -> post-check hints`;
    - palette-команды `Rollout assistant merge/replace` и `Rollout last summary`;
    - единый UX для fleet/alerts/incidents с учетом policy lock/conflicts/drop.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-34:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-35: left navigation IA hardening (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - side-nav переработан в модульные группы: `Operations`, `Monitoring`, `Governance`;
    - добавлены workflow jump-links (`fleet -> alerts -> incidents -> audit`) и visual trail state;
    - добавлены новые UI primitives: `sideHint/sideJumpRow/sideGroup/sideGroupTitle/sideStep/trail`.
  - страницы:
    - `backend/app/admin_fleet_page.py`
    - `backend/app/admin_fleet_alerts_page.py`
    - `backend/app/admin_fleet_incidents_page.py`
  - внедрено:
    - compact jump-links в flow cards для быстрого перехода между ключевыми этапами операторского цикла;
    - активное состояние маршрута и подсветка прогресса в левом меню;
    - mobile/tablet адаптация для grouped sidebar без изменения DOM hooks.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-35:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-36: navigation personalization (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены sidebar personalization helpers для `favorites/recent` в localStorage;
    - добавлены UI элементы `sidePin`, `sideMiniHead`, `sideMiniList`, `sideMiniBtn`;
    - добавлены секции `Quick Intents`, `Favorites`, `Recent` в левом меню;
    - инициализация personalization запускается централизованно в `base_admin_js()` на каждой shell-странице.
  - `backend/app/admin_fleet_alerts_page.py`:
    - добавлен разбор query-параметров (`sev/severity`, `q`, `central(_id)`, `code`, `includeSilenced`) для quick-intent deep-links.
  - внедрено:
    - pinned favorites по пунктам меню с быстрым toggle (`☆/★`);
    - recent pages с автообновлением текущего active-route;
    - quick intents: `alerts bad`, `incidents open`, `audit`.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-36:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-37: left-nav ergonomics hardening (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены collapsible группы для `Operations/Monitoring/Governance` (state в localStorage);
    - добавлен reorder favorites (`↑/↓/remove`) в левом меню;
    - добавлены quick-intent hotkeys: `Shift+Alt+A` (alerts bad), `Shift+Alt+I` (incidents open), `Shift+Alt+U` (audit);
    - active/trail и текущие route/API контракты сохранены.
  - внедрено:
    - group toggle через `sideGroupToggle` + `data-side-group`;
    - `Quick Intents` дополнены hotkey badges;
    - персонализация (`favorites/recent`) продолжает работать из общего toolkit без page-specific регрессий.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-37:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-38: left-nav command hub (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен inline `Command Hub` в sidebar с intent-runner кнопками;
    - добавлен visual hotkeys cheat-sheet в левом меню;
    - добавлен `focus mode` (persisted state в localStorage) для компактной работы в длительной операторской сессии;
    - сохранены active/trail, route и API контракты.
  - внедрено:
    - intent-runner: быстрый переход в `alerts bad`, `incidents open`, `audit` без смены backend логики;
    - focus mode toggle в sidebar (`Стандарт/Фокус`) с явным состоянием;
    - `Shift+Alt+A/I/U` сохранены как горячие переходы и синхронизированы с quick-intents.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-38:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-39: sidebar intelligence (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен adaptive intent priority для quick-intents/command-hub на базе `favorites/recent/session usage/current context`;
    - добавлены context-aware hints в sidebar (`alerts/incidents/audit/fleet`) с разбором query-параметров;
    - добавлены session shortcuts (последние переходы/intent-запуски) с быстрым переходом и очисткой.
  - внедрено:
    - dynamic переупорядочивание `Quick Intents` и `Command Hub` по текущему операторскому контексту;
    - фиксация usage и session shortcuts через sessionStorage без backend изменений;
    - совместимость с existing focus-mode, active/trail и route-contract сохранена.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-39:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-40: sidebar mission-control (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены alert-first widgets в sidebar (`bad/open/sla/queue`) на базе существующих DOM counters;
    - добавлены one-click triage presets (`critical alerts`, `open incidents`, `SLA breach`, `queue backlog`);
    - добавлен sticky incident focus (detail/list/pin/clear) через существующий workspace context.
  - внедрено:
    - mission presets с adaptive ordering и session continuity без новых API вызовов;
    - фикс usage/session triage действий в sessionStorage;
    - совместимость с existing focus-mode, active/trail и route-contract сохранена.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-40:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-41: mission-control automation (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены guided recovery playbooks в sidebar (`sideMissionPlaybookList`) для triage-сценариев;
    - добавлен smart triage chaining (`sideMissionChain`) с рекомендованным next step по текущему preset/route;
    - добавлены operator handoff notes (`sideHandoffInput`) с сохранением заметки и контекста инцидента в localStorage.
  - внедрено:
    - auto-detection triage preset по текущему URL/query и session continuity через `MISSION_LAST_PRESET_STORAGE_KEY`;
    - пошаговый запуск runbook-кроков (`data-playbook-run`) и chain-крока (`data-chain-run`) без новых backend API;
    - handoff workflow (`save/context/clear`) для передачи смены и снижения потерь контекста.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-41:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-42: mission-control evidence loop (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены checklist completion badges (`sideMissionChecklist`) для runbook-кроков с прогрессом;
    - добавлен quick evidence snapshot блок (`sideMissionSnapshot`) с журналом и JSON drill-down;
    - добавлен handoff timeline/history (`sideHandoffTimeline`) с локальным журналом событий смены.
  - внедрено:
    - snapshot payload включает `preset + metrics + checklist + context + handoff` и хранится локально;
    - handoff timeline фиксирует `save/context/clear/snapshot` события и доступен через быстрый просмотр;
    - mission-control остался совместим с existing active/trail/focus-mode и route-contract.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-42:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-43: mission-control response packs (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен response-pack workflow (`generate/copy-template/export-json/clear`) в sidebar mission-control;
    - добавлен генератор handoff template (операционный summary на основе snapshot/checklist/timeline);
    - добавлен review/copy flow для быстрой передачи смены без ручной сборки контекста.
  - внедрено:
    - response pack формируется как `passengers.mission.response_pack.v1` (snapshot + checklist + context + handoff timeline);
    - пакет и шаблон доступны оператору через быстрые действия `Copy шаблон` и `JSON`;
    - совместимость с existing active/trail/focus-mode и route-contract сохранена.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-43:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выполнен phase-44: mission-control escalation routing (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены rule-based routing profiles для response pack (`critical/network/queue/audit/fallback`) по `severity/status/code/path`;
    - добавлены channel-ready templates (`short/full/audit`) и выбор шаблона в sidebar;
    - добавлен быстрый review/copy flow: `apply-routing`, `auto-route`, `copy-route`, `copy-template` на основе активного шаблона.
  - внедрено:
    - response pack расширен полями `routing`, `routing_signal`, `channel_templates`, `routing_dispatch`;
    - сохранение выбора профиля/шаблона в `sessionStorage` (`passengers_admin_mission_response_routing_v1`);
    - совместимость с existing active/trail/focus-mode, route-contract и backend API/schema сохранена.
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-44:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-44:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - проверка UI маркеров `sideRoutingProfile|sideRoutingTemplate|sideResponseRoutingSummary|buildMissionRoutingSignal|resolveMissionRoutingProfile|buildMissionChannelTemplate` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`24` совпадения на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-45: mission-control delivery adapters (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены delivery adapters presets (`telegram/email/ticket`) поверх phase-44 routing;
    - добавлены selector controls для adapter/variant и delivery summary preview в sidebar;
    - добавлен быстрый copy flow: `copy-delivery`, `copy-telegram`, `copy-email`, `copy-ticket`.
  - внедрено:
    - response pack расширен полями `delivery`, `delivery_payload`, `delivery_templates`;
    - channel envelope формируется из `short/full/audit` variants + `routing_dispatch` без backend изменений;
    - сохранение adapter/variant в `sessionStorage` (`passengers_admin_mission_delivery_adapter_v1`).
  - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-45:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-45:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - проверка UI маркеров `sideDeliveryAdapter|sideDeliveryVariant|sideDeliverySummary|buildMissionDeliveryPayload|buildMissionDeliveryTemplates|copy-telegram|copy-email|copy-ticket|copy-delivery|apply-delivery` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`33` совпадения на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-46: mission-control delivery state handoff (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен delivery journal (`localStorage`) с событиями `apply/copy` (adapter/variant/ts/context/route);
    - добавлен queue-ready handoff status summary в response-pack блок mission-control;
    - добавлены быстрые действия `show-delivery-journal` и `clear-delivery-journal`.
  - внедрено:
    - журнал доставки хранится отдельно от handoff timeline и используется для повторяемой передачи смены;
    - статус queue-ready формируется из текущего response pack + delivery payload + актуальности journal-событий;
    - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-46:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-46:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - проверка UI маркеров `MISSION_DELIVERY_JOURNAL_STORAGE_KEY|listMissionDeliveryJournal|renderMissionDeliveryHandoffStatus|show-delivery-journal|clear-delivery-journal|sideDeliveryHandoffStatus` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`15` совпадений на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-47: mission-control delivery acknowledgment loop (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены lifecycle actions: `ack-delivery`, `retry-delivery`, `escalate-delivery`;
    - добавлен SLA-state layer (`fresh/warn/stale`) с таймером и причиной состояния;
    - расширен delivery journal событиями lifecycle (`ack/retry/escalate`) + причины для retry/escalate.
  - внедрено:
    - queue-ready и SLA теперь работают совместно: оператор видит не только готовность пакета, но и подтверждение/задержку доставки;
    - retry-escalation flow фиксируется в journal и handoff timeline для воспроизводимой передачи смены;
    - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-47:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-47:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - проверка UI маркеров `ack-delivery|retry-delivery|escalate-delivery|sideDeliverySlaStatus|buildMissionDeliverySlaState|renderMissionDeliverySlaStatus|missionDeliveryJournalActionLabel` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`16` совпадений на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-48: mission-control delivery state automation (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен suggestion engine для `ack/retry/escalate` на базе SLA + delivery journal history;
    - добавлены bulk shortcuts: `bulk-ack-pending`, `bulk-retry-stale`, `bulk-escalate-stale`;
    - добавлен explainability summary (`action`, `confidence`, `reason`, `bulk counters`) и кнопка `apply-delivery-suggestion`.
  - внедрено:
    - рекомендации и bulk-операции работают в текущем mission-control потоке без backend изменений;
    - policy-решения и массовые действия фиксируются в delivery journal/handoff timeline для воспроизводимой передачи смены;
    - все изменения ограничены UI-слоем (URL, API endpoints, payload/response schema, role-guard сохранены).

- локальная валидация после phase-48:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-48:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - проверка UI маркеров `buildMissionDeliveryAutomationPlan|renderMissionDeliveryAutomationSummary|apply-delivery-suggestion|bulk-ack-pending|bulk-retry-stale|bulk-escalate-stale|sideDeliveryAutomationSummary|sideDeliverySuggestedAction|collectMissionDeliveryBulkCandidates` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`26` совпадений на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-49: mission-control delivery policy profiles + UI cleanup (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены policy profiles (`balanced/aggressive/conservative`) и session override (`sideDeliveryPolicyProfile`);
    - обновлён suggestion engine с учётом policy strategy (`warn/stale` thresholds + routing поведения);
    - доработана визуальная чистота блока response-pack/delivery: секции, 2-колоночные группы кнопок, `primary/disabled` состояния, policy summary.
  - внедрено:
    - оператор может быстро переключать режим automation без backend-записей (только session scope);
    - explainability теперь показывает policy/mode/why, что снижает неоднозначность решений в смене;
    - layout mission-control стал чище и удобнее для повседневного triage (меньше визуального шума, лучше группировка действий).

- локальная валидация после phase-49:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-49:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - проверка UI маркеров `MISSION_DELIVERY_POLICY_STORAGE_KEY|MISSION_DELIVERY_POLICY_PROFILES|resolveMissionDeliveryPolicyProfile|renderMissionDeliveryPolicyControls|sideDeliveryPolicyProfile|sideDeliveryPolicySummary|apply-delivery-policy|sideSnapshotSection|sideSnapshotTools two` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`39` совпадений на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-50: mission-control UX refinement (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен keyboard-first flow: `runMissionHotkeyAction` + hotkeys для `apply/ack/retry/escalate/bulk/policy/journal`;
    - добавлена action clarity: `confirmMissionDangerAction` + tooltip/microcopy для высокорисковых действий;
    - добавлен mobile sticky action footer (`sideDeliverySticky`, `sideDeliveryStickySuggested`) для быстрого применения рекомендованного действия.
  - внедрено:
    - triage ускорен за счёт клавиатурного управления и явных подтверждений для опасных операций;
    - mobile сценарий стал устойчивее (кнопка ключевого действия всегда доступна внизу экрана);
    - UI-изменения остались в модульной границе админки (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-50:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-50:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - проверка UI маркеров `sideDeliverySticky|sideDeliveryStickySuggested|runMissionHotkeyAction|confirmMissionDangerAction|apply-delivery-suggestion|ack-delivery|retry-delivery|escalate-delivery|bulk-ack-pending|bulk-retry-stale|bulk-escalate-stale` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`32` совпадения на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-51: mission-control navigation ergonomics (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены controls левой навигации: `sideNavSearch`, `sideNavCompactToggle`, `sideNavFilterStatus`;
    - добавлена логика `applySidebarNavFilter` + `bindSidebarNavTools` для быстрого поиска по разделам/группам и скрытия нерелевантных блоков;
    - добавлен persist-компактный режим `applySidebarCompactMode` (`localStorage`) с mobile-friendly fallback.
  - внедрено:
    - оператор быстрее переключается между секциями при росте числа модулей;
    - компактный режим снижает визуальный шум в длительной смене;
    - изменения ограничены UI-слоем (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-51:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-51:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка source-маркеров `sideNavTools|sideNavSearch|sideNavCompactBtn|sideNavFilterStatus|applySidebarNavFilter|bindSidebarNavTools|applySidebarCompactMode` в `backend/app/admin_ui_kit.py` — OK.

- выполнен phase-52: mission-control navigation accessibility polish (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены ARIA-улучшения для nav-controls (`aria-live` status, `aria-controls`, `aria-label` для `search/compact/help`);
    - добавлен keyboard-flow: `Shift+Alt+N` (фокус поиска), `Enter/ArrowDown/Escape` в nav-search, `ArrowLeft/ArrowRight/Home/End` для group toggles;
    - добавлен onboarding-блок по навигации (`sideNavOnboarding`) с кнопкой скрытия и persistence в `localStorage`.
  - внедрено:
    - новая навигация стала доступнее для клавиатурных и onboarding-сценариев;
    - ускорен первый рабочий цикл новых операторов без backend-зависимостей;
    - изменения остались в UI-слое (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-52:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-52:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка UI маркеров `sideNavHelpBtn|sideNavOnboarding|sideNavOnboardingDismiss|sideNavFilterStatus|sideNavSearch|sideNavCompactBtn|Shift+Alt+N|aria-live|sideNavOnboardingTitle` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`33` совпадения на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-53: mission-control operator adoption telemetry (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлена локальная telemetry-модель навигации (`NAV_ADOPTION_STORAGE_KEY`) с событиями `search/hotkeys/filter/group/compact/onboarding`;
    - добавлен компактный adoption snapshot в handoff-блок (`sideHandoffAdoption`) с топом действий, total/unique, last activity;
    - добавлена привязка telemetry к nav-flow действиям (`Shift+Alt+N`, `Enter/ArrowDown/Escape`, group toggle, compact toggle, onboarding toggle/dismiss).
  - внедрено:
    - команда видит фактический уровень освоения нового nav-flow прямо в mission-control;
    - handoff стал информативнее: видно, какие действия реально используют операторы в смене;
    - изменения ограничены UI-слоем (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-53:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-53:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка UI маркеров `NAV_ADOPTION_STORAGE_KEY|NAV_ADOPTION_EVENT_LABELS|sideHandoffAdoption|buildSidebarNavAdoptionSummary|recordSidebarNavAdoptionEvent|renderMissionHandoffAdoptionSummary|setSidebarNavOnboardingVisible|Shift+Alt+N|nav_search_enter_open|nav_compact_enable` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`39` совпадений на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-54: mission-control operator coaching loop (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены coaching helpers `adoptionEventCount`, `buildSidebarNavAdoptionCoaching`, `buildSidebarNavAdoptionSnapshot`, `clearSidebarNavAdoption`;
    - расширен handoff-блок: `sideHandoffCoaching` + actions `show/export/reset adoption snapshot`;
    - добавлен action-runner `runMissionHandoffAdoptionAction` с интеграцией в `sideHandoffTimeline`.
  - внедрено:
    - telemetry теперь сразу конвертируется в actionable coach-подсказки для оператора смены;
    - есть прозрачный handoff-контур для adoption (`show/export/reset`) без backend-зависимостей;
    - изменения сохранены в UI-слое (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-54:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-54:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка UI маркеров `sideHandoffCoaching|runMissionHandoffAdoptionAction|data-handoff-adoption-action|buildSidebarNavAdoptionSnapshot|clearSidebarNavAdoption|adoptionEventCount|buildSidebarNavAdoptionCoaching` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`23` совпадения на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-55: mission-control coaching cadence scoreboard (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены scorecard helpers `buildSidebarNavAdoptionScorecard`, `buildSidebarNavNextActions`;
    - расширен handoff-блок: `sideHandoffScorecard` + `sideHandoffNextActions`;
    - расширен adoption snapshot (`scorecard`, `next_actions`) и timeline-тексты `show/export`.
  - внедрено:
    - качество смены фиксируется как единый scorecard (`pass/warn`, %), а не только общий score;
    - handoff получает явные next-actions (что тренировать следующей сменой и почему);
    - изменения сохранены в UI-слое (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-55:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-55:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка UI маркеров `sideHandoffScorecard|sideHandoffNextActions|buildSidebarNavAdoptionScorecard|buildSidebarNavNextActions|next_actions|Scorecard:` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`14` совпадений на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-56: mission-control coaching trendline history (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены history/trend helpers `MISSION_ADOPTION_HISTORY_STORAGE_KEY`, `loadMissionAdoptionHistory`, `appendMissionAdoptionHistoryEntry`, `buildMissionAdoptionTrend`, `renderMissionHandoffAdoptionTrend`;
    - расширен handoff-блок: `sideHandoffTrend` с динамикой `IMPROVING/STABLE/REGRESSING` и `delta` к предыдущей смене;
    - сохранение `handoff save` теперь фиксирует scorecard snapshot в локальную историю смен.
  - внедрено:
    - оператор видит не только текущий scorecard, но и динамику качества смен;
    - handoff стал устойчивее для масштабирования: есть baseline/trend и причина изменения;
    - изменения сохранены в UI-слое (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-56:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-56:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка UI маркеров `MISSION_ADOPTION_HISTORY_STORAGE_KEY|loadMissionAdoptionHistory|appendMissionAdoptionHistoryEntry|buildMissionAdoptionTrend|renderMissionHandoffAdoptionTrend|sideHandoffTrend|improving|regressing` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`24` совпадения на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-57: mission-control coaching reset-pack (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены trend-history meta/lifecycle helpers: `MISSION_ADOPTION_HISTORY_META_STORAGE_KEY`, `loadMissionAdoptionHistoryMeta`, `buildMissionAdoptionHistoryLifecycle`, `clearMissionAdoptionHistory`;
    - добавлены handoff actions `Trend JSON / Export trend / Clear trend` через `runMissionHandoffTrendAction`;
    - добавлен статус history `sideHandoffTrendStatus` (`ACTIVE/RESET_RECENTLY/EMPTY`) с confirm-guardrails для `clear`.
  - внедрено:
    - lifecycle coaching-истории стал управляемым: можно показать/экспортировать/очистить trendline;
    - риск случайной потери history снижен confirm-подтверждением и явным статусом reset;
    - изменения сохранены в UI-слое (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-57:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-57:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка UI маркеров `MISSION_ADOPTION_HISTORY_META_STORAGE_KEY|loadMissionAdoptionHistoryMeta|clearMissionAdoptionHistory|buildMissionAdoptionHistoryLifecycle|runMissionHandoffTrendAction|data-handoff-trend-action|sideHandoffTrendStatus|nav_trend_history_show|nav_trend_history_export|nav_trend_history_clear` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`26` совпадений на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-58: mission-control coaching trend presets (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены persist-переключатели trend-window `last 3/5/10` (`MISSION_ADOPTION_TREND_WINDOW_STORAGE_KEY`, `load/storeMissionAdoptionTrendWindow`);
    - добавлен compact compare summary `now vs baseline` (`buildMissionAdoptionCompareSummary`, `sideHandoffTrendCompare`);
    - добавлено действие `runMissionHandoffTrendWindowAction` с записью в handoff timeline.
  - внедрено:
    - оператор переключает окно анализа динамики без JSON/перезагрузки;
    - handoff получил читаемое сравнение `now vs baseline` в том же блоке;
    - изменения сохранены в UI-слое (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-58:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-58:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка UI маркеров `MISSION_ADOPTION_TREND_WINDOW_STORAGE_KEY|MISSION_ADOPTION_TREND_WINDOWS|loadMissionAdoptionTrendWindow|storeMissionAdoptionTrendWindow|buildMissionAdoptionCompareSummary|runMissionHandoffTrendWindowAction|data-handoff-trend-window|sideHandoffTrendCompare|nav_trend_window_set` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`34` совпадения на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-59: mission-control coaching decision cues (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен coach-helper `buildMissionAdoptionTrendCoach` (регресс/стабильно/прогресс с actionable подсказкой);
    - добавлен UI-блок `sideHandoffTrendCoach` в mission-control handoff;
    - trend payload/snapshot расширены полем `trend_coach` для handoff/export continuity.
  - внедрено:
    - рядом с trend/compare появился прямой ответ “что делать следующей смене и почему”;
    - handoff стал практичнее для масштабирования: решение видно сразу в панели;
    - изменения сохранены в UI-слое (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-59:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-59:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка UI маркеров `MISSION_ADOPTION_TREND_WINDOW_STORAGE_KEY|MISSION_ADOPTION_TREND_WINDOWS|loadMissionAdoptionTrendWindow|storeMissionAdoptionTrendWindow|buildMissionAdoptionCompareSummary|runMissionHandoffTrendWindowAction|data-handoff-trend-window|sideHandoffTrendCompare|buildMissionAdoptionTrendCoach|sideHandoffTrendCoach|trend_coach|nav_trend_window_set` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`42` совпадения на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-60: mission-control coaching handoff composer (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены composer helpers `MISSION_HANDOFF_COMPOSER_STORAGE_KEY`, `buildMissionHandoffComposerTemplate`, `runMissionHandoffComposerAction`;
    - в handoff UI добавлены controls `Compose / Copy composer / Apply composer` (`data-handoff-compose-action`) и summary-блок `sideHandoffComposer`;
    - composer формирует стандартный шаблон из `scorecard + trend + trend_coach + next_actions`, пишет события в handoff timeline (`compose/compose_copy/compose_apply`).
  - внедрено:
    - оператор получает готовый handoff-текст без ручной сборки;
    - передача смены стала предсказуемой и повторяемой на масштабе;
    - изменения сохранены в UI-слое (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-60:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-60:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка UI маркеров `MISSION_HANDOFF_COMPOSER_STORAGE_KEY|buildMissionHandoffComposerTemplate|runMissionHandoffComposerAction|data-handoff-compose-action|sideHandoffComposer|compose_apply|compose_copy` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`17` совпадений на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

- выполнен phase-61: mission-control handoff quality guard (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены helpers `buildMissionHandoffQualityState`, `renderMissionHandoffQuality`, `runMissionHandoffQualityAction`;
    - в handoff UI добавлены `Quality check` action (`data-handoff-quality-action`) и status-блок `sideHandoffQuality`;
    - `save handoff` теперь проходит guardrail: при `NOT-READY` нужен явный override-подтверждённый save, события пишутся в timeline (`quality_check/quality_blocked/quality_override`).
  - внедрено:
    - передача смены стала контролируемой по quality-check стандарту;
    - оператор видит missing-пункты до сохранения и не теряет критичный контекст;
    - изменения сохранены в UI-слое (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-61:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-61:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - проверка UI маркеров `buildMissionHandoffQualityState|renderMissionHandoffQuality|runMissionHandoffQualityAction|data-handoff-quality-action|sideHandoffQuality|quality_blocked|quality_override|quality_check|Handoff NOT-READY` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`25` совпадений на страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-62): mission-control handoff quality profiles (UI-only) — добавить переключаемые профили качества (`strict/balanced`) и видимый policy state в handoff блоке. Зачем: управлять строгостью quality-guard под разные режимы эксплуатации без изменения backend.

## Актуализация: phase-62 (handoff quality profiles)

- выполнен phase-62: mission-control handoff quality profiles (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены профильные константы/хранилища quality policy: `MISSION_HANDOFF_QUALITY_PROFILE_STORAGE_KEY`, `MISSION_HANDOFF_QUALITY_PROFILES`;
    - добавлены helpers: `normalizeMissionHandoffQualityProfileId`, `resolveMissionHandoffQualityProfile`, `runMissionHandoffQualityProfileAction`;
    - добавлен переключатель policy (`strict/balanced`) в handoff UI (`data-handoff-quality-profile`) и summary-блок `sideHandoffQualityPolicy`;
    - `buildMissionHandoffQualityState` переведён на policy-aware проверки, timeline качества пишет `quality_profile_set` и `policy`.
  - внедрено:
    - operator может менять строгость quality-гейта по ситуации без backend-изменений;
    - quality-state в handoff стал предсказуемым и объяснимым;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-62:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-62:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - marker-check `MISSION_HANDOFF_QUALITY_PROFILE_STORAGE_KEY|MISSION_HANDOFF_QUALITY_PROFILES|normalizeMissionHandoffQualityProfileId|resolveMissionHandoffQualityProfile|runMissionHandoffQualityProfileAction|data-handoff-quality-profile|sideHandoffQualityPolicy|quality_profile_set|policy=` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`33` совпадения/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-63): mission-control handoff remediation assistant (UI-only) — добавить one-click remediation для missing-пунктов quality-гейта и explainability-подсказки по причинам блокировки save. Зачем: уменьшить forced-override и ускорить качественную передачу смены.

## Актуализация: phase-63 (handoff remediation assistant)

- выполнен phase-63: mission-control handoff remediation assistant (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены one-click remediation helpers: `appendMissionHandoffNextActionsToNote`, `appendMissionHandoffExpansionLine`, `runMissionHandoffQualityRemediationAction`;
    - `buildMissionHandoffQualityState` расширен explainability-полями: `remediation_actions`, `recommended_action`, `explain_text`, `block_reason`;
    - добавлены remediation controls в handoff UI: `data-handoff-quality-remedy` (`recommended`, `compose-apply`, `context`, `append-next-actions`) + explain node `sideHandoffQualityExplain`;
    - save/blocked/override тексты качества дополнены `fix=...`, timeline расширен событием `quality_remediate`.
  - внедрено:
    - оператор получает быстрый путь исправления `NOT-READY` перед save;
    - причины блокировки save теперь объясняются явно в UI;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-63:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-63:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `runMissionHandoffQualityRemediationAction|data-handoff-quality-remedy|sideHandoffQualityExplain|quality_remediate|appendMissionHandoffNextActionsToNote|appendMissionHandoffExpansionLine|fix=` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`22` совпадения/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-64): mission-control handoff remediation telemetry (UI-only) — добавить метрики эффективности remediation (`applied/skipped`, `override after remediation`, `time-to-ready`) и compact summary в handoff-блоке. Зачем: измерять реальный эффект quality-гейта и снижать override-driven handoff risk на масштабе.

## Актуализация: phase-64 (handoff remediation telemetry)

- выполнен phase-64: mission-control handoff remediation telemetry (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены telemetry-константы `MISSION_HANDOFF_REMEDIATION_METRICS_STORAGE_KEY`, `MISSION_HANDOFF_REMEDIATION_TTR_LIMIT`;
    - добавлены helpers: `normalizeMissionHandoffRemediationMetrics`, `updateMissionHandoffRemediationMetrics`, `renderMissionHandoffRemediationSummary`;
    - remediation lifecycle (`check/remediate/blocked/override/ready-save`) теперь пишет KPI-метрики: `applied`, `skipped`, `override_after_remediation`, `time_to_ready_sec_samples`;
    - в handoff UI добавлен compact KPI-блок `sideHandoffRemediationSummary`.
  - внедрено:
    - появился измеримый контур эффективности remediation assistant;
    - оператор видит в смене фактический эффект remediation (а не только текущий статус quality);
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-64:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-64:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `MISSION_HANDOFF_REMEDIATION_METRICS_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_TTR_LIMIT|normalizeMissionHandoffRemediationMetrics|updateMissionHandoffRemediationMetrics|renderMissionHandoffRemediationSummary|sideHandoffRemediationSummary|quality_remediate` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`30` совпадений/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-65): mission-control handoff remediation timeline drilldown (UI-only) — добавить drilldown-view remediation KPI по последним сменам (last N cycles) с export JSON и explainability по override-cases. Зачем: перейти от агрегатов к управляемому разбору причин деградации handoff качества.

## Актуализация: phase-65 (handoff remediation timeline drilldown)

- выполнен phase-65: mission-control handoff remediation timeline drilldown (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены timeline-константы `MISSION_HANDOFF_REMEDIATION_TIMELINE_STORAGE_KEY`, `MISSION_HANDOFF_REMEDIATION_TIMELINE_LIMIT`;
    - добавлены helpers: `normalizeMissionHandoffRemediationTimelineItem`, `appendMissionHandoffRemediationTimelineEvent`, `buildMissionHandoffRemediationTimelineSummary`, `renderMissionHandoffRemediationTimelinePreview`, `runMissionHandoffRemediationHistoryAction`;
    - remediation события (`remediate/override-save/ready-save`) пишутся в отдельный timeline для last-N drilldown;
    - в handoff UI добавлены controls `Remediation JSON/Export/Clear` и блоки `sideHandoffRemediationTimelineMeta`, `sideHandoffRemediationTimeline`.
  - внедрено:
    - оператор получает drilldown по последним remediation циклам вместо только агрегатов KPI;
    - стало проще разбирать override-after-remediation случаи и динамику ttr;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-65:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-65:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `MISSION_HANDOFF_REMEDIATION_TIMELINE_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_TIMELINE_LIMIT|normalizeMissionHandoffRemediationTimelineItem|appendMissionHandoffRemediationTimelineEvent|buildMissionHandoffRemediationTimelineSummary|renderMissionHandoffRemediationTimelinePreview|runMissionHandoffRemediationHistoryAction|data-handoff-remediation-history-action|sideHandoffRemediationTimelineMeta|sideHandoffRemediationTimeline` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`34` совпадения/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-66): mission-control handoff remediation governance pack (UI-only) — добавить policy targets для remediation KPI (порог override/ttr), статус compliance (`ok/warn`) и guided next-actions в handoff. Зачем: перейти от наблюдаемости к управляемому quality governance на масштабе 100-200 систем.

## Актуализация: phase-66 (handoff remediation governance pack)

- выполнен phase-66: mission-control handoff remediation governance pack (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены governance-константы `MISSION_HANDOFF_REMEDIATION_GOVERNANCE_STORAGE_KEY`, `MISSION_HANDOFF_REMEDIATION_GOVERNANCE_PROFILES`;
    - добавлены helpers: `normalizeMissionHandoffRemediationGovernanceProfileId`, `buildMissionHandoffRemediationGovernanceState`, `renderMissionHandoffRemediationGovernance`, `runMissionHandoffRemediationGovernanceAction`;
    - добавлены governance controls в handoff UI (`data-handoff-remediation-governance`), summary nodes `sideHandoffRemediationGovernance`, `sideHandoffRemediationActions`;
    - governance-state интегрирован с remediation KPI/timeline и обновляется в общем remediation summary-потоке.
  - внедрено:
    - remediation KPI теперь оцениваются против target-порогов (`override rate`, `p95 TTR`);
    - оператор получает compliance status (`OK/WARN`) и guided next-action;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-66:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-66:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `MISSION_HANDOFF_REMEDIATION_GOVERNANCE_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_GOVERNANCE_PROFILES|normalizeMissionHandoffRemediationGovernanceProfileId|buildMissionHandoffRemediationGovernanceState|renderMissionHandoffRemediationGovernance|runMissionHandoffRemediationGovernanceAction|data-handoff-remediation-governance|sideHandoffRemediationGovernance|sideHandoffRemediationActions` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`33` совпадения/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-67): mission-control handoff remediation governance incidents (UI-only) — добавить автогенерацию governance-incidents при `WARN` (локальный incident feed + ack/snooze в sidebar). Зачем: закрыть цикл от контроля KPI к операционному реагированию в смене.


## Актуализация: phase-67 (handoff remediation governance incidents)

- выполнен phase-67: mission-control handoff remediation governance incidents (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - подключен governance incident feed к remediation summary (`ensureMissionHandoffRemediationGovernanceIncident`, `renderMissionHandoffRemediationIncidents`);
    - добавлены operator actions `Incident ACK` / `Incident Snooze` в sidebar (`data-handoff-remediation-incident-action`) с обработчиком кликов;
    - добавлен trace открытия incident (`remediation_incident_open`) в handoff timeline;
    - исправлена логика активности snooze (инцидент не считается active до истечения `snooze_until`).
  - внедрено:
    - governance WARN теперь ведёт к операционному объекту (incident) прямо в handoff-контуре;
    - оператор может закрывать/откладывать WARN без выхода из текущего экрана смены;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-67:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-67:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `MISSION_HANDOFF_REMEDIATION_INCIDENTS_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_INCIDENTS_LIMIT|MISSION_HANDOFF_REMEDIATION_INCIDENT_SNOOZE_MIN|normalizeMissionHandoffRemediationIncidentItem|listMissionHandoffRemediationIncidents|ensureMissionHandoffRemediationGovernanceIncident|runMissionHandoffRemediationIncidentAction|data-handoff-remediation-incident-action|sideHandoffRemediationIncidentSummary|sideHandoffRemediationIncidentFeed` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`28` совпадений/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-68): mission-control handoff remediation incidents operations panel (UI-only) — добавить incident journal tools (`show/export/clear`) и compact SLA-view по age/open-snooze-acked для сменного handoff. Зачем: сделать governance incidents полностью операбельными для дежурной команды и упростить разбор смены без внешних инструментов.


## Актуализация: phase-68 (handoff remediation incidents operations panel)

- выполнен phase-68: mission-control handoff remediation incidents operations panel (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены incidents operations actions `Incident JSON / Export incidents / Clear incidents` (`data-handoff-remediation-incident-history-action`);
    - добавлен compact incidents SLA summary (`sideHandoffRemediationIncidentSla`) c oldest active age;
    - добавлены timeline traces для операций journal (`remediation_incident_journal_show|export|clear`).
  - внедрено:
    - governance incidents теперь имеют полный локальный lifecycle-цикл в handoff без внешних тулов;
    - оператор получает быстрый обзор состояния incidents и возраста backlog;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-68:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-68:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `buildMissionHandoffRemediationIncidentSlaSummary|renderMissionHandoffRemediationIncidentSla|runMissionHandoffRemediationIncidentHistoryAction|data-handoff-remediation-incident-history-action|sideHandoffRemediationIncidentSla|remediation_incident_journal_show|remediation_incident_journal_export|remediation_incident_journal_clear` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`17` совпадений/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-69): mission-control handoff remediation incidents digest board (UI-only) — добавить digest-сводку по top incident fingerprints (частота/age/last-state) и guided triage hints для смены. Зачем: снизить время анализа повторяющихся WARN и ускорить решение корневых причин на масштабе.


## Актуализация: phase-69 (handoff remediation incidents digest board)

- выполнен phase-69: mission-control handoff remediation incidents digest board (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены digest helpers: `buildMissionHandoffRemediationIncidentDigest`, `buildMissionHandoffRemediationIncidentTriageHints`, `renderMissionHandoffRemediationIncidentDigest`;
    - digest board агрегирует top fingerprints (`count/age/last-state`) и сортирует по risk-priority;
    - triage hint выводится в отдельный блок (`sideHandoffRemediationIncidentTriage`) в handoff sidebar.
  - внедрено:
    - оператор получает ранжированный обзор повторяющихся governance WARN-patterns;
    - первичный triage формируется прямо в handoff без ручного анализа сырых JSON;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-69:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-69:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `buildMissionHandoffRemediationIncidentDigest|buildMissionHandoffRemediationIncidentTriageHints|renderMissionHandoffRemediationIncidentDigest|sideHandoffRemediationIncidentDigest|sideHandoffRemediationIncidentTriage|Top fingerprint|Digest triage` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`13` совпадений/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-70): mission-control handoff remediation digest action planner (UI-only) — добавить quick planner по top fingerprints (suggested action: `ack/snooze/escalate/profile-check`) и генерацию handoff-ready action plan для смены. Зачем: перевести digest из наблюдения в управляемое исполнение и сократить time-to-decision для повторяющихся WARN.


## Актуализация: phase-70 (handoff remediation digest action planner)

- выполнен phase-70: mission-control handoff remediation digest action planner (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены planner helpers: `missionHandoffRemediationPlannerSuggestAction`, `buildMissionHandoffRemediationActionPlan`, `renderMissionHandoffRemediationActionPlan`, `runMissionHandoffRemediationPlanAction`;
    - добавлены planner actions в UI: `Plan JSON`, `Export plan`, `Copy handoff plan` (`data-handoff-remediation-plan-action`);
    - добавлены timeline traces planner-действий (`remediation_digest_plan_show|export|copy`).
  - внедрено:
    - digest превращён в actionable план с suggested actions (`ack/snooze/escalate/profile-check`);
    - handoff-ready план теперь формируется и экспортируется прямо из sidebar;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-70:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-70:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `missionHandoffRemediationPlannerSuggestAction|buildMissionHandoffRemediationActionPlan|renderMissionHandoffRemediationActionPlan|runMissionHandoffRemediationPlanAction|data-handoff-remediation-plan-action|sideHandoffRemediationPlanSummary|sideHandoffRemediationPlan|remediation_digest_plan_show|remediation_digest_plan_export|remediation_digest_plan_copy` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`21` совпадение/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-71): mission-control remediation planner decision ledger (UI-only) — добавить журнал решений planner (что выбрано/когда/по какому fingerprint) с show/export/clear и компактной сводкой decision coverage. Зачем: обеспечить операционную трассируемость решений смены и контроль исполнения предложенного плана.


## Актуализация: phase-71 (remediation planner decision ledger)

- выполнен phase-71: mission-control remediation planner decision ledger (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен decision ledger storage+helpers (`normalize/list/store/append`);
    - добавлены decision actions в planner: `log-primary`, `ledger-show/export/clear`;
    - добавлены decision coverage и ledger preview nodes (`sideHandoffRemediationDecisionCoverage`, `sideHandoffRemediationDecisionLedger`).
  - внедрено:
    - появилась трассируемость решений planner по fingerprint/action;
    - coverage показывает, какая доля suggested actions уже зафиксирована в decision ledger;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-71:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-71:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `MISSION_HANDOFF_REMEDIATION_DECISION_LEDGER_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_DECISION_LEDGER_LIMIT|normalizeMissionHandoffRemediationDecisionItem|listMissionHandoffRemediationDecisionLedger|buildMissionHandoffRemediationDecisionCoverage|renderMissionHandoffRemediationDecisionCoverage|runMissionHandoffRemediationPlanAction|data-handoff-remediation-plan-action|sideHandoffRemediationDecisionCoverage|sideHandoffRemediationDecisionLedger|remediation_decision_ledger_show|remediation_decision_ledger_export|remediation_decision_ledger_clear|remediation_digest_plan_log_primary` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`43` совпадения/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-72): mission-control remediation decision backlog cockpit (UI-only) — добавить отдельный backlog missing-decisions (по coverage gap) с show/export/copy и быстрым handoff-резюме по невыполненным решениям. Зачем: ускорить закрытие decision-gap в смене и снизить риск незавершённых remediation-действий.


## Актуализация: phase-72 (remediation decision backlog cockpit)

- выполнен phase-72: mission-control remediation decision backlog cockpit (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены backlog helpers: `missionHandoffRemediationDecisionMatchKey`, `buildMissionHandoffRemediationDecisionBacklog`, `renderMissionHandoffRemediationDecisionBacklog`;
    - `runMissionHandoffRemediationPlanAction` расширен backlog actions: `backlog-show`, `backlog-export`, `backlog-copy`;
    - в mission-control добавлены backlog controls и nodes: `sideHandoffRemediationDecisionBacklogSummary`, `sideHandoffRemediationDecisionBacklog`.
  - внедрено:
    - оператор видит coverage-gap (`missing decisions`) как отдельный backlog cockpit;
    - появился handoff-ready backlog summary для незакрытых planner-решений;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-72:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-72:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `missionHandoffRemediationDecisionMatchKey|buildMissionHandoffRemediationDecisionBacklog|renderMissionHandoffRemediationDecisionBacklog|runMissionHandoffRemediationPlanAction|data-handoff-remediation-plan-action|sideHandoffRemediationDecisionBacklogSummary|sideHandoffRemediationDecisionBacklog|backlog-show|backlog-export|backlog-copy|remediation_decision_backlog_show|remediation_decision_backlog_export|remediation_decision_backlog_copy` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`41` совпадение/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-73): mission-control remediation decision backlog closeout assistant (UI-only) — добавить быстрые closeout-действия прямо из backlog (`ack/snooze/profile-check`) и пакетный closeout по top-missing решениям. Зачем: сократить время закрытия decision-gap в смене и снизить риск «висящих» remediation-задач.


## Актуализация: phase-73 (remediation decision backlog closeout assistant)

- выполнен phase-73: mission-control remediation decision backlog closeout assistant (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены backlog closeout helpers: `normalizeMissionHandoffRemediationBacklogDecision`, `applyMissionHandoffRemediationBacklogCloseout`;
    - `runMissionHandoffRemediationPlanAction` расширен closeout-модами: `backlog-item-*` (single) и `backlog-batch-*` (batch top-missing);
    - backlog panel получила action controls по каждой missing-записи (`ACK/Snooze/Profile check`) + batch controls (`Batch ACK/Snooze/Profile`).
  - внедрено:
    - оператор может закрывать `missing decisions` прямо из backlog без ручного обхода planner/ledger;
    - появился быстрый batch closeout для top-missing решений в смене;
    - сохранён UI-only подход (URL/API/schema/role-guard без изменений).

- локальная валидация после phase-73:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-73:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --server-host 207.180.213.225 --server-user alis --admin-user admin --admin-pass "<BASIC_AUTH_PASS>"` — OK (`/admin/*` и `/api/admin/*` отвечают `200`);
  - marker-check `MISSION_HANDOFF_REMEDIATION_DECISION_BACKLOG_CLOSEOUT_LIMIT|normalizeMissionHandoffRemediationBacklogDecision|applyMissionHandoffRemediationBacklogCloseout|runMissionHandoffRemediationPlanAction|data-handoff-remediation-plan-action|backlog-item-ack-|backlog-item-snooze-|backlog-item-profile-check-|backlog-batch-ack|backlog-batch-snooze|backlog-batch-profile-check|remediation_decision_backlog_closeout_item|remediation_decision_backlog_closeout_batch|sideHandoffRemediationDecisionBacklog` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`37` совпадений/страницу);
  - `docker logs` без `ResponseValidationError|Traceback|coroutine object|ERROR` — OK.

Следующий шаг (phase-74): mission-control remediation decision closeout governance board (UI-only) — добавить сводку closeout-качества (`single/batch`, `ack/snooze/profile-check`, remaining gap) и JSON/export отчёт смены по closeout-операциям. Зачем: сделать закрытие decision-gap измеримым и управляемым на масштабе без внешних инструментов.

## Актуализация: phase-74 (remediation decision closeout governance board)

- выполнен phase-74: mission-control remediation decision closeout governance board (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены closeout governance helpers: `listMissionHandoffRemediationCloseoutEntries`, `buildMissionHandoffRemediationCloseoutGovernance`, `renderMissionHandoffRemediationCloseoutGovernance`;
    - `runMissionHandoffRemediationPlanAction` расширен действиями `closeout-governance-show` и `closeout-governance-export`;
    - в mission-control добавлены UI controls `Closeout JSON` и `Export closeout`, а также блоки `sideHandoffRemediationCloseoutSummary` и `sideHandoffRemediationCloseoutBoard`.
  - внедрено:
    - closeout-операции стали измеримыми по mode (`single/batch`) и decision-type (`ack/snooze/profile-check`);
    - оператор получает shift-ready governance payload с `remaining_gap` и статусом `OPEN/PROGRESS/RISK/CLOSED`.

- локальная валидация после phase-74:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-74:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - marker-check `closeout-governance-show|closeout-governance-export|sideHandoffRemediationCloseoutSummary|sideHandoffRemediationCloseoutBoard|buildMissionHandoffRemediationCloseoutGovernance|renderMissionHandoffRemediationCloseoutGovernance|remediation_decision_closeout_governance_show|remediation_decision_closeout_governance_export` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`26` совпадений/страницу).

Следующий шаг (phase-75): mission-control remediation closeout escalation routing (UI-only) — добавить policy-слой эскалации для `remaining_gap` (когда и как поднимать эскалацию по closeout status), action controls (`show/export/copy`) и timeline traces по escalation decisions. Зачем: превратить closeout governance из мониторинга в управляемое действие смены с единым handoff-контуром.

## Актуализация: phase-75 (remediation closeout escalation routing)

- выполнен phase-75: mission-control remediation closeout escalation routing (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлен escalation policy-layer `MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_POLICIES`;
    - добавлены helpers: `resolveMissionHandoffRemediationCloseoutEscalationPolicy`, `buildMissionHandoffRemediationCloseoutEscalation`, `renderMissionHandoffRemediationCloseoutEscalation`;
    - `runMissionHandoffRemediationPlanAction` расширен action-модами `closeout-escalation-show`, `closeout-escalation-export`, `closeout-escalation-copy`;
    - добавлены timeline события: `remediation_decision_closeout_escalation_show/export/copy`;
    - в mission-control добавлены escalation controls и блоки `sideHandoffRemediationEscalationSummary/Board`.
  - внедрено:
    - closeout governance теперь автоматически трансформируется в escalation route (`level/route/channel/action`) по `status + remaining_gap`;
    - оператор получает handoff-ready escalation payload (JSON/text) без внешних инструментов.

- локальная валидация после phase-75:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-75:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - marker-check `MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_POLICIES|resolveMissionHandoffRemediationCloseoutEscalationPolicy|buildMissionHandoffRemediationCloseoutEscalation|renderMissionHandoffRemediationCloseoutEscalation|closeout-escalation-show|closeout-escalation-export|closeout-escalation-copy|sideHandoffRemediationEscalationSummary|sideHandoffRemediationEscalationBoard|remediation_decision_closeout_escalation_show|remediation_decision_closeout_escalation_export|remediation_decision_closeout_escalation_copy` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`29` совпадений/страницу).

Следующий шаг (phase-76): mission-control closeout escalation execution logbook (UI-only) — добавить журнал исполнения эскалаций (`ack/snooze/resolve` для escalation route), SLA-age по эскалациям и handoff-экспорт execution state. Зачем: замкнуть контур “маршрутизация → исполнение → контроль” и снизить риск потерянных escalation-действий между сменами.

## Актуализация: phase-76 (closeout escalation execution logbook)

- выполнен phase-76: mission-control closeout escalation execution logbook (UI-only) без изменения API/schema:
  - `backend/app/admin_ui_kit.py`:
    - добавлены execution storage и SLA константы: `MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_EXECUTION_*`;
    - добавлены helpers execution-контура: `normalize/list/store/append` + `build/render MissionHandoffRemediationCloseoutEscalationExecutionState`;
    - `runMissionHandoffRemediationPlanAction` расширен action-модами:
      - lifecycle: `closeout-escalation-ack`, `closeout-escalation-snooze`, `closeout-escalation-resolve`;
      - operations: `closeout-escalation-log-show`, `closeout-escalation-log-export`, `closeout-escalation-log-copy`;
    - добавлены timeline-события execution-контура.
  - mission-control UI расширен:
    - кнопки lifecycle и execution operations для escalation;
    - блоки `sideHandoffRemediationEscalationExecutionSummary/Board`.
  - внедрено:
    - escalation-routing теперь закрывается контуром исполнения (`ack/snooze/resolve`) в пределах смены;
    - появился SLA-age контроль для escalation execution (IDLE/OK/WARN/STALE) и handoff-ready payload.

- локальная валидация после phase-76:
  - `python3 -m py_compile backend/app/admin_ui_kit.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py backend/app/admin_fleet_incidents_page.py backend/app/main.py` — OK;
  - `python3 -m compileall -q backend/app` — OK;
  - `bash -n scripts/admin_panel_smoke_gate.sh` — OK.

- выкатка и smoke после phase-76:
  - `rsync -av backend/app/admin_ui_kit.py alis@207.180.213.225:/opt/passengers-backend/app/` — OK;
  - `ssh alis@207.180.213.225 'cd /opt/passengers-backend && sudo docker compose -f compose.yaml -f compose.server.yaml up -d --build api'` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --admin-pass "<BASIC_AUTH_PASS>"` — OK;
  - marker-check `MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_EXECUTION_STORAGE_KEY|MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_EXECUTION_LIMIT|MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_SLA_STALE_SEC|MISSION_HANDOFF_REMEDIATION_CLOSEOUT_ESCALATION_SNOOZE_MIN|normalizeMissionHandoffRemediationCloseoutEscalationExecutionItem|listMissionHandoffRemediationCloseoutEscalationExecution|storeMissionHandoffRemediationCloseoutEscalationExecution|appendMissionHandoffRemediationCloseoutEscalationExecutionEntry|missionHandoffRemediationCloseoutEscalationExecutionActive|buildMissionHandoffRemediationCloseoutEscalationExecutionState|renderMissionHandoffRemediationCloseoutEscalationExecution|closeout-escalation-ack|closeout-escalation-snooze|closeout-escalation-resolve|closeout-escalation-log-show|closeout-escalation-log-export|closeout-escalation-log-copy|sideHandoffRemediationEscalationExecutionSummary|sideHandoffRemediationEscalationExecutionBoard|remediation_decision_closeout_escalation_ack|remediation_decision_closeout_escalation_snooze|remediation_decision_closeout_escalation_resolve|remediation_decision_closeout_escalation_execution_show|remediation_decision_closeout_escalation_execution_export|remediation_decision_closeout_escalation_execution_copy` на `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/incidents`, `/admin/audit` — OK (`66` совпадений/страницу).

Следующий шаг (phase-77): mission-control closeout escalation execution anomaly guard (UI-only) — добавить anomaly-детектор для execution logbook (повторные snooze, длительный stale, отсутствие resolve), быстрые recommended actions и JSON/export anomaly report. Зачем: перейти от пассивного SLA-наблюдения к проактивному предотвращению срывов escalation-исполнения на смене.

## Актуализация: этап 3 rollout единого UI/UX стандарта (2026-02-16)

- выполнен первый practical-step этапа 3 по стандарту `Docs/Проект/Админ-панель (UI-UX стандарт).md`:
  - `backend/app/admin_fleet_notifications_page.py`:
    - добавлен header-summary `filterSummary` (`контекст: глобальні правила сповіщень`) для выравнивания с паттерном `copyLink + summary`.
  - `backend/app/admin_fleet_incidents_page.py`:
    - унифицированы подписи командной палитры под каноничные query-термины (`include_resolved=0`, `sla_breached_only=1`);
    - устранена смешанная формулировка (`protected presets` -> `захищені пресети`).
  - `backend/app/admin_fleet_page.py` и `backend/app/admin_fleet_alerts_page.py`:
    - выполнена дополнительная текстовая унификация command palette (UA-first формулировки для `shared namespace`/`policy lock`/`preview merge`);
    - изменения ограничены UI-copy, без правок API/schema/route и без изменения контрактов DOM-hooks.

- проверки после изменений:
  - `python3 -m py_compile backend/app/admin_fleet_notifications_page.py backend/app/admin_fleet_incidents_page.py backend/app/admin_fleet_page.py backend/app/admin_fleet_alerts_page.py` — OK;
  - локальный marker-аудит рендера `/admin*` (`copy/summary/flow/meta`) — OK;
  - `./scripts/admin_panel_smoke_gate.sh --admin-pass-file "pass admin panel"` — PASS.

Следующий шаг (этап 3): page-by-page текстовая унификация CTA/status/help в `overview/fleet/alerts/incidents/notifications`, затем повторный marker-аудит и фиксация итогового списка расхождений для закрытия этапа 4.

## Актуализация: этап 3 rollout единого UI/UX стандарта (2026-02-16, `overview` + `commission`)

- `backend/app/admin_overview_page.py`:
  - унифицированы ключевые UX-тексты в toolbar/status-контексте (`авто`, `Персональні override-и`, `Центр сповіщень`, `відкриті/підтверджені/заглушені`).
- `backend/app/admin_commission_page.py`:
  - выровнены подписи onboarding-потока подключения транспорта:
    - единые термины полей (`IP central`, `door-1/door-2 IP`, `vehicle_id`, `номер`);
    - единые CTA (`Підставити vehicle_id`, `Скинути номер`);
    - единая терминология header/summary (`посилання`, `ПРОГОНИ`, `наживо`, UA-first тексты alert/evidence).
- Ограничение изменений:
  - только text/UI-copy; без изменений API, URL-контрактов, DOM-id и role-guards.
- Проверки:
  - `python3 -m py_compile backend/app/admin_overview_page.py backend/app/admin_commission_page.py` — OK;
  - `./scripts/admin_panel_smoke_gate.sh --admin-pass-file "pass admin panel"` — PASS.

Следующий шаг (этап 4): завершить page-by-page аудит `/admin*` по чеклисту стандарта и зафиксировать остаточные несоответствия (приоритет/план закрытия).

## Актуализация: этап 4 server-first audit (2026-02-16, `fleet/alerts/incidents`)

- Закрыт residual по mixed-language copy в command/preset-подсказках:
  - `Preview` заменён на `Попередній перегляд` в пользовательских prompt/status строках;
  - `open/acked/silenced` заменено на `відкриті/підтверджені/заглушені` в описании incident-grid.
- Проверочный контур:
  - деплой изменений на VPS через `rsync` в `/opt/passengers-backend/app/`;
  - серверная пересборка `api` через `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` на сервере — PASS (`/admin*` и `/api/admin/*` = `200`, логи без ошибок).
- Ограничение изменений:
  - только UI-copy в существующих маршрутах; API/roles/DOM hooks не изменялись.

Следующий шаг (этап 4): продолжить server-first page audit для `notifications/notify-center/history/policy/wg/incident-detail` и зафиксировать final DoD residual-list.

## Актуализация: этап 4 server-first marker audit (2026-02-16, `notifications/notify-center/history/policy/wg/actions/audit`)

- Аудит выполнен на сервере через `ssh` с проверкой HTML-маркеров:
  - `copyLink`
  - `filterSummary`
  - `flowStep`
  - `tableMeta`
- Выявленный residual:
  - `/admin/fleet/notifications` имел `filterSummary=0` (устаревшая серверная версия страницы).
- Исправление в server-first контуре:
  - выкачен `backend/app/admin_fleet_notifications_page.py` на VPS;
  - выполнены `py_compile` + `docker compose ... up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.
- Результат повторного marker-аудита:
  - для `/admin/fleet/notifications`, `/admin/fleet/notify-center`, `/admin/fleet/history`, `/admin/fleet/policy`, `/admin/wg`, `/admin/fleet/actions`, `/admin/audit` получено `copyLink=1 filterSummary=1 flowStep=3 tableMeta=1`.

Следующий шаг (этап 4): финально закрыть динамические route-аудиты (`central detail` и `incident detail`) как только в backend появятся `centrals/incidents`, затем зафиксировать DoD.

## Актуализация: этап 5 server-first IA rework меню/подменю (2026-02-16)

- Выполнено в `backend/app/admin_ui_kit.py`:
  - внедрена новая IA-навигация `меню -> подменю` с 5 разделами:
    - `Старт`
    - `Флот`
    - `Сповіщення`
    - `Контроль і KPI`
    - `Інфраструктура`
  - добавлен page-level `subnav` под header для активного раздела (соседние страницы категории);
  - у неактивных групп включено стартовое `collapsed` состояние (progressive disclosure);
  - в `Simple`-режиме дополнительно скрыт `quick-jump`, чтобы уменьшить визуальный шум.
- UX-ограничения:
  - изменения только в shell-архитектуре и навигационной подаче;
  - API/routes/role-guards/данные страниц не изменялись.
- Операционный контур (server-first):
  - выкатка `admin_ui_kit.py` через `rsync` на VPS;
  - на сервере `py_compile` + `docker compose -f compose.yaml -f compose.server.yaml up -d --build api`;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.
- Серверный рендер-аудит:
  - подтверждены маркеры новой IA: `sideLinkHub`, `sideLinkSub`, `pageSubnav`, `sideGroup collapsed` на `/admin`, `/admin/fleet`, `/admin/fleet/alerts`, `/admin/fleet/notify-center`.

Следующий шаг (этап 6): провести content-split перегруженных страниц (`fleet`, `notify-center`) по новой IA карте и закрепить “какой блок на какой странице” в runbook.

## Актуализация: этап 6 server-first переход на `Core + Domains` (2026-02-16)

- Реализовано архитектурное разделение навигационного слоя:
  - `admin_domains/domain_catalog.py` — доменная карта админ-панели;
  - `admin_core/navigation.py` — ядро навигации (groups/workflow/page-subnav);
  - `admin_ui_kit.py` использует эти модули вместо inline-определения IA.
- Подготовлена аналогичная структура для клиентской панели (scaffold):
  - `client_domains/domain_catalog.py`
  - `client_core/navigation.py`
- Добавлен отдельный стратегический runbook:
  - `Docs/Проект/Операции/Стратегия доработки веб-панели (admin+client).md`
- Ограничения этапа:
  - не менялись API-контракты и route-пути;
  - фокус только на архитектурной декомпозиции shell-навигации.
- Проверки:
  - локально `py_compile` новых модулей и `admin_ui_kit.py` — OK;
  - server-first выкатка + `scripts/admin_panel_smoke_gate.sh` — PASS.

Следующий шаг (этап 7): доменная декомпозиция перегруженных страниц (сначала `fleet`, затем `notify-center`) с переносом вторичных блоков в отдельные соседние route в пределах той же доменной группы.

## Актуализация: этап 7 server-first стандартизация `Core + Domains` по документации и inventory (2026-02-16)

- Усилен доменный контракт в коде:
  - `admin_domains/domain_catalog.py` и `client_domains/domain_catalog.py` теперь хранят не только nav-label/href, но и `page_file`, `api_group`, `doc_path`, `owner`.
- Добавлен единый авто-инвентарь доменов:
  - скрипт `scripts/web_panel_domain_inventory.py`;
  - отчёт `Docs/auto/web-panel/domain-inventory.md`.
- Введена структурная документация по ядру и каждому домену:
  - `Docs/Проект/Веб-панель/INDEX.md` + отдельные domain-docs (`Старт`, `Флот`, `Сповіщення`, `Контроль і KPI`, `Інфраструктура`, `Клієнт`).
- Проверки:
  - `py_compile` новых/обновлённых core/domain модулей — OK;
  - server-first выкатка и `scripts/admin_panel_smoke_gate.sh` — PASS.

Следующий шаг (этап 8): практический content-split домена `Флот` с переносом вторичных блоков из overview-страницы в профильные page-route домена.

## Актуализация: этап 8 step-1 server-first content-split `Флот` (2026-02-16)

- `backend/app/admin_fleet_page.py`:
  - secondary-блоки (`Потік алертів`, `Оперативна стрічка подій`) вынесены в сворачиваемый контейнер `fleetSecondaryDetails`;
  - primary-блоки оставлены в верхней видимой зоне для быстрого triage;
  - добавлен persistence раскрытия secondary-блока через `localStorage`.
- Ограничения этапа:
  - API/routes/role-guards не менялись;
  - DOM-id таблиц сохранены (без поломки JS-обновлений).
- Проверки:
  - server-first выкатка + `py_compile` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - серверный render-check подтверждает `fleetSecondaryDetails`.

## Актуализация: этап 8 step-2 server-first content-split `Сповіщення` (2026-02-16)

- `backend/app/admin_fleet_notify_center_page.py`:
  - на странице `/admin/fleet/notify-center` выделен primary-контур `Оперативний огляд доставки`;
  - детальный delivery-журнал и retry-операции вынесены в сворачиваемый secondary-блок `notifySecondaryDetails`;
  - добавлен persistence раскрытия secondary-блока через `localStorage`.
- Ограничения этапа:
  - API/routes/role-guards не менялись;
  - сохранены DOM-id таблицы и агрегатов (`tbl`, `sum*`) для обратной совместимости JS-логики.
- Проверки:
  - server-first выкатка + `py_compile` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - серверный render-check подтверждает `notifySecondaryDetails` и key `passengers_admin_notify_secondary_details_v1`.

## Актуализация: этап 8 step-3 server-first content-split `Контроль і KPI` (2026-02-16)

- `backend/app/admin_fleet_policy_page.py`:
  - primary-контур `Глобальна політика моніторингу` оставлен в верхней видимой зоне;
  - secondary-сценарий `Персональні override-и` вынесен в сворачиваемый блок `policySecondaryDetails`;
  - добавлен persistence раскрытия secondary-блока через `localStorage`.
- Ограничения этапа:
  - API/routes/role-guards не менялись;
  - сохранены DOM-id override-контракта (`ov*`, `ovTbl`) для обратной совместимости JS-логики.
- Проверки:
  - server-first выкатка + `py_compile` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - серверный render-check подтверждает `policySecondaryDetails` и key `passengers_admin_policy_secondary_details_v1`.

## Актуализация: этап 8 step-4 server-first content-split `Інфраструктура` (2026-02-16)

- `backend/app/admin_wg_page.py`:
  - primary-контур `Базова мережева діагностика` оставлен в верхней видимой зоне;
  - secondary-сценарий серверного WG-конфига вынесен в сворачиваемый блок `wgSecondaryDetails`;
  - добавлен persistence раскрытия secondary-блока через `localStorage`.
- Ограничения этапа:
  - API/routes/role-guards не менялись;
  - сохранены DOM-id контракты (`tbl`, `conf`, `copyConf`) для обратной совместимости.
- Проверки:
  - server-first выкатка + `py_compile` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - серверный render-check подтверждает `wgSecondaryDetails` и key `passengers_admin_wg_secondary_details_v1`.

Следующий шаг (этап 9): `Client Panel MVP` — запуск отдельного client-shell и первичных доменных страниц клиента.

## Актуализация: этап 9 server-first `Client Panel MVP step-1` (2026-02-16)

- Добавлены клиентские UI-модули:
  - `backend/app/client_ui_kit.py`;
  - `backend/app/client_home_page.py`;
  - `backend/app/client_vehicles_page.py`;
  - `backend/app/client_tickets_page.py`;
  - `backend/app/client_status_page.py`;
  - `backend/app/client_profile_page.py`;
  - `backend/app/client_notifications_page.py`.
- `backend/app/main.py`:
  - включены thin-routes `/client`, `/client/vehicles`, `/client/tickets`, `/client/status`, `/client/profile`, `/client/notifications`.
- `backend/app/client_domains/domain_catalog.py`:
  - заполнены `page_file` для всех client route.
- `server/nginx/passengers-admin.conf`:
  - добавлен location `/client` (BasicAuth + proxy на backend) для внутреннего MVP-доступа.
- Проверки:
  - server-first выкатка + `py_compile` — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS (расширен проверкой `/client*`);
  - серверный route-check подтверждает `/client*`: `auth=200`, `anon=401`, client-маркеры присутствуют.

Следующий шаг (этап 10): `Client MVP step-2` — подключить реальные клиентские API-данные и базовый auth-контур клиента.

## Актуализация (2026-02-16): Client MVP step-2

- По модели `Core + Domains` дополнен клиентский контур:
  - `backend/app/client_ops.py` (доменная API-логика клиента);
  - `/api/client/*` в `backend/app/main.py` (thin-routes + client context);
  - `client_profiles` и `client_notification_settings` в `backend/app/db.py`.
- Клиентские страницы (`client_*_page.py`) переведены на server-data (без локальных mock-данных).
- Nginx-маршрутизация расширена:
  - `server/nginx/passengers-admin.conf` теперь обслуживает `/api/client/*` с Bearer proxy и actor header.
- Единый smoke-gate обновлён:
  - `scripts/admin_panel_smoke_gate.sh` проверяет `/api/client/whoami|home|vehicles|tickets|status|profile|notification-settings`.
- Server-first результат:
  - deploy + nginx reload + smoke-gate = PASS.

Следующий этап: client UX-polish и роль `admin-support` для клиентских сценариев поддержки без смешения с admin triage.

## Актуализация (2026-02-16): Client MVP step-3 (IA/UX без перегруза)

- В клиентском `Core` добавлен общий secondary-механизм (`client_ui_kit.py`):
  - унифицированные стили `secondaryDetails`;
  - helper `bindDetailsState(...)` для persisted-состояния секций.
- В клиентском домене `tickets/status` применён паттерн `primary + secondary`:
  - `tickets`: активные обращения в primary, архив resolved в secondary;
  - `status`: attention feed в primary, полная лента в secondary.
- Результат:
  - меньше визуальной плотности в первом экране;
  - подробная информация остаётся доступной без выноса в отдельные страницы.
- Server-first результат:
  - deploy на VPS + smoke-gate = PASS.

Следующий этап: роль `admin-support` в клиентском контуре и mobile-тюнинг табличных сценариев.

## Актуализация (2026-02-16): Client MVP step-4 (support-role + mobile)

- В client API добавлен role-контур:
  - `whoami.role` (`client` / `admin-support`);
  - env-политика `CLIENT_SUPPORT_USERS`.
- В client UI выполнен mobile tune:
  - `mobileFriendly` таблицы;
  - `mobileHide` вторичные колонки;
  - одноколоночный toolbar flow на узких экранах.
- `tickets/status` используют role-aware secondary поведение:
  - для `admin-support` secondary блоки открываются по умолчанию.
- Server-first результат:
  - deploy на VPS + smoke-gate = PASS.

Следующий этап: `Client MVP step-5` — сценарный polish `home/vehicles` (SLA/ETA, краткие CTA, mobile readability).

## Актуализация (2026-02-16): Client MVP step-5 (SLA/ETA scenarios)

- В client backend (`backend/app/client_ops.py`) выполнен сценарный слой SLA/ETA:
  - добавлены helpers `_estimate_eta_delay_min`, `_resolve_sla_state`, `_to_int`;
  - расширены payload `home` и `vehicles` полями SLA/ETA (`sla_*`, `eta_*`, `attention`, `pending_batches`, `incidents_open`).
- На `backend/app/client_home_page.py`:
  - верхний KPI-контур расширен бейджами `SLA` и `ETA`;
  - добавлен primary-блок `Потребує дії зараз` (short-list attention транспорта).
- На `backend/app/client_vehicles_page.py`:
  - добавлен фильтр SLA-сценариев (`all/attention/risk/warn/ok`);
  - внедрён паттерн `primary + secondary`:
    - `Потребують уваги` (верхний сценарный список);
    - `Усі транспорти` (`details` + persisted-state, role-aware default open).
- Server-first результат:
  - локальный `py_compile` + VPS `py_compile` — OK;
  - deploy на VPS (`docker compose -f compose.yaml -f compose.server.yaml up -d --build api`) — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS.

Следующий этап: `Client MVP step-6` — role-aware UX для `Профіль/Сповіщення` и финальный e2e-runbook клиентского контура.

## Актуализация (2026-02-16): Client MVP step-6 (account role-aware + e2e)

- На `backend/app/client_profile_page.py`:
  - добавлен role-chip;
  - добавлен summary-контур (`ПРОФІЛЬ/КОНТАКТ/МОВА`) и support-secondary блок `profileSupportDetails`;
  - reset изменён на восстановление последнего сохранённого состояния (без destructive очистки).
- На `backend/app/client_notifications_page.py`:
  - добавлен role-chip и summary-контур (`КАНАЛИ/ПРІОРИТЕТ/ДАЙДЖЕСТ`);
  - добавлены quick presets (`critical/balanced/realtime`);
  - добавлен support-secondary блок `notifySupportDetails`.
- Server-first результат:
  - локальный/VPS `py_compile` — OK;
  - deploy на VPS (`docker compose -f compose.yaml -f compose.server.yaml up -d --build api`) — OK;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - marker-check `/client/profile` и `/client/notifications` подтверждает новые role-aware/e2e маркеры.

Следующий этап: `Client MVP step-7` — финальный UX-audit client-контура и регрессионный checklist по real-data сценариям.

## Актуализация (2026-02-16): Client MVP step-7a (automated regression gate)

- Добавлен `scripts/client_panel_regression_check.sh` для account-контура клиента.
- Покрытие скрипта:
  - `auth=200 / anon=401` для `/client/profile`, `/client/notifications`,
    `/api/client/profile`, `/api/client/notification-settings`;
  - marker-check role-aware элементов (`whoami`, `profileSupportDetails`, `notifySupportDetails`, presets);
  - payload-check (`status=ok`) для account API.
- Прогон:
  - `./scripts/client_panel_regression_check.sh --admin-pass-file "pass admin panel"` — `RESULT: PASS`.

Следующий этап: `Client MVP step-7b` — финальный real-data UX-audit и фиксация итогового regression checklist.

## Актуализация (2026-02-16): Client MVP step-7b (real-data UX audit)

- Добавлен `scripts/client_panel_step7b_audit.py`.
- Script выполняет:
  - auth/anon проверки client UI/API;
  - contract-check `whoami/home/vehicles/profile/notification-settings`;
  - marker-check account role-aware UX.
- Сформирован отчёт:
  - `Docs/auto/web-panel/client-step7b-ux-audit.md`.
- Прогон:
  - `python3 scripts/client_panel_step7b_audit.py --admin-pass-file "pass admin panel" --write Docs/auto/web-panel/client-step7b-ux-audit.md` — `RESULT: PASS`.

Следующий этап: `Client MVP step-8` — операторский acceptance-playbook для режима `admin-support`.

## Актуализация (2026-02-16): Client MVP step-8a (support playbook)

- Добавлен playbook:
  - `Docs/Проект/Операции/Client admin-support playbook.md`.
- Playbook фиксирует:
  - preflight-команды для server-first check;
  - сценарии `client` и `admin-support`;
  - rollback-процедуру возврата в `client` режим.
- Зафиксирован baseline:
  - `/api/client/whoami` на текущей серверной конфигурации возвращает `role=client`.

Следующий этап: `Client MVP step-8b` — выполнить acceptance playbook в `admin-support` режиме и зафиксировать итог в release docs.

## Актуализация (2026-02-16): Client MVP step-8b (support acceptance + rollback)

- Выполнен server-side acceptance run для `admin-support`:
  - временно установлен `CLIENT_SUPPORT_USERS=admin`;
  - подтверждён `/api/client/whoami` -> `role=admin-support`.
- В support-режиме пройдены проверки:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh` — PASS;
  - `scripts/client_panel_step7b_audit.py` — PASS.
- Выполнен rollback:
  - восстановлен backup `.env.step8b.20260216162039.bak`;
  - подтверждён возврат к `role=client`;
  - повторный smoke-gate — PASS.
- Артефакт acceptance:
  - `Docs/auto/web-panel/client-step8b-support-acceptance.md`.

Следующий этап: `Client MVP step-9` — оформить постоянный rollout support-логинов и отделить support-доступ от `admin`.

## Актуализация (2026-02-16): Client MVP step-9 (dedicated support rollout)

- Выполнен infra rollout dedicated support login:
  - `scripts/client_support_rollout.sh`.
- Разделены nginx auth-файлы:
  - client: `/etc/nginx/passengers-client.htpasswd`;
  - admin: `/etc/nginx/passengers-admin.htpasswd`.
- Применена policy:
  - `CLIENT_SUPPORT_USERS=support`.
- Проверки:
  - `support` -> `/api/client/whoami` = `200`, `role=admin-support`;
  - `support` -> `/api/admin/whoami` = `401`;
  - `admin` в client-контуре остаётся `role=client`.
  - `admin_panel_smoke_gate`, `client_panel_regression_check` (admin/support),
    `client_panel_step7b_audit` (support), `server_security_posture_check` — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step9-support-rollout.md`.

Следующий этап: `Client MVP step-10` — расширить support rollout на несколько support-логинов с per-client scope bindings.

## Актуализация (2026-02-16): Client MVP step-10 (support scope isolation)

- Добавлен rollout script:
  - `scripts/client_scope_rollout.sh`.
- На сервере применено:
  - `CLIENT_SCOPE_BINDINGS=support:sys-0001`.
- Подтверждено:
  - support видит scoped контур (`central_ids=["sys-0001"]`);
  - support `/api/client/vehicles` ограничен по scope (`total=1`);
  - smoke/regression/audit checks — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step10-scope-rollout.md`.

Следующий этап: `Client MVP step-11` — подготовить onboarding-policy для нескольких support-логинов.

## Актуализация (2026-02-16): Client MVP step-11 (multi-support onboarding policy)

- Добавлен rollout script:
  - `scripts/client_support_matrix_rollout.sh`.
- Добавлен matrix template:
  - `Docs/Проект/Операции/client-support-onboarding-matrix.example`.
- На сервере применено:
  - actor policy `support-<system_id>`;
  - `CLIENT_SUPPORT_USERS=support-sys-0001`;
  - `CLIENT_SCOPE_BINDINGS=support-sys-0001:sys-0001`;
  - legacy `support` удалён из client auth-файла.
- Подтверждено:
  - `support-sys-0001` -> `/api/client/whoami`: `role=admin-support`, `scope.central_ids=["sys-0001"]`;
  - `support-sys-0001` -> `/api/admin/whoami`: `401`;
  - `admin` в client-контуре остаётся `role=client`;
  - smoke/regression/audit/security checks — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step11-multi-support-onboarding.md`.

Следующий этап: `Client MVP step-12` — lifecycle policy для support-акторов (disable/rotate/revoke без downtime).

## Актуализация (2026-02-16): Client MVP step-12 (support actor lifecycle)

- Добавлен lifecycle rollout script:
  - `scripts/client_support_lifecycle_rollout.sh`.
- На сервере выполнен controlled lifecycle scenario:
  - для временного actor `support-sys-0099` выполнены `rotate`, `disable`, `revoke`;
  - проверено отсутствие downtime для активного actor `support-sys-0001`.
- Подтверждено:
  - `support-sys-0099` после revoke -> `/api/client/whoami` = `401`;
  - `support-sys-0001` остаётся `role=admin-support` в client-контуре;
  - `CLIENT_SCOPE_BINDINGS` очищен от revoked actor;
  - smoke/regression/audit/security checks — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step12-support-lifecycle-rollout.md`.

Следующий этап: `Client MVP step-13` — automation pack lifecycle (rotation schedule + actor inventory).

## Актуализация (2026-02-16): Client MVP step-13 (lifecycle automation pack)

- Добавлен automation tooling:
  - `scripts/client_support_rotation_batch.sh` (batch rotate);
  - `scripts/client_support_inventory_report.sh` (inventory/drift report);
  - `scripts/install_client_support_lifecycle_timer.sh` (server timers).
- На сервере применено:
  - `support-sys-0001` rotated через batch plan;
  - old password revoked (`401`), new password active (`200`);
  - timers `passengers-client-support-inventory.timer` и `passengers-client-support-rotation-reminder.timer` активированы.
- Подтверждено:
  - итоговый support-state не деградировал (`support-sys-0001` active, scope intact);
  - smoke/regression/audit/security checks — PASS.
- Артефакт:
  - `Docs/auto/web-panel/client-step13-lifecycle-automation-pack.md`.

Следующий этап: `Client MVP step-14` — UX polish client navigation (compact + progressive disclosure).

## Актуализация (2026-02-16): Client MVP step-14 (UX polish navigation + progressive disclosure)

- Выполнен UI-only rollout клиентского shell:
  - `backend/app/client_ui_kit.py`:
    - compact sidebar toggle + persistent state;
    - grouped submenu на `<details>` с persistent open-state;
    - единый progressive-mode таблиц (`Колонки: базово/детально`).
  - `backend/app/client_home_page.py`, `backend/app/client_vehicles_page.py`, `backend/app/client_tickets_page.py`, `backend/app/client_status_page.py`:
    - добавлен `tableToggle`;
    - secondary-колонки вынесены в `progressiveCol`.
- Server-first проверка:
  - deploy (`rsync + py_compile + docker compose ... --build api`) — PASS;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step14-ux-polish-rollout.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step14.md`.

Следующий этап: `Client MVP step-15` — accessibility/keyboard flow + финальный copy-audit клиентской панели.

## Актуализация (2026-02-16): Client MVP step-15 (a11y + keyboard flow + copy audit)

- Выполнен core-level a11y слой клиентского shell:
  - skip-link `Перейти до основного контенту`;
  - `focus-visible` для keyboard-навигации;
  - `aria-live` для status-маркеров.
- Добавлен keyboard flow без изменения API:
  - `/`, `Esc`, `Alt+Shift+M`, `Alt+Shift+K`, `Alt+Shift+S`, `Alt+Shift+T`.
- Выполнен copy-audit account-домена (`Профіль/Сповіщення`) с локализацией support/preset/summary формулировок.
- Обновлены regression/audit маркеры:
  - `scripts/client_panel_regression_check.sh`;
  - `scripts/client_panel_step7b_audit.py`.
- Server-first check:
  - deploy (`rsync + py_compile + docker compose ... --build api`) — PASS;
  - smoke/regression/audit/security — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step15-a11y-keyboard-copy-rollout.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step15.md`.

Следующий этап: `Client MVP step-16` — keyboard-only acceptance run и фиксация финального DoD клиентского shell.

## Актуализация (2026-02-16): Client MVP step-16 (keyboard-only acceptance + final DoD)

- Добавлен acceptance script:
  - `scripts/client_panel_step16_accessibility_check.sh`.
- Script фиксирует:
  - auth/anon-контракт по ключевым client endpoints;
  - роль `admin-support`;
  - shell markers (`skipLink`, `sideCompactToggle`, `clientMainContent`) и keyboard shortcut markers;
  - account copy markers (`Профіль/Сповіщення`).
- Выполнен server-side acceptance run:
  - `./scripts/client_panel_step16_accessibility_check.sh --admin-user support-sys-0001 --admin-pass-file "pass client support sys-0001 panel step13-rotated" --write Docs/auto/web-panel/client-step16-accessibility-acceptance.md` — PASS.
- Дополнительно подтверждено:
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step16-accessibility-acceptance.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step16.md`.

Следующий этап: `Client MVP step-17` — release-candidate stabilization и финальный handoff checklist.

## Актуализация (2026-02-16): Client MVP step-17 kickoff (RC IA freeze)

- Зафиксирован канон IA меню/подменю для `admin+client`:
  - `Docs/Проект/Веб-панель/Архитектура меню (admin+client).md`.
- Синхронизированы документы ядра/операций:
  - `Docs/Проект/INDEX.md`;
  - `Docs/Проект/Веб-панель (ядро и домены).md`;
  - `Docs/Проект/Операции.md`;
  - `Docs/Проект/Операции/Client admin-support playbook.md`;
  - `Docs/Проект/Операции/Сервер backend и VPN.md`.
- Контрольный server-first прогон:
  - `scripts/client_panel_step16_accessibility_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/admin_panel_smoke_gate.sh` — PASS;
  - `scripts/client_panel_regression_check.sh --admin-user support-sys-0001 ...` — PASS;
  - `scripts/client_panel_step7b_audit.py --admin-user support-sys-0001 ...` — PASS;
  - `scripts/server_security_posture_check.sh` — PASS.
- Артефакт kickoff:
  - `Docs/auto/web-panel/client-step17-rc-kickoff.md`.

Следующий этап: `Client MVP step-17` — финальный handoff checklist и фиксация RC baseline.

## Актуализация (2026-02-16): Client MVP step-17 done (handoff checklist automation)

- Добавлен единый скрипт RC/handoff контроля:
  - `scripts/client_panel_step17_handoff_check.sh`.
- Скрипт покрывает:
  - server access (`ssh+sudo`);
  - `step-16 accessibility acceptance`;
  - `admin smoke gate`;
  - `client regression check`;
  - `client step7b audit`;
  - `server security posture`.
- Фактический запуск:
  - `./scripts/client_panel_step17_handoff_check.sh --write Docs/auto/web-panel/client-step17-handoff-checklist.md` — PASS.
- Артефакты:
  - `Docs/auto/web-panel/client-step17-handoff-checklist.md`;
  - `Docs/auto/web-panel/client-step7b-ux-audit-support-sys-0001-step17.md`.

Следующий этап: `Client MVP step-18` — content-split по IA freeze и visual-density аудит.
