# Документация (архитектура и правила)

Документ задаёт структуру документации для проекта и правила, чтобы при росте до `100–200` систем не возникал хаос.

## Цель

- единый источник истины по канону и конфигурации;
- быстрый вход в проект для эксплуатации и разработки;
- модульное расширение без дублирования и конфликтов;
- предсказуемый процесс обновления после каждого этапа работ.

## Слои документации

1. `L0` Канон (стабильные основы)
- `Docs/настройка ПО/План/0. Паспорт дверей (door_id ↔ hostname ↔ IP).md`
- `Docs/настройка ПО/План/2. Сетевые адреса и роли.md`
- `Docs/настройка ПО/План/3. Синхронизация времени (критично для данных).md`
- Любые изменения здесь требуют синхронизации всех зависимых документов.

2. `L1` Архитектура и контракты
- `Docs/Проект/Архитектура.md`
- `Docs/Проект/Модули.md`
- `Docs/Проект/Протокол (Edge→Central).md`
- `Docs/Проект/Сервер (Central→Backend).md`
- `Docs/Проект/Стандарт интеграции модулей v1.md`

3. `L2` Эксплуатация и настройки
- `Docs/Проект/Конфигурация.md`
- `Docs/Проект/Операции.md`
- `Docs/Проект/Проблемы.md`
- `Docs/Проект/Надёжность и безопасность.md`

4. `L3` Управление разработкой
- `Docs/Проект/Админ-панель (модульная разработка).md`
- `Docs/Проект/Промпты Codex (админка).md`
- `Docs/Проект/Скиллы Codex.md`

5. `L4` Автоматические артефакты
- `Docs/auto/baseline-summary.md`
- `Docs/auto/inventory/INDEX.md`
- `Docs/auto/commissioning/`
- `Docs/auto/fleet-rollout/`

## Модульная модель документов

Каждый документ должен иметь одну чёткую роль:

- архитектура отвечает на вопрос "как устроено";
- контракт отвечает на вопрос "какие поля/эндпоинты/правила";
- операции отвечают на вопрос "какие команды выполнить";
- проблемы отвечают на вопрос "как диагностировать и чинить";
- governance отвечает на вопрос "как развивать без регрессий".

Если раздел разрастается и решает более одной роли, его нужно выделить в новый модульный файл и добавить ссылку в `Docs/Проект/INDEX.md`.

## Правила именования и ссылок

- Для операционных документов использовать практичные названия с предметной областью.
- Не копировать таблицы канона в другие файлы; вместо этого давать ссылку на канон.
- Ссылки между документами всегда указывать абсолютным путём от корня репозитория.
- Термины использовать единообразно:
  - физическая дверь: `дверь №N` или `door_id=N`;
  - hostname узла: `door-1`, `door-2`, `central-gw`;
  - масштабируемая система: `system_id`/`central_id` вида `sys-XXXX`.

## Change workflow (обязательный)

1. Проверить, изменился ли канон (`L0`).
2. Снять фактическое состояние через автоотчёты (`L4`), если изменение инфраструктурное.
3. Обновить затронутые документы по слоям (`L1`/`L2`/`L3`).
4. Обновить `Docs/Проект/INDEX.md`, если появился новый файл или изменилась навигация.
5. Добавить запись о новом этапе в профильный roadmap (например, модульная админка).
6. Обновить `Docs/Проект/Паспорт релиза документации.md` (версия, изменения, следующий этап).

## Definition of Done для обновления документации

- изменённый функционал отражён в нужном модуле документов;
- `INDEX` содержит рабочие ссылки на новый/обновлённый материал;
- нет конфликтующих формулировок между `Архитектура`, `Модули`, `Операции`, `Проблемы`;
- для масштабируемых изменений отражены правила `system_id = central_id`;
- при необходимости обновлены skill/workflow документы.

## Рекомендация для этапов до установки камер/модулей

Пока камеры/GPS/RTC/LTE не подключены, вести документацию в режиме `MVP baseline`:

- явно маркировать шаги как "без камеры/без модулей";
- не фиксировать финальные SLA производительности подсчёта;
- сохранять подготовленные разделы под будущие модули как `planned`, но не смешивать с `active`.

## Обязательное правило сопровождения этапов

Для этого проекта правило обязательное (не рекомендация):

1. После **каждой** доработки кода/конфига в том же этапе сразу обновлять профильные документы.
2. Обновление выполнять структурно: `Модули` / `Операции` / `Проблемы` + при необходимости `INDEX`.
3. В конце каждого этапа всегда фиксировать два пункта:
- что сделано и зачем;
- что будет сделано следующим этапом и зачем.
4. Если изменения затронули workflow, обязательно синхронизировать `Docs/Проект/Скиллы Codex.md` и соответствующий `skills/*/SKILL.md`.

Если пункт 1-4 не выполнен, этап считается незавершённым.
