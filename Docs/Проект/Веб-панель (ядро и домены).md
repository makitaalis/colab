# Веб-панель (ядро и домены)

Документ фиксирует целевую архитектуру web-панели в формате `Core + Domains`, чтобы развивать интерфейс без монолита и визуальной перегрузки.

Детализация по ядру и каждому домену:

- `Docs/Проект/Веб-панель/INDEX.md`
- `Docs/Проект/Веб-панель/Ядро (Core).md`
- `Docs/Проект/Веб-панель/Архитектура меню (admin+client).md`
- `Docs/Проект/Веб-панель/Домен Старт.md`
- `Docs/Проект/Веб-панель/Домен Флот.md`
- `Docs/Проект/Веб-панель/Домен Сповіщення.md`
- `Docs/Проект/Веб-панель/Домен Контроль и KPI.md`
- `Docs/Проект/Веб-панель/Домен Інфраструктура.md`
- `Docs/Проект/Веб-панель/Домен Клієнт.md`

## Цель

- убрать зависимость от одного большого UI-файла;
- разделить ответственность между ядром платформы и предметными доменами;
- обеспечить единый UX для двух аудиторий:
  - администратор (операционный контур);
  - клиент (кабинет/статусы/обращения).

## 1) Архитектурная модель

1. `Core` (ядро панели)
- дизайн-токены, базовые компоненты, shell и навигация;
- UX-правила (sidebar/page-subnav, density, states);
- общие helpers (copy-link, query sync, role badge, telemetry hooks).

2. `Domains` (предметные домены)
- каждый домен владеет своими страницами, текстами, view-model и сценариями;
- домены не зависят от DOM/JS внутренних блоков других доменов;
- взаимодействие между доменами только через URL/API/контекст.

## 2) Текущая кодовая структура (принято)

Админка:

- `backend/app/admin_core/` — ядро админ-панели
  - `navigation.py`
- `backend/app/admin_domains/` — доменная карта админ-панели
  - `domain_catalog.py`
- `backend/app/admin_ui_kit.py` — shell/рендер, использует `admin_core` + `admin_domains`
- `backend/app/admin_*_page.py` — страницы доменов
- `backend/app/admin_*_ops.py` — API-операции доменов

Клиентская панель (MVP step-16):

- `backend/app/client_core/`
  - `navigation.py`
- `backend/app/client_domains/`
  - `domain_catalog.py`
- `backend/app/client_ui_kit.py` — единый shell клиента
- `backend/app/client_*_page.py` — клиентские страницы
- `backend/app/client_ops.py` — API-операции клиентского домена
- route: `/client*` (overview/vehicles/tickets/status/profile/notifications)
- API: `/api/client/*` (whoami/home/vehicles/tickets/status/profile/notification-settings)
- `home/vehicles` используют общий SLA/ETA сценарий: `primary` (attention) + `secondary` (полный список).
- `profile/notifications` используют role-aware account-сценарий: `summary + presets + secondary support-details`.
- финальный real-data аудит фиксируется отчётом `Docs/auto/web-panel/client-step7b-ux-audit.md`.
- support-acceptance фиксируется отчётом `Docs/auto/web-panel/client-step8b-support-acceptance.md`.
- support-rollout фиксируется отчётом `Docs/auto/web-panel/client-step9-support-rollout.md`.
- scope-rollout фиксируется отчётом `Docs/auto/web-panel/client-step10-scope-rollout.md`.
- multi-support onboarding фиксируется отчётом `Docs/auto/web-panel/client-step11-multi-support-onboarding.md`.
- support lifecycle фиксируется отчётом `Docs/auto/web-panel/client-step12-support-lifecycle-rollout.md`.
- lifecycle automation pack фиксируется отчётом `Docs/auto/web-panel/client-step13-lifecycle-automation-pack.md`.
- UX polish navigation фиксируется отчётом `Docs/auto/web-panel/client-step14-ux-polish-rollout.md`.
- a11y + keyboard flow + copy audit фиксируется отчётом `Docs/auto/web-panel/client-step15-a11y-keyboard-copy-rollout.md`.
- keyboard-only acceptance и финальный DoD фиксируется отчётом `Docs/auto/web-panel/client-step16-accessibility-acceptance.md`.
- policy support actor: `support-<system_id>`.
- `step-17` (RC stabilization) выполнен: IA freeze + handoff checklist automation (`scripts/client_panel_step17_handoff_check.sh`), отчёты `Docs/auto/web-panel/client-step17-rc-kickoff.md` и `Docs/auto/web-panel/client-step17-handoff-checklist.md`.

Авто-инвентарь доменов:

- `scripts/web_panel_domain_inventory.py`
- отчёт: `Docs/auto/web-panel/domain-inventory.md`

## 3) Каноничный принцип меню

- меню строго двухуровневое: `раздел -> подменю`;
- в sidebar раскрыт только активный раздел, остальные свернуты;
- для client shell доступен persistent compact-mode sidebar;
- под header показывается `page subnav` текущего раздела;
- вторичные блоки sidebar скрываются в `Simple`-режиме;
- secondary table-columns включаются по progressive toggle (`базово/детально`).
- keyboard-first слой обязателен: `/`, `Esc`, shortcut toggles + skip-link.

## 4) Стандарты разработки (обязательно)

1. Любая новая страница сначала регистрируется в `*_domains/domain_catalog.py`.
2. Изменения навигации делаются только в `*_core/navigation.py`, а не в страницах.
3. Общие UI-паттерны живут в `admin_ui_kit.py` и `client_ui_kit.py`.
4. Доменная страница не должна импортировать код другого домена.
5. Любая доработка проходит server-first цикл:
- `rsync -> py_compile -> docker compose ... --build api -> admin_panel_smoke_gate.sh`.

## 5) UX-стратегия доработки (admin + client)

Этап A. Ядро и домены (foundation)
- зафиксировать структуру `Core + Domains`;
- вынести IA-навигацию и доменный каталог из монолита.

Этап B. Информационная декомпозиция страниц
- перегруженные страницы (`fleet`, `notify-center`) разнести по подстраницам по доменам;
- на каждой странице оставить только один основной сценарий оператора.

Этап C. Ролевая подача интерфейса
- `admin/operator/viewer`: разный уровень плотности и набор действий;
- `client`: отдельный легковесный shell с фокусом на статусах и запросах.

Этап D. Визуальный polish
- современный минимализм: меньше визуального шума, больше контекста и статусов;
- единый ритм блоков (header -> subnav -> KPI -> table/feed -> secondary).

## 6) Definition of Done для архитектурного этапа

1. Навигация и доменная карта не хранятся в одном большом inline-блоке.
2. Есть отдельные модули `core` и `domains` (admin/client), плюс client API-слой `client_ops`.
3. После выкатки на сервер:
- `scripts/admin_panel_smoke_gate.sh` = PASS;
- ключевые `/admin*` рендерят `appShell`, `copyLink`, `filterSummary`;
- ключевые `/client*` рендерят `clientShell`, `copyLink`, `filterSummary`;
- ключевые `/api/client/*` работают под BasicAuth + Bearer proxy.
4. Документация обновлена:
- `Docs/Проект/Админ-панель (UI-UX стандарт).md`
- `Docs/Проект/Админ-панель (модульная разработка).md`
- `Docs/Проект/Операции/Админка модульные этапы.md`
- `Docs/Проект/Паспорт релиза документации.md`
